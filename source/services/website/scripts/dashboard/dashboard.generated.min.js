var Control=function Control$(){};Control.tooltip=function Control$tooltip(e,h,g){e.attr("title",h);e.attr("caption",h);if(!Browser.IsDevice()){var f={delay:{show:0,hide:0}};if(g!=null){f.placement=g}e.tooltip(f)}};Control.preventDefault=function Control$preventDefault(b){b.preventDefault()};Control.delegate=function Control$delegate(g,f){var e={object:g,handler:f};e.invoke=function(){return this.object[this.handler]()};return e};Control.get=function Control$get(b){return $(b).data("control")};Control.findParent=function Control$findParent(c,e){while(c.parentControl!=null){c=c.parentControl;if(c[e]!=null){return c}}return null};Control.expand=function Control$expand(e,g){var f=!(isNaN(g));if(f==true){if(Browser.IsMSIE()){e.collapse("show");e.show("blind",{direction:"vertical"},g)}else{e.show("blind",{direction:"vertical"},g,function(){e.collapse("show")})}}else{e.collapse("show")}};Control.collapse=function Control$collapse(e,g){var f=!(isNaN(g));if(f==true){e.collapse("hide")}else{e.collapse("hide")}};Control.alert=function Control$alert(h,g,f){var e=$("#modalMessage");if(e.length==0){h.replace("<br/>","\r");alert(h);if(f!=null){f()}}else{if(g==null){g="Warning!"}e.find(".modal-header h3").html(g);e.find(".modal-body p").html(h);e.modal("show");if(f!=null){e.find(".modal-header .close").unbind("click").click(function(){f()});e.find(".modal-footer .btn-primary").unbind("click").click(function(){f()})}}};Control.confirm=function Control$confirm(j,i,h,g){var f=$("#modalPrompt");if(f.length==0){j.replace("<br>","\r");if(confirm(j)==true){if(h!=null){h()}}else{if(g!=null){g()}}}else{if(i==null){i="Confirm?"}f.find(".modal-header h3").html(i);f.find(".modal-body p").html(j);f.modal({backdrop:"static",keyboard:false});f.find(".modal-footer .btn-primary").unbind("click").click(function(){f.modal("hide");if(h!=null){h()}});f.find(".modal-footer .btn-cancel").unbind("click").click(function(){f.modal("hide");if(g!=null){g()}})}};Control.popup=function Control$popup(f,j,i,h){var g=$("#modalPrompt");if(g.length==0){alert("Page requires modalPrompt control to support popup!")}else{g=g.clone();g.attr("id","modalPromptOpen");g=g.appendTo($("body"));if(j==null){j="Input required."}g.find(".modal-header h3").html(j);g.find(".modal-body p").empty().append(f);g.modal({backdrop:"static",keyboard:false});g.find(".modal-footer .btn-primary").click(function(){g.modal("hide");var a=[];$.each(g.find(".modal-body input"),function(){a.push($(this).val())});$.each(g.find(".modal-body textarea"),function(){a.push($(this).val())});if(i!=null){i(a)}$("#modalPromptOpen").remove()});g.find(".modal-footer .btn-cancel").unbind("click").click(function(){g.modal("hide");if(h!=null){h()}$("#modalPromptOpen").remove()})}};Control.working=function Control$working(k,j){var i=$("#modalMessage");if(i.length==1){Control.$modalWorking=i.clone();var l=new Spinner().spin();Control.$modalWorking.find(".modal-header h3").html(k);var h=$("<center />").appendTo(Control.$modalWorking.find(".modal-body p").empty());h.append(l.el).css("height","16").css("padding-top","16px");Control.$modalWorking.find(".modal-header .close").hide();Control.$modalWorking.find(".modal-footer .btn-primary").hide();if(j>0){var m=function(){window.clearTimeout(n);Control.workingClose()};var n=window.setTimeout(m,j)}Control.$modalWorking.modal("show")}};Control.workingClose=function Control$workingClose(){if(Control.$modalWorking!=null){Control.$modalWorking.modal("hide");Control.$modalWorking.remove();Control.$modalWorking=null}};Control.popover=function(i,h,m,j,l,n){var k=(l=="center");l=k?"right":l;i.popover({trigger:"manual",title:m,content:j,placement:l});i.popover("show");if(h!=null){h.bind("click.popover",function(){Control.popoverClose(i);h.unbind("click.popover");return true})}if(n!=null){$("body .popover").css("top",n)}if(k){$("body .popover .arrow").hide()}$("body .popover .popover-title").html(m)};Control.popoverClose=function(b){b.popover("hide");$("body .popover").remove()};Control.DateFormat=function Control$DateFormat(){var h=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,f=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,g=/[^-+\dA-Z]/g,e=function(b,a){b=String(b);a=a||2;while(b.length<a){b="0"+b}return b};return function(m,A,D){var o=Control.DateFormat;if(arguments.length==1&&Object.prototype.toString.call(m)=="[object String]"&&!/\d/.test(m)){A=m;m=undefined}m=m?new Date(m):new Date;if(isNaN(m)){throw SyntaxError("invalid date")}A=String(o.masks[A]||A||o.masks["default"]);if(A.slice(0,4)=="UTC:"){A=A.slice(4);D=true}var a=D?"getUTC":"get",b=m[a+"Date"](),c=m[a+"Day"](),y=m[a+"Month"](),E=m[a+"FullYear"](),w=m[a+"Hours"](),z=m[a+"Minutes"](),C=m[a+"Seconds"](),x=m[a+"Milliseconds"](),B=D?0:m.getTimezoneOffset(),s={d:b,dd:e(b),ddd:o.i18n.dayNames[c],dddd:o.i18n.dayNames[c+7],m:y+1,mm:e(y+1),mmm:o.i18n.monthNames[y],mmmm:o.i18n.monthNames[y+12],yy:String(E).slice(2),yyyy:E,h:w%12||12,hh:e(w%12||12),H:w,HH:e(w),M:z,MM:e(z),s:C,ss:e(C),l:e(x,3),L:e(x>99?Math.round(x/10):x),t:w<12?"a":"p",tt:w<12?"am":"pm",T:w<12?"A":"P",TT:w<12?"AM":"PM",Z:D?"UTC":(String(m).match(f)||[""]).pop().replace(g,""),o:(B>0?"-":"+")+e(Math.floor(Math.abs(B)/60)*100+Math.abs(B)%60,4),S:["th","st","nd","rd"][b%10>3?0:(b%100-b%10!=10)*b%10]};return A.replace(h,function(i){return i in s?s[i]:i.slice(1,i.length-1)})}}();Control.DateFormat.masks={"default":"ddd, mmm dd, yyyy h:MM TT",shortDate:"mm/dd/yyyy",mediumDate:"ddd, mmm dd, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",shortDateTime:"mm/dd/yyyy h:MM TT",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};Control.DateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(c,e){return Control.DateFormat(this,c,e)};Date.prototype.parseSafe=function(k){var j=/(\d\d\d\d)(-)?(\d\d)(-)?(\d\d)(T)?(\d\d)(:)?(\d\d)(:)?(\d\d)(\.\d+)?(Z|([+-])(\d\d)(:)?(\d\d))/;if(k.toString().match(new RegExp(j))){var g=k.match(new RegExp(j));var i=0;this.setUTCDate(1);this.setUTCFullYear(parseInt(g[1],10));this.setUTCMonth(parseInt(g[3],10)-1);this.setUTCDate(parseInt(g[5],10));this.setUTCHours(parseInt(g[7],10));this.setUTCMinutes(parseInt(g[9],10));this.setUTCSeconds(parseInt(g[11],10));if(g[12]){this.setUTCMilliseconds(parseFloat(g[12])*1000)}else{this.setUTCMilliseconds(0)}if(g[13]!="Z"){i=(g[15]*60)+parseInt(g[17],10);i*=((g[14]=="-")?-1:1);this.setTime(this.getTime()-i*60*1000)}}else{var h=new Date(k);this.setTime(h)}return this};Date.prototype.parseTime=function(k){if(k==""){return null}var j=k.match(/^(\d+)(:(\d\d))?\s*((a|(p))m?)?$/i);if(j==null){return null}var h=parseInt(j[1],10);var i=j[6];if(h==12&&!i){h=0}else{h+=(h<12&&i)?12:0}var g=new Date();g.setHours(h);g.setMinutes(parseInt(j[3],10)||0);g.setSeconds(0,0);return g};Date.formatSafe=function Date$formatSafe(e,h){if(e!=null&&typeof(e)=="object"){return e.format(h)}if(e!=null&&typeof(e)=="string"){try{if(e.length==0){return null}var f=new Date().parseSafe(e);return f.format(h)}catch(g){}}return e};Date.formatUTC=function Date$formatUTC(b){return Date.formatSafe(b,"isoUtcDateTime")};Control.Icons={};Control.Icons.forSources=function Control$Icons$forSources(k){var h=$("<span />");if(k.HasField(FieldNames.Sources)){var l=k.GetFieldValue(FieldNames.Sources);if(l!=null){l=l.split(",");for(var j in l){switch(l[j]){case"Facebook":var i=k.GetFieldValue(FieldNames.FacebookID);var g=$('<i class="icon-facebook-sign" />').appendTo(h);if(i!=null){g.click(function(){window.open("http://www.facebook.com/"+i);return false})}break;case"Directory":h.append('<i class="icon-azure" />');break}}}else{if(k.ItemTypeID==ItemTypes.Contact){h.append('<i class="icon-user"></i>')}}}return h};Control.Icons.forItemType=function Control$Icons$forItemType(f){var g=(typeof(f)=="object")?f.ItemTypeID:f;var e=$("<i></i>");switch(g){case ItemTypes.Activity:if(typeof(f)=="object"){return Control.Icons.forStatusType(f)}else{return Control.Icons.forStatusType(StatusTypes.Active)}break;case ItemTypes.Step:e.addClass("icon-check");break;case ItemTypes.Contact:e.addClass(f.IsFolder()?"icon-group":"icon-user");break;case ItemTypes.Location:e.addClass("icon-map-marker");break;case ItemTypes.Category:return Control.Icons.forFolder(f.IsFolder()?f:f.GetFolder());default:e.addClass("icon-folder-close");break}return e};Control.Icons.forStatusType=function Control$Icons$forStatusType(f){var g=(typeof(f)=="object")?f.Status:f;var e=$("<i></i>");switch(g){case StatusTypes.Active:e.addClass("icon-play");break;case StatusTypes.Complete:e.addClass("icon-check");break;case StatusTypes.Paused:e.addClass("icon-pause");break;case StatusTypes.Skipped:e.addClass("icon-share");break;default:e.addClass("icon-pause");break}return e};Control.Icons.forActionType=function Control$Icons$forActionType(f){var g=(f!=null&&typeof(f)=="object")?f.Name:f;var e=$("<i></i>");switch(g){case ActionTypes.All:e.addClass("icon-play");break;case ActionTypes.Reminder:e.addClass("icon-bell");break;case ActionTypes.Call:e.addClass("icon-phone");break;case ActionTypes.SendEmail:e.addClass("icon-envelope");break;case ActionTypes.Find:e.addClass("icon-search");break;case ActionTypes.AskFriends:e.addClass("icon-facebook");break;case ActionTypes.Schedule:e.addClass("icon-time");break;case ActionTypes.Errand:e.addClass("icon-shopping-cart");break;case ActionTypes.TextMessage:e.addClass("icon-list-alt");break;default:e.addClass("icon-question-sign");break}return e};Control.Icons.forFolder=function Control$Icons$forFolder(f){var g=(f!=null&&typeof(f)=="object")?f.Name:f;var e=$("<i></i>");switch(g){case UserEntities.Inbox:e.addClass("icon-inbox");break;case UserEntities.People:e.addClass("icon-group");break;case UserEntities.Places:e.addClass("icon-globe");break;case UserEntities.Personal:e.addClass("icon-user");break;case UserEntities.Home:e.addClass("icon-home");break;case UserEntities.Auto:e.addClass("icon-truck");break;case UserEntities.Finance:e.addClass("icon-money");break;default:e.addClass("icon-folder-close");break}return e};Control.Icons.forMapLink=function Control$Icons$forMap(i){var j=i.GetFieldValue(FieldNames.WebLinks);if(j!=null&&j.length>0){var l=new LinkArray(j).Links();for(var h in l){var k=l[h];if(k.Name=="Map"&&k.Url!=null){var g=$('<i class="icon-map-marker"></i>');g.attr("href",k.Url);Control.tooltip(g,"Map");g.click(function(){window.open($(this).attr("href"));return false});return g}}}return $("<i></i>")};Control.ItemType={};Control.ItemType.renderDropdown=function Control$ItemType$renderDropdown(r,w,B){var y=DataModel.Constants.ItemTypes;var u=y[w.ItemTypeID].Name;var t=t=$('<div class="control-group"></div>').appendTo(r);if(B!=true){var A=(w.IsFolder()||w.IsList)?"List":"Item";var z='<label class="control-label">Type of '+A+"</label>";$(z).appendTo(t)}var p=$('<div class="btn-group" />').appendTo(t);var o=$('<a class="btn dropdown-toggle" data-toggle="dropdown" />').appendTo(p);Control.Icons.forItemType(w).appendTo(o);if(B!=true){$("<span>&nbsp;&nbsp;"+u+"</span>").appendTo(o);$('<span class="pull-right">&nbsp;&nbsp;<span class="caret" /></span>').appendTo(o)}var q=$('<ul class="dropdown-menu" />').appendTo(p);q.data("item",w);for(var v in y){var x=y[v];if(x.UserID==SystemUsers.User||x.UserID==DataModel.User.ID){var s=$("<li><a></a></li>").appendTo(q);s.find("a").append(Control.Icons.forItemType(v));s.find("a").append("<span>&nbsp;&nbsp;"+y[v].Name+"</span>");s.data("value",v);s.click(function(a){Control.ItemType.update($(this));a.preventDefault()})}}return t};Control.ItemType.update=function Control$ItemType$update(h){var i=h.parent().data("item");var j=i.Copy();j.ItemTypeID=h.data("value");var f=h.parents(".btn-group").first().find(".btn");f.find("i").replaceWith(Control.Icons.forItemType(j));var g=h.find("span").first();if(g.length>0){f.find("span").first().html(g.html())}i.Update(j)};Control.Actions={};Control.Actions.render=function Control$Actions$render(k,n,m){var i;if(n.HasField(FieldNames.DueDate)){i=$("<div />");var j=Control.DateTime.renderDatePickerIcon(i,n,n.GetField(FieldNames.DueDate));i=i.find("input")}var l;if(Browser.IsMobile()){l=$('<div class="btn-toolbar hide" />').appendTo(k);this.mobileButton(this.actionIcon(n)).prependTo(l).removeClass("pull-right");this.mobileButton(Control.Actions.infoBtn(n)).appendTo(l);if(i!=null){i.appendTo(l);j.find("i").addClass("icon-large").attr("caption","Due");this.mobileButton(j).appendTo(l)}this.mobileButton(Control.Actions.completeBtn(n,function(a){return Control.Actions.completeHandler(a)})).appendTo(l)}else{l=$('<div class="btn-toolbar pull-right" />').appendTo(k);if(n.IsActive()){var h=this.iconButton(Control.Actions.completeBtn(n,function(a){return Control.Actions.completeHandler(a)})).appendTo(l);h.addClass("btn-primary btn-complete")}if(i!=null&&!(n.IsComplete()||n.IsSkipped())){i.appendTo(l);j.find("i").addClass("icon-large");this.iconButton(j).appendTo(l)}if(m!=null){this.iconButton(Control.Actions.editBtn(n,m)).appendTo(l);this.iconButton(Control.Actions.deleteBtn(n)).appendTo(l)}}return l};Control.Actions.renderButton=function Control$Actions$actionButton(b){return this.iconButton(this.actionIcon(b))};Control.Actions.actionIcon=function Control$Actions$actionIcon(g){var e=g.GetActionType();if(e==null){return null}var f=e.Name;switch(f){case ActionTypes.Call:return Control.Actions.callBtn(g);case ActionTypes.TextMessage:return Control.Actions.textBtn(g);case ActionTypes.SendEmail:return Control.Actions.emailBtn(g);case ActionTypes.Errand:return Control.Actions.mapBtn(g);case ActionTypes.Find:return Control.Actions.findLocalBtn(g);case ActionTypes.Schedule:return Control.Actions.scheduleBtn(g);case ActionTypes.AskFriends:return Control.Actions.askFriendsBtn(g);default:return Control.Icons.forActionType(e).addClass("icon-large")}};Control.Actions.mobileButton=function Control$Actions$mobileButton(g){var e=g;if(e.hasClass("btn")){e.addClass("btn-step pull-right")}else{e=$('<a class="btn btn-step pull-right" />').append(g)}g=g.find("i");g.addClass("icon-blue");var f=$("<p />").appendTo(e);f.html(g.attr("caption"));return e};Control.Actions.iconButton=function Control$Actions$iconButton(e){var c=e;if(c.hasClass("btn")){c.addClass("btn-step icon")}else{c=$('<a class="btn btn-step icon" />').append(e)}c.find("i").addClass("icon-blue");return c};Control.Actions.editBtn=function Control$Actions$editBtn(g,f){var e=$('<i class="icon-pencil"></i>');e.data("control",f);e.data("item",g);Control.tooltip(e,"Edit");e.click(function(){$(this).tooltip("hide");var a=$(this).data("item");Control.get(this).parentControl.selectItem(a);Events.Track(Events.Categories.Organizer,Events.Organizer.EditStep);return false});return $('<a class="icon" />').append(e)};Control.Actions.deleteBtn=function Control$Actions$deleteBtn(e){var c=$('<i class="icon-remove-sign"></i>');c.css("cursor","pointer");c.data("item",e);Control.tooltip(c,"Delete");c.click(function(){$(this).tooltip("hide");var b=$(this).data("item");var a=(b.ParentID==null)?b.GetFolder():b.GetParent();b.Delete(a);Events.Track(Events.Categories.Organizer,Events.Organizer.DeleteStep);return false});return $('<a class="icon" />').append(c)};Control.Actions.completeBtn=function Control$Actions$completeBtn(g,f){var e=$('<i class="icon-check icon-large"></i>');e.data("item",g);Control.tooltip(e,"Complete",null);e.attr("caption","Done");e.click(function(){$(this).tooltip("hide");var a=$(this).data("item");if(f==null||f(a)==true){a.Complete();Events.Track(Events.Categories.Organizer,Events.Organizer.CompleteButton)}return true});return $('<a class="icon" />').append(e)};Control.Actions.completeHandler=function Control$Actions$completeHandler(n){var k=n.GetParent();var j=n.GetActionType();if(k!=null&&j!=null){var h=null;var m=null;switch(j.Name){case ActionTypes.Find:h=$("<div>"+Messages.CompleteHandler.FindText+"<p/></div>");var l=n.GetField(FieldNames.Locations);var i=Control.LocationList.renderInput(h,n,l,function(a){return false});i.addClass("input-xxlarge");m=k.Name;break;default:return true}if(h!=null){Control.popup(h,m,function(a){Control.LocationList.update(i);n.Complete();Events.Track(Events.Categories.Organizer,Events.Organizer.CompleteButton);return true},function(a){return false})}}return false};Control.Actions.skipBtn=function Control$Actions$skipBtn(e){var c=$('<i class="icon-share icon-large"></i>');c.data("item",e);Control.tooltop(c,"Skip");c.click(function(){$(this).tooltip("hide");var a=$(this).data("item");a.Skip();return true});return $('<a class="icon" />').append(c)};Control.Actions.infoBtn=function Control$Actions$infoBtn(e){var c=$('<i class="icon-info-sign  icon-large"></i>');c.data("item",e);Control.tooltip(c,"Info");c.click(function(){$(this).tooltip("hide");var a=$(this).data("item");NextStepsPage.showManager(NextStepsPage.infoManager);NextStepsPage.infoManager.selectItem(a);return false});return $('<a class="icon" />').append(c)};Control.Actions.callBtn=function Control$Actions$callBtn(g){var e=$('<i class="icon-phone icon-large"></i>');e.data("item",g);Control.tooltip(e,"Call");var f=function(a){a=a.replace(/[^0-9]+/g,"");if(Browser.IsMobile()){window.open("tel:"+a);return false}else{Control.alert(Messages.CallButton.ActionNotSupported,"Call "+Control.Actions.formatPhoneNumber(a),Control.Actions.infoDialogCloseHandler);return true}};e.click(function(){$(this).tooltip("hide");var a=$(this).data("item");var b=a.GetPhoneNumber();var c=true;if(b==null){Control.Actions.infoDialog(a,FieldNames.Phone,"Phone","tel",f)}else{c=f(b)}Events.Track(Events.Categories.Organizer,Events.Organizer.CallButton);return c});return $('<a class="icon" />').append(e)};Control.Actions.textBtn=function Control$Actions$textBtn(g){var e=$('<i class="icon-list-alt icon-large"></i>');e.data("item",g);Control.tooltip(e,"Text");var f=function(a){a=a.replace(/[^0-9]+/g,"");if(Browser.IsMobile()){window.open("sms:"+a)}else{Control.alert(Messages.TextButton.ActionNotSupported,"Send text to "+Control.Actions.formatPhoneNumber(a))}};e.click(function(){$(this).tooltip("hide");var a=$(this).data("item");var b=a.GetPhoneNumber();if(b==null){Control.Actions.infoDialog(a,FieldNames.Phone,"Phone","sms",f)}else{f(b)}Events.Track(Events.Categories.Organizer,Events.Organizer.TextButton);return false});return $('<a class="icon" />').append(e)};Control.Actions.formatPhoneNumber=function Control$Actions$formatPhoneNumber(b){if(b.length==7){return b.slice(0,3)+"-"+b.slice(3,7)}if(b.length==10){return"("+b.slice(0,3)+") "+b.slice(3,6)+"-"+b.slice(6,10)}return b};Control.Actions.mapBtn=function Control$Actions$mapBtn(e){var c=$('<i class="icon-map-marker icon-large icon-blue"></i>');c.data("item",e);Control.tooltip(c,"Map");c.click(function(){$(this).tooltip("hide");var m=$(this).data("item");var n=m.GetMapLink();if(n!=null){window.open(n)}else{var l=m.Name;var a,b,k;if(m.IsLocation()){a=$("<div>"+Messages.MapDialog.LocationText+"<p/></div>");k=m.GetField(FieldNames.Address);b=Control.Text.renderInputAddress(a,m,k,function(f){return false});b.addClass("input-xxlarge");Control.popup(a,l,function(f){Control.Text.updateAddress(b);var g=b.data("place");if(g!=null){if(Browser.IsMobile()){window.open("maps:"+escape(g.formatted_address))}else{window.open("http://maps.google.com/?q="+escape(g.formatted_address))}}})}else{var j;if(m.IsActivity()||m.IsStep()){j=Messages.MapDialog.ActivityOrStepText}else{if(m.IsContact()){j=Messages.MapDialog.ContactText}}a=$("<div>"+j+"<p/></div>");k=m.GetField(FieldNames.Locations);b=Control.LocationList.renderInput(a,m,k,function(f){return false});b.addClass("input-xxlarge");Control.popup(a,l,function(f){Control.LocationList.update(b);var g=b.data("place");if(g!=null){if(Browser.IsMobile()){window.open("maps:"+escape(g.formatted_address))}else{window.open("http://maps.google.com/?q="+escape(g.formatted_address))}}})}}Events.Track(Events.Categories.Organizer,Events.Organizer.MapButton);return false});return $('<a class="icon" />').append(c)};Control.Actions.emailBtn=function Control$Actions$emailBtn(g){var e=$('<i class="icon-envelope icon-large icon-blue"></i>');e.data("item",g);Control.tooltip(e,"Email");var f=function(a){window.open("mailto:"+a)};e.click(function(){$(this).tooltip("hide");var b=$(this).data("item");var a=b.GetEmail();if(a!=null){f(a)}else{Control.Actions.infoDialog(b,FieldNames.Email,"Email","email",f)}Events.Track(Events.Categories.Organizer,Events.Organizer.EmailButton);return false});return $('<a class="icon" />').append(e)};Control.Actions.scheduleBtn=function Control$Actions$scheduleBtn(e){var c=$('<i class="icon-time icon-large"></i>');c.data("item",e);Control.tooltip(c,"Add Appointment");c.attr("caption","Calendar");c.click(function(){$(this).tooltip("hide");var h=$(this).data("item");var b=h.GetParent();var a=$('<div><label>Date: </label><input type="date" class="schedule-date"/><label>Start time: </label><input type="time"/><label>End time: </label><input type="time"/><label>Title: </label><input type="text" class="schedule-name" /></div>');a.find(".schedule-name").val(b.Name);a.find(".schedule-date").val((new Date()).format("shortDate"));if(!Browser.IsMobile()&&Browser.IsMSIE()){a.find(".schedule-date").datepicker()}var g=Messages.ScheduleDialog.HeaderText;Control.popup(a,g,function(r){if(r[0].length==0){Control.alert(Messages.ScheduleDialog.NoDateError,Messages.ScheduleDialog.AlertHeaderText)}else{var u=new Date().setHours(0,0,0,0);var v=new Date(r[0]);if(v<u){Control.alert(Messages.ScheduleDialog.InvalidDateError,Messages.ScheduleDialog.AlertHeaderText);return}var p=new Date(v);var w=v.parseTime(r[1]);var q=p.parseTime(r[2]);if(w!=null){v.setHours(w.getHours());v.setMinutes(w.getMinutes());if(q!=null){p.setHours(q.getHours());p.setMinutes(q.getMinutes())}else{p.setHours(w.getHours()+1);p.setMinutes(w.getMinutes())}}else{v.setHours(0);v.setMinutes(0);p.setDate(p.getDate()+1);p.setHours(0);p.setMinutes(0)}var s=h.GetLocation();if(s!=null){s=s.GetFieldValue(FieldNames.Address)}var t=(r[3].length>0)?r[3]:b.Name;var f=Appointment.Extend({Name:t,StartTime:v,EndTime:p,Location:s,ItemID:h.ID});Service.InvokeController("Actions","CreateAppointment",{Appointment:f},function(i){var j=i.result;if(j.StatusCode!="200"){Control.alert(Messages.ScheduleDialog.ServerError,Messages.ScheduleDialog.AlertHeaderText)}else{var k=j.Result;var l=h.update(k,null);h.Complete()}});Control.working(Messages.ScheduleDialog.AddingText,1500)}});Events.Track(Events.Categories.Organizer,Events.Organizer.ScheduleButton);return false});return $('<a class="icon" />').append(c)};Control.Actions.askFriendsBtn=function Control$Actions$askFriendsBtn(e){var c=$('<i class="icon-facebook icon-large"></i>');c.data("item",e);Control.tooltip(c,"Ask Facebook Friends");c.attr("caption","Ask");c.click(function(){$(this).tooltip("hide");var l=$(this).data("item");var b=l.GetParent();var a=$('<div><label>Question: </label><textarea class="input-xxlarge" style="height: 75px;"/></div>');var j=l.GetFieldValue(ExtendedFieldNames.Article);if(j==null){j="<replace this!>"}var m="this area";var n="Do you know a good "+l.GetFieldValue(ExtendedFieldNames.Article)+" in "+m+"?";var k=Messages.AskFriendsDialog.HeaderText;Control.popup(a,k,function(f){if(f[0].length==0){Control.alert(Messages.AskFriendsDialog.QuestionText,Messages.AskFriendsDialog.HeaderText)}else{n=f[0];Service.InvokeController("Actions","PostOnFacebook",{Question:n},function(g){var h=g.result;if(h.StatusCode!="200"){Control.alert(Messages.AskFriendsDialog.ServerError,Messages.AskFriendsDialog.HeaderText)}else{var i=h.Result;if(i!=null){var o=l.update(i,null);l.Complete()}}});Control.working(Messages.AskFriendsDialog.PostingText,1500)}});return false;Events.Track(Events.Categories.Organizer,Events.Organizer.AskFriendsButton)});return $('<a class="icon" />').append(c)};Control.Actions.findLocalBtn=function Control$Actions$findLocalBtn(e){var c=$('<i class="icon-search icon-large"></i>');c.data("item",e);Control.tooltip(c,"Find");c.click(function(){$(this).tooltip("hide");var a=$(this).data("item");var b=a.Name.toLowerCase();b=b.replace(/^find an /,"");b=b.replace(/^find a /,"");b=b.replace(/^find /,"");if(Browser.IsMobile()&&Browser.IsMSIE()){window.open("http://maps.google.com/search?q="+b+"&tbm=plcs&radius=1")}else{window.open("https://maps.google.com/?q="+b+"&radius=1");if(Control.Actions.openWindowHandler!=null){Control.Actions.openWindowHandler()}}Events.Track(Events.Categories.Organizer,Events.Organizer.FindButton);return false});return $('<a class="icon" />').append(c)};Control.Actions.infoDialog=function Control$Actions$infoDialog(u,q,v,t,r){if(u.IsLocation()||u.IsContact()){return Control.Actions.infoDialogForContactOrLocation(u,q,v,t,r)}q=(q==null)?FieldNames.Phone:q;v=(v==null)?"Phone":v;t=(t==null)?"tel":t;var s=Messages.InfoDialog.HeaderText;var m=$('<div class="form-vertical control-group"></div>');$('<label class="control-label">'+Messages.InfoDialog.LocationText+"</label>").appendTo(m);var p=u.GetField(FieldNames.Locations);var n=Control.LocationList.renderInput(m,u,p,function(a){o.val("");if(q==FieldNames.Phone){var b=a.data("place");if(b!=null){o.val(b.formatted_phone_number)}}});n.addClass("input-xxlarge");m.append('<label class="control-label">'+Messages.InfoDialog.ContactText+"</label>");p=u.GetField(FieldNames.Contacts);var l=Control.ContactList.renderInput(m,u,p,function(a){var c=a.data(FieldNames.Contacts);var b=Item.Extend($.parseJSON(c));b=DataModel.FindItem(b.ID);if(b!=null){o.val(b.GetFieldValue(q))}else{o.val("")}});l.addClass("input-xxlarge");m.append('<div class="controls" style="margin-top:6px"><label class="control-label">'+v+'</label><input type="'+t+'" class="fn-phone"/></div>');var o=m.find(".fn-phone").attr("disabled",true);n.blur(function(a){if(n.val().length>0){o.attr("disabled",false);l.attr("disabled",true)}else{if(l.val().length==0){o.attr("disabled",true)}l.attr("disabled",false)}return true});l.blur(function(a){if(l.val().length>0){o.attr("disabled",false);n.attr("disabled",true)}else{if(n.val().length==0){o.attr("disabled",true)}n.attr("disabled",false)}return true});Control.popup(m,s,function(a){if(a[2].length==0){Control.alert(Messages.InfoDialog.NoDataError(v.toLocaleLowerCase(),"location or contact"),Messages.InfoDialog.AlertHeaderText)}else{if(Control.LocationList.IsValid(a[0])&&Control.ContactList.IsValid(a[1])){Control.alert(Messages.InfoDialog.NoContactOrLocationError,Messages.InfoDialog.AlertHeaderText)}else{var b=a[2];if(a[1].length>0){Control.ContactList.update(l,function(e){e=Item.Extend(e);var c=e.Copy();c.SetFieldValue(q,b);e.Update(c)})}else{if(a[0].length>0){Control.LocationList.update(n,function(e){e=Item.Extend(e);var c=e.Copy();c.SetFieldValue(q,b);e.Update(c)})}}if(r!=null){r(b)}}}})};Control.Actions.infoDialogForContactOrLocation=function Control$Actions$infoDialogForContactOrLocation(o,k,p,n,l){k=(k==null)?FieldNames.Phone:k;p=(p==null)?"Phone":p;n=(n==null)?"tel":n;var j=o.IsLocation()?"location":"contact";var m=Messages.InfoDialogForContactOrLocation.HeaderText(j);var i=$("<div><label>"+p+'</label><input type="'+n+'" /></div>');Control.popup(i,m,function(b){if(b[0].length==0){Control.alert(Messages.InfoDialogForContactOrLocation.NoDataError(p.toLocaleLowerCase(),j),Messages.InfoDialogForContactOrLocation.AlertHeaderText)}else{var a=o.Copy();a.SetFieldValue(k,b[0]);o.Update(a);if(l!=null){l(b[0])}}})};Control.ActionType={};Control.ActionType.renderDropdown=function Control$ActionType$renderDropdown(q,w,z){if(!w.HasField(FieldNames.ActionType)){return $("<dummy />")}var u=w.GetFieldValue(FieldNames.ActionType);if(u==null){u=ActionTypes.Reminder}var s=s=$('<div class="control-group"></div>').appendTo(q);if(z!=true){var y=(w.IsFolder()||w.IsList)?"List":"Item";var x='<label class="control-label">Type of '+y+"</label>";$(x).appendTo(s)}var o=$('<div class="dropdown" />').appendTo(s);var n=$('<a class="icon dropdown-toggle" data-toggle="dropdown" />').appendTo(o);Control.Icons.forActionType(u).appendTo(n);if(z!=true){$("<span>&nbsp;&nbsp;"+u+"</span>").appendTo(n);$('<span class="pull-right">&nbsp;&nbsp;<span class="caret" /></span>').appendTo(n)}var p=$('<ul class="dropdown-menu" />').appendTo(o);p.data("item",w);for(var v in ActionTypes){var t=ActionTypes[v];if(t==ActionTypes.All){continue}var r=$("<li><a></a></li>").appendTo(p);r.find("a").append(Control.Icons.forActionType(t));r.find("a").append("<span>&nbsp;&nbsp;"+t+"</span>");r.data("value",v);r.click(function(a){Control.ActionType.update($(this));a.preventDefault()})}return s};Control.ActionType.update=function Control$ActionType$update(j){var k=j.parent().data("item");var n=k.Copy();var l=j.data("value");var m=ActionTypes[l];n.SetFieldValue(n.GetField(FieldNames.ActionType),m);var h=j.parents(".btn-group").first().find(".btn");h.find("i").replaceWith(Control.Icons.forActionType(m));var i=j.find("span").first();if(i.length>0){h.find("span").first().html(i.html())}k.Update(n)};Control.Text={};Control.Text.render=function Control$Text$render(i,l,k,m,o,n){var m=(m==null)?"span":m;var j;var p=l.GetFieldValue(k);if(k.DisplayType==DisplayTypes.DatePicker){p=Date.formatSafe(p,"mediumDate")}else{if(k.FieldType==FieldTypes.DateTime){p=Date.formatSafe(p)}}if(p!=null){j=$("<"+m+"/>").appendTo(i);j.addClass(k.Class);p=((o==null)?"":o)+p+((n==null)?"":n);j.html(p)}return j};Control.Text.renderLabel=function Control$Text$renderLabel(f,i,h){var g;var j=i.GetFieldValue(h);if(j!=null){g=$("<label><strong>"+j+"</strong></label>").appendTo(f);g.addClass(h.Class)}return g};Control.Text.renderEmail=function Control$Text$renderEmail(f,i,h){var g;var j=i.GetFieldValue(h);if(j!=null){g=$("<a />").appendTo(f);g.addClass(h.Class);g.attr("href","mailto:"+j);g.html(j)}return g};Control.Text.renderActivityLink=function Control$Text$renderActivityLink(g,j,i){var h;var k=j.Name;if(j.IsStep()){var l=j.GetParent();k=l.Name}if(k!=null){h=$("<a>"+k+"</a>").appendTo(g);h.css("whitespace","nowrap");h.click(function(a){i(l)})}return h};Control.Text.renderInput=function Control$Text$renderInput(e,g,f){if(e.attr("type")=="text"){$text=e}else{$text=$('<input type="text" />').appendTo(e)}$text=Control.Text.base($text,g,f);Control.Text.placeholder($text,f);$text.change(function(a){Control.Text.update($(a.srcElement))});$text.keypress(function(a){if(a.which==13){Control.Text.update($(a.srcElement));return false}});return $text};Control.Text.renderInputNew=function Control$Text$renderInput(e,g,f,h){$text=$('<input type="text" />').appendTo(e);$text=Control.Text.base($text,g,f);$text.data("list",h);$text.keypress(function(a){if(a.which==13){Control.Text.insert($(a.srcElement));return false}});if(g.ItemTypeID==ItemTypes.Location){Control.Text.autoCompletePlace($text,Control.Text.insert)}else{if(g.ItemTypeID==ItemTypes.Contact){Control.Text.autoCompleteContact($text,Control.Text.insert);Control.Text.placeholder($text,Control.ContactList.placeHolder)}else{if(g.ItemTypeID==ItemTypes.Step){}else{Control.Text.placeholder($text,"Enter an item")}}}return $text};Control.Text.renderTextArea=function Control$Text$renderTextArea(e,g,f){$text=$("<textarea></textarea>").appendTo(e);$text=Control.Text.base($text,g,f);Control.Text.placeholder($text,f);$text.change(function(a){Control.Text.update($(a.srcElement))});return $text};Control.Text.renderInputAddress=function Control$Text$renderInputAddress(e,h,f,g){g=(g!=null)?g:Control.Text.updateAddress;if(e.attr("type")=="text"){$text=e}else{$text=$('<input type="text" />').appendTo(e)}$text=Control.Text.base($text,h,f);$text.keypress(function(a){if(a.which==13){g($(a.srcElement));return false}});$text=Control.Text.autoCompletePlace($text,g);return $text};Control.Text.renderInputGrocery=function Control$Text$renderInputGrocery(e,g,f){$text=$('<input type="text" />').appendTo(e);$text=Control.Text.base($text,g,f);$text.keypress(function(a){if(a.which==13){Control.Text.updateGrocery($(a.srcElement));return false}});$text=Control.Text.autoCompleteGrocery($text,Control.Text.updateGrocery);return $text};Control.Text.autoCompletePlace=function Control$Text$autoCompletePlace(f,j){f.unbind("keypress");f.keypress(function(a){if(a.which==13){return false}});var g=new google.maps.places.Autocomplete(f[0]);var i=function(a,b){var c=0.5;return new google.maps.LatLngBounds(new google.maps.LatLng(a-c,b-c),new google.maps.LatLng(a+c,b+c))};if(DataModel.geoLocation!=null){var h=i(DataModel.geoLocation[0],DataModel.geoLocation[1]);g.setBounds(h)}google.maps.event.addListener(g,"place_changed",function(){f.data("place",g.getPlace());j(f)});return f};Control.Text.autoCompleteAddress=function Control$Text$autoCompleteAddress(c,e){c.autocomplete({source:function(a,b){Service.Geocoder().geocode({address:a.term},function(i,j){if(j==google.maps.GeocoderStatus.OK){var h=$.map(i,function(f){return{label:f.formatted_address,value:f.formatted_address,latlong:f.geometry.location.toUrlValue()}});b(h)}})},select:function(a,b){$(this).val(b.item.label);$(this).data(FieldNames.LatLong,b.item.latlong);e($(this));return false},minLength:2});return c};Control.Text.autoCompleteContact=function Control$Text$autoCompleteContact(c,e){c.autocomplete({source:function(a,b){Service.InvokeController("UserInfo","PossibleContacts",{startsWith:a.term},function(k){var l=k.result;var i=[];if(l.Count>0){for(var j in l.Contacts){i.push({label:j,value:j,json:l.Contacts[j]})}}b(i)})},select:function(a,b){$(this).val(b.item.label);$(this).data(FieldNames.Contacts,b.item.json);e($(this));return false},minLength:1});return c};Control.Text.autoCompleteGrocery=function Control$Text$autoCompleteGrocery(c,e){c.autocomplete({source:function(a,b){Service.InvokeController("Grocery","GroceryNames",{startsWith:a.term},function(m){var n=m.result;var i=[];if(n.Count>0){for(var k in n.Groceries){var l=n.Groceries[k];i.push({label:l.Name,value:l.Name,json:l})}}b(i)})},select:function(a,b){$(this).val(b.item.label);$(this).data("grocery",b.item.json);e($(this));return false},minLength:1});return c};Control.Text.insert=function Control$Text$insert(j){var k=j.data("field");if(k.Name==FieldNames.Name){var r=j.val();if(r==null||r.length==0){return false}var m=j.data("item");var p=j.data("list");if(m.ItemTypeID==ItemTypes.Location){var q=j.data("place");var o=j.data(FieldNames.LatLong);if(q!=null&&q.geometry!=null){m=Control.Text.applyPlace(m,q);r=q.name}else{if(o!=null){m.SetFieldValue(FieldNames.LatLong,o);m.SetFieldValue(FieldNames.Address,r)}}}if(m.ItemTypeID==ItemTypes.Contact){var n=j.data(FieldNames.Contacts);if(n!=null){contact=$.parseJSON(n);if(contact.ItemTypeID==ItemTypes.Contact){m=Item.Extend(contact)}}}if(m.ItemTypeID==ItemTypes.Grocery){var l=j.data("grocery");if(l!=null){Control.Text.applyGrocery(m,l);r=l.Name}}m.SetFieldValue(k,r);p.InsertItem(m);Events.Track(Events.Categories.Organizer,Events.Organizer.AddStepButton)}};Control.Text.update=function Control$Text$update(h,i){var l=h.data("item");var k=h.data("field");var n=h.val();var j=l.GetFieldValue(k);if(n!=j){var m=l.Copy();m.SetFieldValue(k,n);l.Update(m,i)}};Control.Text.updateAddress=function Control$Text$updateAddress(j){var n=j.data("item");var m=j.data("field");var r=j.val();var l=n.GetFieldValue(m);var q=n.Copy();var p=j.data("place");var o=j.data(FieldNames.LatLong);if(p!=null&&p.geometry!=null){q=Control.Text.applyPlace(q,p,m.Name)}else{if(o!=null){var k=n.GetFieldValue(FieldNames.LatLong);if(k==null||k!=o){q.SetFieldValue(FieldNames.LatLong,o);q.SetFieldValue(m,r)}}else{if(r!=l){q.SetFieldValue(m,r)}}}n.Update(q)};Control.Text.applyPlace=function Control$Text$applyPlace(g,i,f){if(g.Name==null||f==FieldNames.Name){g.SetFieldValue(FieldNames.Name,i.name)}g.SetFieldValue(FieldNames.LatLong,i.geometry.location.toUrlValue());g.SetFieldValue(FieldNames.Address,i.formatted_address);if(i.formatted_phone_number!=null&&g.GetFieldValue(FieldNames.Phone)==null){g.SetFieldValue(FieldNames.Phone,i.formatted_phone_number)}var h=g.GetFieldValue(FieldNames.WebLinks);if(h==null||h=="[]"){var j=new LinkArray();if(i.types[0]=="street_address"){j.Add("http://maps.google.com/maps?z=15&t=m&q="+i.formatted_address,"Map")}else{j.Add(i.url,"Map")}if(i.website!=null){j.Add(i.website,"Website")}g.SetFieldValue(FieldNames.WebLinks,j.ToJson())}return g};Control.Text.updateGrocery=function Control$Text$updateGrocery(h){var l=h.data("item");var j=h.data("field");var n=h.val();var i=l.GetFieldValue(j);var m=l.Copy();var k=h.data("grocery");if(k!=null){m=Control.Text.applyGrocery(m,k,j.Name)}else{if(n!=i){m.SetFieldValue(j,n)}}l.Update(m)};Control.Text.applyGrocery=function Control$Text$applyGrocery(g,f,e){if(g.Name==null||e==FieldNames.Name){g.SetFieldValue(FieldNames.Name,f.Name)}g.SetFieldValue(FieldNames.Category,f.Category);g.SetFieldValue(FieldNames.Picture,f.ImageUrl);return g};Control.Text.base=function Control$Text$base(e,g,f){e.addClass(f.Class);e.data("item",g);e.data("field",f);e.val(g.GetFieldValue(f));return e};Control.Text.placeholder=function Control$Text$placeholder(c,e){if(typeof(e)=="object"){e="Enter "+e.DisplayName.toLowerCase()}c.attr("placeholder",e);if(Browser.IsMSIE()){if(c.val()==null||c.val().length==0){c.val(e);c.addClass("ie-placeholder")}c.focus(function(){var a=$(this);if(a.val()==a.attr("placeholder")){a.val("");a.removeClass("ie-placeholder")}});c.blur(function(){var a=$(this);if(a.val()==null||a.val().length==0){a.val(a.attr("placeholder"));a.addClass("ie-placeholder")}})}};Control.Checkbox={};Control.Checkbox.render=function Control$Checkbox$render(e,g,f){if(e.attr("type")=="checkbox"){$checkbox=e}else{$checkbox=$('<input type="checkbox" class="checkbox" />').appendTo(e)}$checkbox.addClass(f.Class);Control.tooltip($checkbox,f.DisplayName);if(g.GetFieldValue(f)==true){$checkbox.attr("checked","checked")}$checkbox.data("item",g);$checkbox.data("field",f);$checkbox.change(function(){Control.Checkbox.update($(this))});var h=g.GetParentContainer();if(g.IsStep()&&h.IsActivity()&&h.IsRunning()&&(g.IsComplete()||g.IsSkipped())){$checkbox.attr("disabled","disabled")}return $checkbox};Control.Checkbox.update=function Control$Checkbox$update(g){g.tooltip("hide");var k=g.data("item");var j=g.data("field");var l=(g.attr("checked")=="checked");var i=k.GetFieldValue(j);if(l!=i){if(l==true&&j.Name==FieldNames.Complete&&k.HasField(FieldNames.CompletedOn)){k.Complete()}else{var h=k.Copy();h.SetFieldValue(j,l);k.Update(h)}}};Control.LinkArray={};Control.LinkArray.render=function Control$LinkArray$render(i,p,n){var m=$('<div class="link-array" />').appendTo(i);$text=$('<input type="text" />').appendTo(m);$text=Control.Text.base($text,p,n);$text.val("");Control.Text.placeholder($text,"Add a link");$text.change(function(a){Control.LinkArray.update($(a.srcElement))});$text.keypress(function(a){if(a.which==13){Control.LinkArray.update($(a.srcElement));return false}});var r=new LinkArray(p.GetFieldValue(n));var s=r.Links();if(s.length>0){for(var o in s){Control.LinkArray.deleteBtn(o).appendTo(m);var q=s[o];var l=$("<a/>").appendTo(m);var t=(q.Name==null)?q.Url:q.Name;l.html(t);l.attr("href",q.Url);l.attr("target","new")}}return $text};Control.LinkArray.update=function Control$LinkArray$update(g){var i=g.data("item");var h=g.data("field");var j=new LinkArray(i.GetFieldValue(h));var l=g.val();if(l!=null&&l.length>0){j.Add(l);var k=i.Copy();k.SetFieldValue(h,j.ToJson());i.Update(k)}};Control.LinkArray.deleteBtn=function Control$Icons$deleteBtn(e){var c=$('<i class="icon-remove-circle"></i>');c.css("cursor","pointer");Control.tooltip(c,"Remove Link");c.data("index",e);c.click(function(){var b=$(this);b.tooltip("hide");var a=b.parents(".link-array").first().find("input");var j=a.data("item");var i=a.data("field");var k=new LinkArray(j.GetFieldValue(i));k.Remove(b.data("index"));var l=j.Copy();l.SetFieldValue(i,k.ToJson());j.Update(l);return false});return $('<a class="icon" />').append(c)};Control.DateTime={};Control.DateTime.renderDatePicker=function Control$DateTime$renderDatePicker(f,h,g){if(f.attr("type")=="text"){$date=f}else{$date=$('<input type="text" />').appendTo(f)}$date.addClass(g.Class);$date.data("item",h);$date.data("field",g);$date.val(Date.formatSafe(h.GetFieldValue(g),"shortDate"));var i=Date.now().getFullYear();var j=(i-1).toString()+":"+(i+10).toString();$date.datepicker({defaultDate:+1,showOtherMonths:true,changeMonth:true,changeYear:true,yearRange:j,onClose:function(b,a){Control.DateTime.update(a.input)}});return $date};Control.DateTime.renderDatePickerIcon=function Control$DateTime$renderDatePicker(j,l,k){var i=$('<input type="hidden" />').appendTo(j);i.addClass(k.Class);i.data("item",l);i.data("field",k);i.val(Date.formatSafe(l.GetFieldValue(k),"shortDate"));var m=Date.now().getFullYear();var n=(m-1).toString()+":"+(m+10).toString();i.datepicker({defaultDate:+1,showOn:"button",buttonText:'<i class="icon-calendar"></i>',showOtherMonths:true,changeMonth:true,changeYear:true,yearRange:n,onClose:function(b,a){Control.DateTime.update(a.input)}});var h=j.find("button.ui-datepicker-trigger").addClass("btn");Control.tooltip(h,"Set Date");return h};Control.DateTime.renderDateTimePicker=function Control$DateTime$renderDateTimePicker(e,g,f){$date=$('<input type="text" />').appendTo(e);$date.addClass(f.Class);$date.data("item",g);$date.data("field",f);$date.val(Date.formatSafe(g.GetFieldValue(f),"shortDateTime"));$date.datetimepicker({ampm:true,timeFormat:"h:mm TT",hourGrid:4,minuteGrid:15,stepMinute:15,numberOfMonths:2,onClose:function(b,a){Control.DateTime.update(a.input)}});return $date};Control.DateTime.renderRange=function Control$DateTime$renderRange(l,s,r,q,u){var u=(u==null)?"span":u;var m,v;var t=s.GetFieldValue(r);var n=s.GetFieldValue(q);if(t!=null&&n!=null){if(r.FieldType==FieldTypes.DateTime&&q.FieldType==FieldTypes.DateTime){if(t.toDateString()==n.toDateString()){var p=n.format().split(" ");var o=p[p.length-2]+" "+p[p.length-1];v="On "+t.format()+" to "+o}else{v="From "+t.format()+" until "+n.format()}}else{v="From "+startValue+" until "+endValue}}if(v!=null){m=$("<"+u+"/>").appendTo(l);m.addClass(r.Class);m.html(v)}return m};Control.DateTime.closeHandler=null;Control.DateTime.update=function Control$DateTime$update(b){Control.Text.update(b,null);if(Control.DateTime.closeHandler!=null){Control.DateTime.closeHandler()}};Control.ContactList={};Control.ContactList.placeHolder="Enter a contact";Control.ContactList.IsValid=function Control$LocationList$Valid(b){return(b!=null&&b.length>0&&b!=this.placeHolder)};Control.ContactList.renderInput=function Control$ContactList$renderInput(j,p,m,n){$input=$('<input type="text" />').appendTo(j);$input.addClass(m.Class);$input.data("item",p);$input.data("field",m);Control.Text.placeholder($input,Control.ContactList.placeHolder);n=(n==null)?Control.ContactList.update:n;$input.keypress(function(a){if(a.which==13){n($(a.srcElement));return false}});var r=p.GetFieldValue(m);var q="";if(r!=null&&r.IsList){var l=r.GetItems();for(var o in l){var k=l[o].GetFieldValue(FieldNames.EntityRef);if(k!=null){q+=k.Name}break}}$input.val(q);Control.Text.autoCompleteContact($input,n);return $input};Control.ContactList.update=function Control$ContactList$update(m,u){var v=m.data("item");var t=m.data("field");var p=m.val();if(p==null||p.length==0){v.RemoveReferences(t);return}var n;var w=m.data(FieldNames.Contacts);if(w!=null){n=$.parseJSON(w)}var x=v.GetParent();if(n!=null&&n.ItemTypeID==ItemTypes.Reference){var q={Name:n.Name,ID:n.FieldValues[0].Value};v.AddReference(t,q,true);if(x!=null&&x.IsActivity){x.AddReference(t,q,false)}if(u){u(n)}}else{if(n!=null){n=Item.Extend(n);var s=n.GetFieldValue(FieldNames.FacebookID);var r=DataModel.FindContact(n.Name,s);if(r!=null){v.AddReference(t,n,true);if(x!=null&&x.IsActivity){x.AddReference(t,r,false)}if(u){u(r)}return}}else{n=Item.Extend({Name:p,ItemTypeID:ItemTypes.Contact})}var o=DataModel.UserSettings.GetDefaultList(ItemTypes.Contact);DataModel.InsertItem(n,o,null,null,null,function(a){v.AddReference(t,a,true);if(x!=null&&x.IsActivity){x.AddReference(t,a,false)}if(u){u(a)}})}};Control.LocationList={};Control.LocationList.placeHolder="Enter a location";Control.LocationList.IsValid=function Control$LocationList$Valid(b){return(b!=null&&b.length>0&&b!=this.placeHolder)};Control.LocationList.renderInput=function Control$LocationList$renderInput(j,n,k,l){$input=$('<input type="text" />').appendTo(j);$input.addClass(k.Class);$input.data("item",n);$input.data("field",k);l=(l==null)?Control.LocationList.update:l;$input.keypress(function(a){if(a.which==13){l($(a.srcElement));return false}});var r=n.GetFieldValue(k);var q="";if(r!=null&&r.IsList){var p=r.GetItems();for(var m in p){var o=p[m].GetFieldValue(FieldNames.EntityRef);if(o!=null){q=o.Name}break}}$input.val(q);Control.Text.autoCompletePlace($input,l);return $input};Control.LocationList.update=function Control$LocationList$update(l,p){var q=l.data("item");var o=l.data("field");var m=l.val();if(!Control.LocationList.IsValid(m)){q.RemoveReferences(o);return}var u=q.GetParent();var r=l.data(FieldNames.LatLong);var v=l.data("place");if(v!=null&&v.geometry!=null){r=v.geometry.location.toUrlValue()}var n=DataModel.FindLocation(m,r);if(n!=null){q.AddReference(o,n,true);if(u!=null&&u.IsActivity){u.AddReference(o,n,false)}if(p){p(n)}}else{var s=DataModel.UserSettings.GetDefaultList(ItemTypes.Location);var t=Item.Extend({Name:m,ItemTypeID:ItemTypes.Location});if(v!=null&&v.geometry!=null){Control.Text.applyPlace(t,v)}else{t.SetFieldValue(FieldNames.Address,m);if(r!=null){t.SetFieldValue(FieldNames.LatLong,r)}}DataModel.InsertItem(t,s,null,null,null,function(a){q.AddReference(o,a,true);if(u!=null&&u.IsActivity){u.AddReference(o,a,false)}if(p){p(a)}})}};Control.List={};Control.List.sortable=function Control$List$sortable(b){b.sortable({axis:"y",handle:".drag-handle",stop:function(u,A){$("i").tooltip("hide");var a=A.item;var w=a.data("item");if(w!=null){var z=a.parent("ul").children("li");for(var v in z){var t=$(z[v]).data("item");if(t!=null&&w.ID==t.ID){var i=$(z[v]).prevAll("li").first();var y=(i.length==0)?null:i.data("item");var s=Number((y==null)?0:y.SortOrder);var e=$(z[v]).nextAll("li").first();var x=(e.length==0)?null:e.data("item");var r=Number((x==null)?s+1000:x.SortOrder);var B=w.Copy();B.SortOrder=s+((r-s)/2);w.Update(B);break}}}}})};var DataModel=function DataModel$(){};DataModel.Constants={};DataModel.User={};DataModel.Folders={};DataModel.Suggestions={};DataModel.GalleryCategories={};DataModel.ActionTypes={};DataModel.UserSettings;DataChangeTypes={Insert:"Insert",Update:"Update",Delete:"Delete"};DataModel.onDataChangedHandlers={};DataModel.timeStamp="/Date(0)/";DataModel.Init=function DataModel$Init(f,g){this.processConstants($.parseJSON(f));this.processUserData($.parseJSON(g));this.geoLocation=null;var h=DataModel.UserSettings.GetUserProfileItem();var e=h.GetFieldValue("GeoLocation");if(e!=null){e=e.split(",");DataModel.geoLocation=[parseFloat(e[0]),parseFloat(e[1])]}navigator.geolocation.getCurrentPosition(function(a){DataModel.geoLocation=[a.coords.latitude,a.coords.longitude]})};DataModel.Close=function DataModel$Close(){Service.Close();DataModel.UserSettings.Save()};DataModel.AddDataChangedHandler=function(e,c){this.onDataChangedHandlers[e]=c};DataModel.RemoveDataChangedHandler=function(b){delete this.onDataChangedHandlers[b]};DataModel.Refresh=function DataModel$Refresh(e){var c=DataModel.UserSettings.ViewState;Service.GetResource(Service.UsersResource,null,function(a){DataModel.processUserData(a.result);DataModel.UserSettings.ViewState=c;DataModel.restoreSelection();if(e!=null){e()}})};DataModel.FindItem=function DataModel$FindItem(g){if(g!=null){var e=DataModel.Folders[g];if(e!=null){return e}for(id in DataModel.Folders){e=DataModel.Folders[id];var f=e.Items[g];if(f!=null){return f}}}return null};DataModel.FindActionType=function DataModel$FindActionType(c){if(c!=null){var e=DataModel.ActionTypes[c];if(e!=null){return e}}return null};DataModel.FindLocation=function DataModel$FindLocation(g,l){for(id in DataModel.Folders){var h=DataModel.Folders[id];if(h.ItemTypeID==ItemTypes.Location){for(id in h.Items){var i=h.Items[id];if(i.ItemTypeID==ItemTypes.Location){var k=i.GetFieldValue(FieldNames.LatLong);if(l!=null&&k!=null){if(l==k){return i}}else{var j=i.GetFieldValue(FieldNames.Address);if(g==j){return i}}}}}}return null};DataModel.FindContact=function DataModel$FindContact(j,f){for(id in DataModel.Folders){var g=DataModel.Folders[id];if(g.ItemTypeID==ItemTypes.Contact){for(id in g.Items){var h=g.Items[id];if(h.ItemTypeID==ItemTypes.Contact){var i=h.GetFieldValue(FieldNames.FacebookID);if(f!=null&&i!=null){if(f==i){return h}}else{if(j==h.Name){return h}}}}}}return null};DataModel.GetItems=function DataModel$GetItems(k,p,i,l){var o={};var j=(typeof(k)=="object")?k:DataModel.Folders[k];if(j!=undefined){if(i!=true){for(var m in j.Items){var n=j.Items[m];if(n.ParentID==p&&n.IsList){o[m]=j.Items[m]}}}if(l===undefined){for(var m in j.Items){var n=j.Items[m];if(n.ParentID==p&&!n.IsList){o[m]=j.Items[m]}}}else{for(var m in j.Items){var n=j.Items[m];if(n.ParentID==p&&!n.IsList&&l==n.Group){o[m]=j.Items[m]}}}}return o};DataModel.InsertItem=function DataModel$InsertItem(q,m,k,n,j,l){if(q!=null&&q.Name!=null){var r=Service.ItemsResource;if(m==null){r=Service.FoldersResource}else{if(m.IsFolder()){q.FolderID=m.ID;q.ParentID=null;q.ItemTypeID=(q.ItemTypeID==null)?m.ItemTypeID:q.ItemTypeID}else{if(m.IsList!=null&&m.IsList){q.FolderID=m.FolderID;q.ParentID=m.ID;q.ItemTypeID=(q.ItemTypeID==null)?m.ItemTypeID:q.ItemTypeID}else{return false}}}if(k==null){if(m==null){var o=DataModel.FoldersMap.itemAt(-1);q.SortOrder=(o==null)?1000:o.SortOrder+1000}else{var p=ItemMap.itemAt(m.GetItems(),-1);q.SortOrder=(p==null)?1000:p.SortOrder+1000}}if(q.ID==null){q.ID=Math.uuid()}delete q.Created;if(m==null){q=DataModel.addFolder(q,j)}else{m.addItem(q,j)}Service.InsertResource(r,q,function(b){var a=b.result;if(a.ItemTypeID==ItemTypes.Step){q.update(a)}else{q.update(a,null)}if(l!=null){l(a)}});return true}return false};DataModel.InsertFolder=function DataModel$InsertFolder(g,e,f){return DataModel.InsertItem(g,null,e,f)};DataModel.UpdateItem=function DataModel$UpdateItem(h,j,f){if(h!=null&&j!=null){h.update(j,f);j.LastModified=DataModel.timeStamp;var i=(h.IsFolder())?Service.FoldersResource:Service.ItemsResource;var g=[h,j];if(i==Service.FoldersResource){g=[h.Copy(),j]}Service.UpdateResource(i,h.ID,g,function(a){var b=a.result;if(b.ItemTypeID==ItemTypes.Step){var c=h.update(b)}else{var c=h.update(b,null)}});return true}return false};DataModel.DeleteItem=function DataModel$DeleteItem(l,j){if(l!=null){if(l.IsFolder()){DataModel.FoldersMap.remove(l);DataModel.fireDataChanged(null,null,DataChangeTypes.Delete)}else{var o=l.GetParent();if(o!=null&&o.ItemTypeID==ItemTypes.Reference){l.GetFolder().ItemsMap.remove(l)}else{if(j!=null){var i=j.IsFolder()?j.ID:j.FolderID;var k=j.IsFolder()?null:j.ID;l.GetFolder().ItemsMap.remove(l);DataModel.deleteReferences(l.ID);DataModel.fireDataChanged(i,k,DataChangeTypes.Delete)}else{var m=l.selectNextItem();var n=(m==null)?null:m.ID;l.GetFolder().ItemsMap.remove(l);DataModel.deleteReferences(l.ID);DataModel.fireDataChanged(l.FolderID,n,DataChangeTypes.Delete)}}}var p=(l.IsFolder())?Service.FoldersResource:Service.ItemsResource;Service.DeleteResource(p,l.ID,l,function(b){var a=b.result});return true}return false};DataModel.GetGalleryCategories=function DataModel$GetGalleryCategories(e,c){if(c==null){c="system"}Service.GetResource(Service.GalleryResource,c,function(b){var a=b.result;if(a.length>0){DataModel.GalleryCategoriesRetrieved=new Date()}DataModel.processGalleryCategories(a);if(e!=null){e(DataModel.GalleryCategories)}})};DataModel.GetSuggestions=function DataModel$GetSuggestions(h,e,f){var g={};if(e==null){e=DataModel.User}g.EntityID=e.ID;g.FieldName=f;g.EntityType=EntityTypes.User;if(e.hasOwnProperty("ItemTypeID")){g.EntityType=(e.hasOwnProperty("FolderID"))?EntityTypes.Item:EntityTypes.Folder}Service.InsertResource(Service.SuggestionsResource,g,function(a){var b=a.result;if(b.length>0){DataModel.SuggestionsRetrieved=new Date()}DataModel.processSuggestions(b);if(h!=null){h(DataModel.Suggestions)}})};DataModel.SelectSuggestion=function DataModel$SelectSuggestion(j,h,g){h=(h==null)?Reasons.Chosen:h;var i=$.extend({},j);i.TimeSelected=DataModel.timeStamp;i.ReasonSelected=h;var f=[j,i];Service.UpdateResource(Service.SuggestionsResource,j.ID,f,function(a){var b=a.result;if(g!=null){g(i)}})};DataModel.RemoveSuggestion=function DataModel$RemoveSuggestion(e){var c=DataModel.Suggestions[e.GroupID];if(c!=null){delete c.Suggestions[e.ID]}};DataModel.fireDataChanged=function(g,i,f){if(DataModel.UserSettings.GetFolder(g)==null){for(var j in DataModel.onDataChangedHandlers){var h=DataModel.onDataChangedHandlers[j];if(typeof(h)=="function"){h(g,i,f)}}}};DataModel.getFolder=function(e){var c=DataModel.Folders[e];if(c==null){c=DataModel.UserSettings.GetFolder(e)}return c};DataModel.addFolder=function(e,c){e=Folder.Extend(e);if(e.ItemsMap==null){e.ItemsMap=new ItemMap([]);e.Items=e.ItemsMap.Items}DataModel.FoldersMap.append(e);if(c===undefined){DataModel.fireDataChanged(e.ID,null,DataChangeTypes.Insert)}else{if(c!=null){DataModel.fireDataChanged(c.FolderID,c.ID,DataChangeTypes.Insert)}}return e};DataModel.deleteReferences=function(n){for(var h in DataModel.Folders){var i=DataModel.Folders[h];for(var l in i.Items){var m=i.Items[l];if(m.ItemTypeID==ItemTypes.Reference){for(var k in m.FieldValues){var j=m.FieldValues[k];if(j.FieldName==FieldNames.EntityRef&&j.Value==n){m.GetFolder().ItemsMap.remove(m)}}}}}};DataModel.processConstants=function DataModel$processConstants(r){var i={};for(var s in r){i[s]=r[s]}var p=i.ItemTypes;for(var n in p){var o=ItemType.Extend(p[n]);var m={};for(var q in o.Fields){var j=o.Fields[q];j.ClassName="fn-"+j.Name.toLowerCase();j.Class=j.ClassName+" dt-"+j.DisplayType.toLowerCase();m[j.Name]=j}o.Fields=m;p[n]=o}i.ItemTypesMap=new ItemMap(p);i.ItemTypes=i.ItemTypesMap.Items;i.PrioritiesByName={};for(var n in i.Priorities){var t=i.Priorities[n];i.PrioritiesByName[t.Name]=t}DataModel.Constants=i};DataModel.processUserData=function DataModel$processUserData(e){var h={};for(var f in e){h[f]=e[f]}var g={};g.ID=h.ID;g.Name=h.Name;g.Email=h.Email;g.CreateDate=h.CreateDate;DataModel.User=g;DataModel.processFolders(h.Folders);DataModel.processActionTypes(DataModel.Constants.ActionTypes)};DataModel.processSuggestions=function DataModel$processSuggestions(t){var x={};var n=[];var r={};var u=0;for(var s in t){var w=t[s];if(w.ParentID==null){var q=w.GroupDisplayName;var p=r[q];if(p===undefined){p=(w.GroupDisplayName==SuggestionTypes.RefreshEntity)?w.GroupDisplayName:"Group_"+(u++).toString();r[q]=p;x[p]={GroupID:p,DisplayName:w.GroupDisplayName,Suggestions:{}}}w.GroupID=p;x[p].Suggestions[w.ID]=w}else{n.push(w)}}for(s in n){var i=n[s];for(p in x){var o=x[p];var v=o.Suggestions[i.ParentID];if(v!=null){if(v.Suggestions==null){v.Suggestions={}}v.Suggestions[i.ID]=i;break}}}DataModel.Suggestions=x};DataModel.processFolders=function DataModel$processFolders(k){var j,p;for(var l in k){k[l]=Folder.Extend(k[l]);var m=k[l].Items;for(var n in m){m[n]=Item.Extend(m[n])}k[l].ItemsMap=new ItemMap(m);k[l].Items=k[l].ItemsMap.Items;if(k[l].Name==SystemFolders.Client){j=l}if(k[l].Name==SystemFolders.WebClient){p=l}}var i=k.splice(j,1)[0];if(p==null){DataModel.UserSettings=new UserSettings(i);Service.InsertResource(Service.FoldersResource,{Name:SystemFolders.WebClient,ItemTypeID:ItemTypes.NameValue,SortOrder:0},function(a){var b=a.result;b=Folder.Extend(b);DataModel.UserSettings=new UserSettings(i,b)})}else{if(p>j){p--}var o=k.splice(p,1)[0];DataModel.UserSettings=new UserSettings(i,o)}DataModel.FoldersMap=new ItemMap(k);DataModel.Folders=DataModel.FoldersMap.Items};DataModel.processActionTypes=function DataModel$processActionTypes(c){var c={};for(var e in ActionTypes){c[e]=ActionType.Extend({Name:ActionTypes[e],ID:ActionTypes[e]})}DataModel.ActionTypesMap=new ItemMap(c);DataModel.ActionTypes=DataModel.ActionTypesMap.Items};DataModel.processGalleryCategories=function DataModel$processGalleryCategories(g){for(var i in g){var h=GalleryCategory.Extend(g[i]);g[i]=h;var f=h.Activities;for(var j in f){f[j]=GalleryActivity.Extend(f[j])}h.ActivitiesMap=new ItemMap(f);h.Activities=h.ActivitiesMap.Items}DataModel.GalleryCategoriesMap=new ItemMap(g);DataModel.GalleryCategories=DataModel.GalleryCategoriesMap.Items};DataModel.restoreSelection=function DataModel$restoreSelection(g){if(g===undefined&&DataModel.UserSettings!=null){g=DataModel.UserSettings.ViewState.SelectedItem}if(g!=null){var f=DataModel.FindItem(g);if(f!=null){DataModel.fireDataChanged(f.FolderID,f.ID);return}}var e=DataModel.UserSettings.ViewState.SelectedFolder;if(e!=null){DataModel.fireDataChanged(e);return}DataModel.fireDataChanged()};function Folder(){}Folder.Extend=function Folder$Extend(b){return $.extend(new Folder(),b)};Folder.prototype.Copy=function(){var b=$.extend(new Folder(),this);b.Items={};b.ItemsMap={};return b};Folder.prototype.IsFolder=function(){return true};Folder.prototype.IsCategory=function(){return(this.ItemTypeID==ItemTypes.Category)};Folder.prototype.IsActivity=function(){return(this.ItemTypeID==ItemTypes.Activity)};Folder.prototype.IsRunning=function(){return false};Folder.prototype.IsDefault=function(){var b=DataModel.UserSettings.GetDefaultList(this.ItemTypeID);if(b!=null){return(b.IsFolder())?(this.ID==b.ID):(this.ID==b.FolderID)}return false};Folder.prototype.IsSelected=function(){return DataModel.UserSettings.IsFolderSelected(this.ID)};Folder.prototype.IsExpanded=function(){return DataModel.UserSettings.IsFolderExpanded(this.ID)};Folder.prototype.Expand=function(b){DataModel.UserSettings.ExpandFolder(this.ID,b)};Folder.prototype.GetItemType=function(){return DataModel.Constants.ItemTypes[this.ItemTypeID]};Folder.prototype.GetItems=function(c,e){return DataModel.GetItems(this,null,c,e)};Folder.prototype.GetItem=function(b){return this.Items[b]};Folder.prototype.GetItemByName=function(f,g){for(id in this.Items){var e=this.Items[id];if(e.Name==f){if(g===undefined||e.ParentID==g){return e}}}return null};Folder.prototype.GetItemByValue=function(g,f){for(id in this.Items){var e=this.Items[id];if(e.ItemTypeID==ItemTypes.NameValue||e.ItemTypeID==ItemTypes.Reference){if(g==e.GetFieldValue(FieldNames.Value)&&(f===undefined||e.ParentID==f)){return e}}}return null};Folder.prototype.GetSelectedItem=function(){for(id in this.Items){if(DataModel.UserSettings.IsItemSelected(id)==true){return this.Items[id]}}return null};Folder.prototype.InsertItem=function(h,f,g,e){return DataModel.InsertItem(h,this,f,g,e)};Folder.prototype.Update=function(b){return DataModel.UpdateItem(this,b)};Folder.prototype.Delete=function(){return DataModel.DeleteItem(this)};Folder.prototype.addItem=function(g,e){g=Item.Extend(g);if(this.ItemsMap==null){this.ItemsMap=new ItemMap([g]);this.Items=this.ItemsMap.Items}else{this.ItemsMap.append(g)}if(e===undefined){var f=(g.IsList)?g.ID:g.ID;DataModel.fireDataChanged(this.ID,f,DataChangeTypes.Insert)}else{if(e!=null){DataModel.fireDataChanged(e.FolderID,e.ID,DataChangeTypes.Insert)}}};Folder.prototype.update=function(b){if(this.ID==b.ID){b=Folder.Extend(b);b.ItemsMap=this.ItemsMap;b.Items=this.ItemsMap.Items;b.FolderUsers=this.FolderUsers;DataModel.FoldersMap.update(b);DataModel.Folders=DataModel.FoldersMap.Items;DataModel.fireDataChanged(this.ID,null,DataChangeTypes.Insert);return true}return false};function Item(){}Item.Extend=function Item$Extend(b){return $.extend(new Item(),b)};Item.prototype.Copy=function(){var e=this.GetFolder();var c=(e==null)?this:e.GetItem(this.ID);return $.extend(true,new Item(),(c==null)?this:c)};Item.prototype.IsFolder=function(){return false};Item.prototype.IsDefault=function(){var b=DataModel.UserSettings.GetDefaultList(this.ItemTypeID);if(b!=null){return(this.ID==b.ID)}return false};Item.prototype.Select=function(){return DataModel.UserSettings.Selection(this.FolderID,this.ID)};Item.prototype.IsSelected=function(b){return DataModel.UserSettings.IsItemSelected(this.ID,b)};Item.prototype.GetFolder=function(){return(DataModel.getFolder(this.FolderID))};Item.prototype.GetParent=function(){return(this.ParentID==null)?null:this.GetFolder().Items[this.ParentID]};Item.prototype.GetParentContainer=function(){return(this.ParentID==null)?this.GetFolder():this.GetParent()};Item.prototype.GetItemType=function(){return DataModel.Constants.ItemTypes[this.ItemTypeID]};Item.prototype.GetItems=function(c,e){return DataModel.GetItems(this.FolderID,this.ID,c,e)};Item.prototype.InsertItem=function(h,f,g,e){return DataModel.InsertItem(h,this,f,g,e)};Item.prototype.Update=function(e,c){return DataModel.UpdateItem(this,e,c)};Item.prototype.Delete=function(b){return DataModel.DeleteItem(this,b)};Item.prototype.HasField=function(b){return this.GetItemType().HasField(b)};Item.prototype.HasExtendedField=function(e){for(var c in this.FieldValues){if(this.FieldValues[c].FieldName==e){return true}}return false};Item.prototype.GetField=function(b){return this.GetItemType().Fields[b]};Item.prototype.GetFields=function(){return this.GetItemType().Fields};Item.prototype.Refresh=function(){var b=this;Service.GetResource(Service.ItemsResource,this.ID,function(e){var a=e.result;if(a!=null){b.update(a,null)}})};Item.prototype.GetFieldValue=function(h,j){if(typeof(h)=="string"){var f=this.GetField(h);if(f==null){f={Name:h,FieldType:FieldTypes.String}}h=f}if(h!=null&&(this.HasField(h.Name)||this.HasExtendedField(h.Name))){if(h.Name==FieldNames.Name){return this.Name}if(h.Name==FieldNames.Complete){return(this.Status==StatusTypes.Complete)}for(var k in this.FieldValues){var i=this.FieldValues[k];if(i.FieldName==h.Name){if(i.Value!=null&&h.FieldType==FieldTypes.Guid){var l=DataModel.FindItem(i.Value);if(l!=null){return l}}if(h.FieldType==FieldTypes.Boolean){if(typeof(i.Value)=="string"){i.Value=(i.Value.toLowerCase()=="true")}}if(h.FieldType==FieldTypes.DateTime){if(typeof(i.Value)=="string"){i.Value=new Date().parseSafe(i.Value)}}return i.Value}}if(h.FieldType=="Boolean"){return false}return null}return undefined};Item.prototype.SetFieldValue=function(h,l){if(typeof(h)=="string"){var f=this.GetField(h);if(f==null){f={Name:h,FieldType:FieldTypes.String}}h=f}if(h!=null){if(h.Name==FieldNames.Name){this.Name=l;return true}if(h.Name==FieldNames.Complete){this.Status=(l==true)?StatusTypes.Complete:null;return true}if(h.FieldType==FieldTypes.DateTime||typeof(l)=="date"){l=Date.formatUTC(l)}if(this.FieldValues==null){this.FieldValues=[]}var k=false;for(var j in this.FieldValues){var i=this.FieldValues[j];if(i.FieldName==h.Name){i.Value=l;k=true;break}}if(!k){this.FieldValues=this.FieldValues.concat({FieldName:h.Name,ItemID:this.ID,Value:l})}return true}return false};Item.prototype.AddReference=function(g,h,k){if(typeof(g)=="string"){g=this.GetField(g)}if(g!=null&&this.HasField(g.Name)&&g.FieldType==FieldTypes.Guid){var j=this.GetFieldValue(g);if(j!=null){if(k==true){return this.replaceReference(j,h)}else{return this.addReference(j,h,true)}}else{var l=this;var i={Name:g.Name,IsList:true,ItemTypeID:ItemTypes.Reference,FolderID:l.FolderID,ParentID:l.ID,UserID:l.UserID};Service.InsertResource(Service.ItemsResource,i,function(b){var a=b.result;l.addItem(a,null);a=DataModel.FindItem(a.ID);l.addReference(a,h);var c=$.extend({},l);c.SetFieldValue(g.Name,a.ID);l.Update(c)})}return true}return false};Item.prototype.RemoveReferences=function(f){if(typeof(f)=="string"){f=this.GetField(f)}if(f!=null&&this.HasField(f.Name)&&f.FieldType==FieldTypes.Guid){var j=this.GetFieldValue(f);if(j!=null&&j.IsList){var i=j.GetItems();for(var g in i){var h=i[g];h.Delete()}}return true}return false};Item.prototype.IsLocation=function(){return(this.ItemTypeID==ItemTypes.Location)};Item.prototype.IsContact=function(){return(this.ItemTypeID==ItemTypes.Contact)};Item.prototype.GetLocation=function(){var g=this.GetFieldValue(FieldNames.Locations);if(g!=null){var f=DataModel.GetItems(g.FolderID,g.ID,true);for(var e in f){return f[e].GetFieldValue(FieldNames.EntityRef)}}var h=this.GetParent();if(h!=null){g=h.GetFieldValue(FieldNames.Locations);if(g!=null){f=DataModel.GetItems(g.FolderID,g.ID,true);for(var e in f){return f[e].GetFieldValue(FieldNames.EntityRef)}}}return null};Item.prototype.GetContact=function(){var g=this.GetFieldValue(FieldNames.Contacts);if(g!=null){var f=DataModel.GetItems(g.FolderID,g.ID,true);for(var e in f){return f[e].GetFieldValue(FieldNames.EntityRef)}}var h=this.GetParent();if(h!=null){g=h.GetFieldValue(FieldNames.Locations);if(g!=null){f=DataModel.GetItems(g.FolderID,g.ID,true);for(var e in f){return f[e].GetFieldValue(FieldNames.EntityRef)}}}return null};Item.prototype.GetPhoneNumber=function(){if(this.HasField(FieldNames.Phone)){return this.GetFieldValue(FieldNames.Phone)}if(this.IsActivity()||this.IsStep()){var c=this.GetLocation();if(c!=null){var e=c.GetFieldValue(FieldNames.Phone);if(e!=null){return e}}c=this.GetContact();if(c!=null){return c.GetFieldValue(FieldNames.Phone)}}return null};Item.prototype.GetEmail=function(){if(this.HasField(FieldNames.Email)){return this.GetFieldValue(FieldNames.Email)}if(this.IsActivity()||this.IsStep()){var c=this.GetLocation();if(c!=null){var e=c.GetFieldValue(FieldNames.Email);if(e!=null){return e}}c=this.GetContact();if(c!=null){return c.GetFieldValue(FieldNames.Email)}}return null};Item.prototype.GetMapLink=function(){var e=function(c){if(c!=null){var a=c.GetFieldValue(FieldNames.Address);if(a!=null){if(Browser.IsMobile()){return"maps:"+escape(a)}else{return"http://maps.google.com/?q="+escape(a)}}var i=c.GetFieldValue(FieldNames.WebLinks);if(i!=null&&i.length>0){var l=new LinkArray(i).Links();for(var b in l){var k=l[b];if(k.Name=="Map"&&k.Url!=null){return k.Url}}}}};if(this.HasField(FieldNames.Address)){return e(this)}if(this.HasField(FieldNames.Locations)){var f=this.GetLocation();if(f!=null){var g=e(f);if(g!=null){return g}}f=this.GetContact();if(f!=null){return e(f)}}return null};Item.prototype.UpdateStatus=function(g,e){var f=this.Copy();f.Status=g;return this.Update(f,e)};Item.prototype.IsStopped=function(){return(this.Status==StatusTypes.Stopped)};Item.prototype.IsActive=function(){return(this.Status==StatusTypes.Active)};Item.prototype.IsComplete=function(){return(this.Status==StatusTypes.Complete)};Item.prototype.IsCompleted=function(){return(this.Group!=null)};Item.prototype.IsPaused=function(){return(this.Status==StatusTypes.Paused)};Item.prototype.IsSkipped=function(){return(this.Status==StatusTypes.Skipped)};Item.prototype.IsRunning=function(){return !(this.IsStopped()||this.IsPaused())};Item.prototype.StatusClass=function(){return((this.IsCompleted())?"st-completed":(this.IsStopped())?"st-stopped":("st-"+this.Status.toLowerCase()))};Item.prototype.IsCategory=function(){return(this.ItemTypeID==ItemTypes.Category)};Item.prototype.IsActivity=function(){return(this.ItemTypeID==ItemTypes.Activity)};Item.prototype.IsStep=function(){return(this.ItemTypeID==ItemTypes.Step)};Item.prototype.GetActionType=function(){var e=this.GetFieldValue(FieldNames.ActionType);if(e==null){e=ActionTypes.Reminder}var c=DataModel.FindActionType(e);if(c==null){c=DataModel.FindActionType(ActionTypes.Reminder)}return c};Item.prototype.CanResume=function(){var v={Start:false,Resume:false,Restart:false};var x=this.GetItems(true,null);if(ItemMap.count(x)==0){var q=this.GetFieldValue(FieldNames.DueDate);var p=this.GetFieldValue(FieldNames.CompletedOn);var s=(q!=null&&q.length>0);var r=(p!=null&&p.length>0);v.Start=!s;v.Resume=s&&!r;v.Restart=s&&r;return v}var n=true;var o=true;var m=true;var u=0;for(var t in x){var w=x[t];if(!w.IsStopped()){n=false}if(w.IsPaused()){u++}if(u==0&&!(w.IsComplete()||w.IsSkipped())){m=false}if(u==1&&w.IsRunning()){o=false}}v.Start=n;v.Resume=(u<2&&m&&o);v.Restart=!v.Start;return v};Item.prototype.Complete=function(){var j=new Date().format();var f=this.Copy();f.Status=StatusTypes.Complete;if(f.HasField(FieldNames.CompletedOn)){f.SetFieldValue(FieldNames.CompletedOn,j)}var g=this.nextItem();if(g!=null&&g.IsStep()){this.Update(f,null);g.Active(this.GetFieldValue(FieldNames.DueDate))}else{if(this.IsStep()){var h=this.GetParent();if(h!=null&&h.IsActivity()){var i=h.Copy();i.Status=StatusTypes.Complete;i.SetFieldValue(FieldNames.CompletedOn,j);this.Update(f,null);h.Update(i);h.Repeat()}}else{this.Update(f)}}};Item.prototype.Skip=function(){var j=new Date().format();var f=this.Copy();f.Status=StatusTypes.Skipped;if(f.HasField(FieldNames.CompletedOn)){f.SetFieldValue(FieldNames.CompletedOn,j)}var g=this.nextItem();if(g!=null&&g.IsStep()){this.Update(f,null);g.Active(this.GetFieldValue(FieldNames.DueDate))}else{if(this.IsStep()){var h=this.GetParent();if(h!=null&&h.IsActivity()){var i=h.Copy();i.Status=StatusTypes.Complete;i.SetFieldValue(FieldNames.CompletedOn,j);this.Update(f,null);h.Update(i);h.Repeat()}}else{this.Update(f)}}};Item.prototype.Pause=function(){var g=this.GetItems(true,null);for(var e in g){var f=g[e];if(f.IsActive()){f.UpdateStatus(StatusTypes.Paused,null);break}}this.UpdateStatus(StatusTypes.Paused)};Item.prototype.Start=function(b){return this.Active(b)};Item.prototype.Active=function(k){var n=this.GetItems(true,null);if(ItemMap.count(n)==0){var i=(k!=null)?k:this.GetFieldValue(FieldNames.DueDate);if(i==null||i.length==0){return this}else{var h=this.Copy();h.Status=StatusTypes.Active;h.SetFieldValue(FieldNames.DueDate,i);this.Update(h);return null}}var l=null;for(var j in n){var m=n[j];if(m.IsPaused()){if(m.GetFieldValue(FieldNames.DueDate)!=null){m.UpdateStatus(StatusTypes.Active,null);this.UpdateStatus(StatusTypes.Active);return null}else{m.Status=StatusTypes.Stopped}}if(m.IsStopped()){var i=(k!=null)?k:m.GetFieldValue(FieldNames.DueDate);if(i==null||i.length==0){if(l!=null){i=l.GetFieldValue(FieldNames.DueDate)}else{i=this.GetFieldValue(FieldNames.DueDate)}}if(i!=null&&(i.length>0||typeof(i)=="object")){var h=m.Copy();h.Status=StatusTypes.Active;h.SetFieldValue(FieldNames.DueDate,i);m.Update(h,null);this.UpdateStatus(StatusTypes.Active);return null}else{return m}}l=m}this.UpdateStatus(StatusTypes.Complete);return null};Item.prototype.Restart=function(){var h=this.GetItems(true,null);if(ItemMap.count(h)==0){var e=this.Copy();e.SetFieldValue(FieldNames.DueDate,null);e.SetFieldValue(FieldNames.CompletedOn,null);this.Update(e,null);return e.Active()}else{for(var f in h){var g=h[f];var e=g.Copy();e.Status=null;e.SetFieldValue(FieldNames.DueDate,null);g.Update(e,null)}}return this.Active()};Item.prototype.Repeat=function(){var t=Recurrence.Extend(this.GetFieldValue(FieldNames.Repeat));if(t.IsEnabled()){var o=new Date();if(this.IsComplete()){o=this.GetFieldValue(FieldNames.CompletedOn)}var p=t.NextDueDate(o);if(!this.IsComplete()){}var u=this.GetItems(true,null);var s=[];for(var n in u){var r=u[n].Copy();r.ID=null;r.Status=StatusTypes.Stopped;r.SetFieldValue(FieldNames.DueDate,null);s.push(r)}var v=new Date().toUTCString();for(var n in u){var i=u[n].Copy();i.Group=v;u[n].Update(i,null)}s[0].Status=StatusTypes.Active;s[0].SetFieldValue(FieldNames.DueDate,p);var q=s[s.length-1].SortOrder+1;for(var m in s){s[m].SortOrder=q++;this.InsertItem(s[m],null,null,null)}this.UpdateStatus(StatusTypes.Active)}};Item.prototype.addItem=function(e,c){this.GetFolder().addItem(e,c)};Item.prototype.update=function(g,e){if(this.ID==g.ID){g=Item.Extend(g);var f=this.GetFolder();if(this.FolderID==g.FolderID){f.ItemsMap.update(g);f.Items=f.ItemsMap.Items}else{f.ItemsMap.remove(this);g.GetFolder().ItemsMap.append(g)}if(e===undefined){DataModel.fireDataChanged(this.FolderID,this.ID,DataChangeTypes.Update)}else{if(e!=null){DataModel.fireDataChanged(this.FolderID,e.ID,DataChangeTypes.Update)}}return true}return false};Item.prototype.nextItem=function(){var g=this.GetParent();var h=(g==null)?this.GetFolder().GetItems():g.GetItems();var e=ItemMap.indexOf(h,this.ID);var f=ItemMap.itemAt(h,e+1);return f};Item.prototype.selectNextItem=function(){var h=this.GetParent();var i=(h==null)?this.GetFolder().GetItems():h.GetItems();var f=ItemMap.indexOf(i,this.ID);var g=ItemMap.itemAt(i,f+1);if(g!=null){return g}else{if(f==0){if(h!=null){return h}}else{var j=ItemMap.itemAt(i,f-1);if(j!=null){return j}}}return null};Item.prototype.addReference=function(n,l,h){if(n.IsList){if(h){var k=n.GetItems();for(var i in k){var j=k[i];var m=j.GetFieldValue(FieldNames.EntityRef);if(m.ID==l.ID){return false}}}var j=Item.Extend({Name:l.Name,ItemTypeID:ItemTypes.Reference,FolderID:n.FolderID,ParentID:n.ID,UserID:n.UserID});j.SetFieldValue(FieldNames.EntityRef,l.ID);j.SetFieldValue(FieldNames.EntityType,EntityTypes.Item);n.InsertItem(j,null,null,null);return true}return false};Item.prototype.replaceReference=function(k,j){if(k.IsList){var i=k.GetItems();for(var g in i){var h=i[g];var l=h.Copy();l.SetFieldValue(FieldNames.EntityRef,j.ID);h.Update(l,k.GetParent());return true}return this.addReference(k,j)}return false};function ItemType(){}ItemType.Extend=function ItemType$Extend(b){return $.extend(new ItemType(),b)};ItemType.prototype.HasField=function(b){return(this.Fields.hasOwnProperty(b))};function ItemMap(b){this.array=(b==null)?[]:b;this.updateMap()}ItemMap.prototype.updateMap=function(){this.Items={};for(var b in this.array){if(this.array[b].hasOwnProperty("ID")){this.Items[this.array[b].ID]=this.array[b]}else{throw ItemMap.errorMustHaveID}}};ItemMap.prototype.indexOf=function(e){for(var c in this.array){if(this.array[c].ID==e.ID){return c}}return -1};ItemMap.prototype.itemAt=function(b){if(b<0){return this.array[this.array.length-1]}if(b<this.array.length){return this.array[b]}return null};ItemMap.prototype.append=function(b){if(b.hasOwnProperty("ID")){this.array=this.array.concat(b);this.Items[b.ID]=this.array[this.array.length-1]}else{throw ItemMap.errorMustHaveID}};ItemMap.prototype.update=function(h){if(h.hasOwnProperty("ID")){var g=this.indexOf(h);var e=this.itemAt(g);if(h.hasOwnProperty("SortOrder")&&e.hasOwnProperty("SortOrder")&&(h.SortOrder!=e.SortOrder)){this.array.splice(g,1);for(var f in this.array){if(this.array[f].hasOwnProperty("SortOrder")&&h.SortOrder<this.array[f].SortOrder){this.array.splice(f,0,h);this.updateMap();return}}this.array.push(h);this.updateMap()}else{this.array[g]=h;this.Items[h.ID]=this.array[g]}}else{throw ItemMap.errorMustHaveID}};ItemMap.prototype.remove=function(e){if(e.hasOwnProperty("ID")){var c=this.indexOf(e);if(c>=0){this.array.splice(c,1);delete this.Items[e.ID]}}else{throw ItemMap.errorMustHaveID}};ItemMap.count=function(g){var e=0,f;for(f in g){if(g.hasOwnProperty(f)){e++}}return e};ItemMap.indexOf=function(j,g){var h=-1,f=0;for(var i in j){if(i==g){h=f;break}f++}return h};ItemMap.itemAt=function(h,e){for(var g in h){var f=h[g];if(e--==0){return f}}return(e<0)?f:null};ItemMap.itemByName=function(f,g){for(var e in f){if(f[e].Name==g){return f[e]}}return null};ItemMap.errorMustHaveID="ItemMap requires all items in array to have an ID property.";var ItemTypes={Category:"00000000-0000-0000-0000-000000000007",Activity:"00000000-0000-0000-0000-000000000001",Step:"00000000-0000-0000-0000-000000000002",Contact:"00000000-0000-0000-0000-000000000003",Location:"00000000-0000-0000-0000-000000000004",System:"00000000-0000-0000-0000-000000000000",Reference:"00000000-0000-0000-0000-000000000005",NameValue:"00000000-0000-0000-0000-000000000006"};var FieldNames={Name:"Name",Description:"Description",Repeat:"Repeat",Complete:"Complete",CompletedOn:"CompletedOn",DueDate:"DueDate",EndDate:"EndDate",ActionType:"ActionType",Birthday:"Birthday",Address:"Address",WebLink:"WebLink",WebLinks:"WebLinks",Email:"Email",Phone:"Phone",HomePhone:"HomePhone",WorkPhone:"WorkPhone",Amount:"Amount",Cost:"Cost",ItemTags:"ItemTags",EntityRef:"EntityRef",EntityType:"EntityType",Contacts:"Contacts",Locations:"Locations",Value:"Value",Category:"Category",LatLong:"LatLong",FacebookID:"FacebookID",Sources:"Sources",Gender:"Gender",Picture:"Picture"};var ExtendedFieldNames={Intent:"Intent",SubjectHint:"SubjectHint",Article:"Article",CalEventID:"CalEventID",SelectedCount:"SelectedCount",SortBy:"SortBy"};var EntityTypes={User:"User",Folder:"Folder",Item:"Item"};var FieldTypes={String:"String",Boolean:"Boolean",Integer:"Integer",DateTime:"DateTime",Phone:"Phone",Email:"Email",Url:"Url",Address:"Address",Currency:"Currency",TagIDs:"TagIDs",Guid:"Guid",JSON:"JSON"};var DisplayTypes={Hidden:"Hidden",Text:"Text",TextArea:"TextArea",Checkbox:"Checkbox",DatePicker:"DatePicker",DateTimePicker:"DateTimePicker",Phone:"Phone",Email:"Email",Link:"Link",Currency:"Currency",Address:"Address",Priority:"Priority",TagList:"TagList",Reference:"Reference",Contact:"Contact",ContactList:"ContactList",LocationList:"LocationList",LinkArray:"LinkArray",Gender:"Gender"};var SuggestionTypes={ChooseOne:"ChooseOne",ChooseOneSubject:"ChooseOneSubject",ChooseMany:"ChooseMany",ChooseManyWithChildren:"ChooseManyWithChildren",GetFBConsent:"GetFBConsent",GetGoogleConsent:"GetGoogleConsent",GetADConsent:"GetADConsent",NavigateLink:"NavigateLink",RefreshEntity:"RefreshEntity"};var Reasons={Chosen:"Chosen",Ignore:"Ignore",Like:"Like",Dislike:"Dislike"};var StatusTypes={Active:"Active",Complete:"Complete",Paused:"Paused",Skipped:"Skipped",Stopped:null};var Sources={Directory:"Directory",Facebook:"Facebook",Local:"Local"};var SystemFolders={Client:"$Client",WebClient:"$WebClient"};var UserEntities={Inbox:"Inbox",People:"People",Places:"Places",Personal:"Personal",Home:"Home",Auto:"Auto",Finance:"Finance"};var SystemUsers={System:"00000000-0000-0000-0000-000000000001",User:"00000000-0000-0000-0000-000000000002"};var ActionTypes={All:"All",Reminder:"Reminder",Call:"Call",Schedule:"Add to calendar",Errand:"Errand",SendEmail:"Email",TextMessage:"Text",AskFriends:"Ask on Facebook",Find:"Find local business"};function ActionType(){}ActionType.Extend=function ActionType$Extend(b){return $.extend(new ActionType(),b)};ActionType.prototype.Copy=function(){var b=$.extend(new ActionType(),this);return b};ActionType.prototype.GetSteps=function(o,p){if(p===undefined){p=StatusTypes.Active}var q=[];var l=0;for(var j in DataModel.Folders){var i=DataModel.Folders[j];for(var n in i.Items){var m=i.Items[n];if(m.IsStep()){if(this.Name==ActionTypes.All||this.Name==m.GetActionType().Name){if(m.Status==p){q[l++]=m}}}}}q.sort(function(a,b){var c=a.GetFieldValue(FieldNames.DueDate);var e=b.GetFieldValue(FieldNames.DueDate);if(c==e){return 0}if(c==null){return 1}if(e==null){return -1}var f=new Date(c);var g=new Date(e);if(f==g){return 0}if(f>g){return 1}return -1});return q};function Appointment(){}Appointment.Extend=function Appointment$Extend(b){return $.extend(new Appointment(),b)};Appointment.prototype.Copy=function(){var b=$.extend(new Appointment(),this);return b};function GalleryCategory(){}GalleryCategory.Extend=function GalleryCategory$Extend(b){return $.extend(new GalleryCategory(),b)};GalleryCategory.prototype.Copy=function(){var b=$.extend(new GalleryCategory(),this);b.Activities={};b.ItemsMap={};return b};GalleryCategory.prototype.IsSelected=function(){return DataModel.UserSettings.IsCategorySelected(this.ID)};GalleryCategory.prototype.IsExpanded=function(){return DataModel.UserSettings.IsCategoryExpanded(this.ID)};GalleryCategory.prototype.Expand=function(b){DataModel.UserSettings.ExpandCategory(this.ID,b)};GalleryCategory.prototype.GetActivities=function(){return this.Activities};GalleryCategory.prototype.GetActivity=function(b){return this.Activities[b]};GalleryCategory.prototype.IsGalleryCategory=function(){return true};GalleryCategory.prototype.IsGalleryActivity=function(){return false};GalleryCategory.prototype.Install=function(b){Service.InvokeController("Actions","InstallCategory",{category:this},function(a){var e=a.result;if(e.StatusCode!="200"){Control.alert("Server was unable to install the category","Install Category")}else{if(b!=null){b(e)}}})};function GalleryActivity(){}GalleryActivity.Extend=function GalleryActivity$Extend(b){return $.extend(new GalleryActivity(),b)};GalleryActivity.prototype.Copy=function(){var b=$.extend(new GalleryActivity(),this);b.ItemsMap={};return b};GalleryActivity.prototype.IsGalleryCategory=function(){return false};GalleryActivity.prototype.IsGalleryActivity=function(){return true};GalleryActivity.prototype.IsSelected=function(){return DataModel.UserSettings.IsActivitySelected(this.ID)};GalleryActivity.prototype.Install=function(b){Service.InvokeController("Actions","InstallActivity",{activity:this,category:null},function(a){var e=a.result;if(e.StatusCode!="200"){Control.alert("Server was unable to install the category","Install Activity")}else{if(b!=null){b(e)}}})};function LinkArray(b){this.links=[];if(b!=null&&b.length>0){this.links=$.parseJSON(b)}}LinkArray.prototype.Links=function(){return this.links};LinkArray.prototype.ToJson=function(){return JSON.stringify(this.links)};LinkArray.prototype.Remove=function(b){this.links.splice(b,1)};LinkArray.prototype.Add=function(e,f){if(f!=null){this.links.push({Name:f,Url:e});return this.links}var g=e.split(",");if(g.length>1){f=$.trim(g[0]);e=$.trim(g[1]);this.links.push({Name:f,Url:e})}else{this.links.push({Url:e})}return this.links};LinkArray.prototype.ToText=function(){var g="";for(var e in this.links){var f=this.links[e];if(f.hasOwnProperty("Name")){if(f.Name!=null&&f.Name.length>0&&f.Name!=f.Url){g+=f.Name+", "}}g+=f.Url+"\r\n"}return g};LinkArray.prototype.Parse=function(i){var g=i.split(/\r\n|\r|\n/g);for(var f in g){var h=g[f].split(",");if(h.length==1&&h[0].length>0){this.links.push({Url:h[0]})}if(h.length==2){this.links.push({Name:h[0],Url:h[1]})}}};function Recurrence(){this.Frequency=Recurrence.Frequencys.Daily;this.Interval=1;this.ByDay=[];this.ByMonthDay=[];this.ByYearDay=[];this.ByMonth=[]}Recurrence.Extend=function Recurrence$Extend(b){if(typeof(b)=="string"){b=$.parseJSON(b)}if(b!=null){if(typeof(b.Interval)=="string"){b.Interval=parseInt(b.Interval)}b.ByDay=(typeof(b.ByDay)=="string")?[]:b.ByDay;b.ByMonthDay=(b.ByMonthDay=="")?[]:b.ByMonthDay;b.ByYearDay=(b.ByYearDay=="")?[]:b.ByYearDay;b.ByMonth=(b.ByMonth=="")?[]:b.ByMonth}return $.extend(new Recurrence(),b)};Recurrence.Frequencys={Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"};Recurrence.FrequencyLabels={Daily:"days",Weekly:"weeks",Monthly:"months",Yearly:"years"};Recurrence.WeekdayLabels=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Recurrence.MonthLabels=["January","February","March","April","May","June","July","August","September","October","November","December"];Recurrence.prototype.ToJson=function(){return JSON.stringify(this)};Recurrence.prototype.IsEnabled=function(){return(this.On!=null)};Recurrence.prototype.Enable=function(){this.On=1};Recurrence.prototype.Disable=function(){delete this["On"]};Recurrence.prototype.IsDaily=function(){return this.Frequency==Recurrence.Frequencys.Daily};Recurrence.prototype.IsWeekly=function(){return this.Frequency==Recurrence.Frequencys.Weekly};Recurrence.prototype.IsMonthly=function(){return this.Frequency==Recurrence.Frequencys.Monthly};Recurrence.prototype.IsYearly=function(){return this.Frequency==Recurrence.Frequencys.Yearly};Recurrence.prototype.HasWeekdays=function(){return this.ByDay.length>0};Recurrence.prototype.HasWeekday=function(b){return this.ByDay.indexOf(b)!=-1};Recurrence.prototype.AddWeekday=function(b){this.ByDay.push(b)};Recurrence.prototype.RemoveWeekday=function(c){var e=this.ByDay.indexOf(d);if(e>=0){this.ByDay.splice(e,1)}};Recurrence.prototype.NoMonthDays=function(){this.ByMonthDay.length=0};Recurrence.prototype.FirstMonthDay=function(){return(this.ByMonthDay.length==0)?0:this.ByMonthDay[0]};Recurrence.prototype.HasMonthDay=function(b){return(this.ByMonthDay.indexOf(b)>=0)};Recurrence.prototype.AddMonthDay=function(b){this.ByMonthDay.push(b)};Recurrence.prototype.RemoveMonthDay=function(c){var e=this.ByMonthDay.indexOf(c);if(e>=0){this.ByMonthDay.splice(e,1)}};Recurrence.prototype.NoYearDays=function(){this.ByYearDay.length=0};Recurrence.prototype.FirstYearDay=function(){return(this.ByYearDay.length==0)?0:this.ByYearDay[0]};Recurrence.prototype.HasYearDay=function(b){return(this.ByYearDay.indexOf(b)>=0)};Recurrence.prototype.AddYearDay=function(b){this.ByYearDay.push(b)};Recurrence.prototype.RemoveYearDay=function(c){var e=this.ByYearDay.indexOf(c);if(e>=0){this.ByYearDay.splice(e,1)}};Recurrence.prototype.NoMonths=function(){this.ByMonth.length=0};Recurrence.prototype.FirstMonth=function(){return(this.ByMonth.length==0)?0:this.ByMonth[0]};Recurrence.prototype.HasMonth=function(b){return(this.ByMonth.indexOf(b)>=0)};Recurrence.prototype.AddMonth=function(b){this.ByMonth.push(b)};Recurrence.prototype.RemoveMonth=function(c){var e=this.ByMonth.indexOf(c);if(e>=0){this.ByMonth.splice(e,1)}};Recurrence.prototype.Summary=function(j){var i=(j==null)?"Do not repeat":j;if(this.IsEnabled()){var l=Recurrence.FrequencyLabels[this.Frequency];if(this.Interval==1){l=l.substr(0,l.length-1)}var m=this.Interval.toString();var k="</strong> after completing current activity ";if(this.IsWeekly()){var h=this.ByDay;if(h.length>0){m=(this.Interval==1)?"every":"every "+m;if(h.length==7){k="each day"}else{k="";$.each(h,function(b,a){k+=(b==0)?" on ":((b==h.length-1)?" and ":", ");k+=Recurrence.WeekdayLabels[a]})}k+="</strong>"}}if(this.IsMonthly()){if(this.FirstMonthDay()>0){m=(this.Interval==1)?"every":"every "+m;k="on the "+this.AddSuffix(this.FirstMonthDay())+"</strong> of the month"}}if(this.IsYearly()){if(this.FirstMonth()>0){m=(this.Interval==1)?"every":"every "+m;if(this.FirstYearDay()==0){k="in "+Recurrence.MonthLabels[this.FirstMonth()-1]}else{k="on "+Recurrence.MonthLabels[this.FirstMonth()-1];k+=" "+this.AddSuffix(this.FirstYearDay())}}k+="</strong>"}var i="Repeat <strong>"+m+" "+l+" "+k}return i};Recurrence.prototype.AddSuffix=function(f){var e=f%10;var g;switch(e){case 1:g="st";break;case 2:g="nd";break;case 3:g="rd";break;default:g="th";break}g=(f>10&&f<14)?"th":g;return f+g};Recurrence.prototype.NextDueDate=function(g){if(typeof(g)=="string"){g=new Date.parseSafe(g)}if(this.IsDaily()){g.add(this.Interval).days()}if(this.IsWeekly()){g.add(this.Interval).weeks();if(this.ByDay.length>0){if(this.ByDay[0]!=g.getDay()){g.moveToDayOfWeek(this.ByDay[0])}}}if(this.IsMonthly()){g.add(this.Interval).months();if(this.ByMonthDay.length>0){var f=Date.getDaysInMonth(g.getFullYear(),g.getMonth());var e=(this.ByMonthDay[0]>f)?f:this.ByMonthDay[0];g.setDate(e)}}if(this.IsYearly()){g.add(this.Interval).years();if(this.ByMonth.length>0){g.setMonth(this.ByMonth[0]-1);if(this.ByYearDay.length>0){var f=Date.getDaysInMonth(g.getFullYear(),g.getMonth());var e=(this.ByYearDay[0]>f)?f:this.ByYearDay[0];g.setDate(e)}else{g.setDate(1)}}}return g.format("shortDate")};function UserSettings(c,e){this.clientFolder=c;this.webClientFolder=e;this.init(UserSettings.viewStateName,UserSettings.viewStateKey);this.init(UserSettings.preferencesName,UserSettings.preferencesKey)}UserSettings.defaultListsKey="DefaultLists";UserSettings.userProfileKey="UserProfile";UserSettings.viewStateName="ViewState";UserSettings.viewStateKey="WebViewState";UserSettings.preferencesName="Preferences";UserSettings.preferencesKey="WebPreferences";UserSettings.prototype.GetFolder=function(b){if(this.clientFolder.ID==b){return this.clientFolder}if(this.webClientFolder.ID==b){return this.webClientFolder}return null};UserSettings.prototype.GetUserProfileItem=function(){var b=this.clientFolder.GetItemByName(UserSettings.userProfileKey);if(b==null){this.clientFolder.InsertItem(Item.Extend({Name:UserSettings.userProfileKey,ItemTypeID:ItemTypes.NameValue}),null,null,null)}return this.clientFolder.GetItemByName(UserSettings.userProfileKey)};UserSettings.prototype.GetDefaultList=function(j){var h=this.clientFolder.GetItemByName(UserSettings.defaultListsKey);if(h!=null){var g=this.clientFolder.GetItemByValue(j,h.ID);if(g!=null){var k=g.GetFieldValue(FieldNames.EntityRef);if(typeof(k)=="object"){return k}}}var i;for(id in DataModel.Folders){i=DataModel.Folders[id];if(i.ItemTypeID==j){return i}}return i};UserSettings.prototype.Selection=function(c,e){this.ViewState.SelectedFolder=c;this.ViewState.SelectedItem=e};UserSettings.prototype.IsFolderSelected=function(b){return(this.ViewState.SelectedFolder==b)};UserSettings.prototype.IsCategorySelected=function(b){return(this.ViewState.SelectedCategory==b)};UserSettings.prototype.IsActivitySelected=function(b){return(this.ViewState.SelectedActivity==b)};UserSettings.prototype.IsItemSelected=function(g,e){if(e==true){var f=DataModel.FindItem(this.ViewState.SelectedItem);if(f!=null&&f.ParentID==g){return true}}return(this.ViewState.SelectedItem==g)};UserSettings.prototype.ExpandFolder=function(e,c){if(this.ViewState.ExpandedFolders==null){this.ViewState.ExpandedFolders={}}if(c==true){this.ViewState.ExpandedFolders[e]=true}else{delete this.ViewState.ExpandedFolders[e]}};UserSettings.prototype.ExpandCategory=function(c,e){if(this.ViewState.ExpandedCategories==null){this.ViewState.ExpandedCategories={}}if(e==true){this.ViewState.ExpandedCategories[c]=true}else{delete this.ViewState.ExpandedCategories[c]}};UserSettings.prototype.IsFolderExpanded=function(b){return(this.ViewState.ExpandedFolders!=null&&this.ViewState.ExpandedFolders[b]==true)};UserSettings.prototype.IsCategoryExpanded=function(b){return(this.ViewState.ExpandedCategories!=null&&this.ViewState.ExpandedCategories[b]==true)};UserSettings.prototype.ActiveWizardPanel=function(b){if(b!=null){this.ViewState.ActiveWizardPanel=b}return this.ViewState.ActiveWizardPanel};UserSettings.prototype.Save=function(){var c={};for(var e in DataModel.Folders){if(DataModel.Folders[e].IsExpanded()){c[e]=true}}this.ViewState.ExpandedFolders=c;this.update(UserSettings.viewStateName,UserSettings.viewStateKey)};UserSettings.prototype.UpdateTheme=function(b){if(this.Preferences.Theme!=b){this.Preferences.Theme=b;this.update(UserSettings.preferencesName,UserSettings.preferencesKey);Service.ChangeTheme(b)}};UserSettings.prototype.init=function(h,f){var g="item"+h;if(this.webClientFolder!=null){this[g]=this.webClientFolder.GetItemByName(f,null)}if(this[g]==null){this[h]={};if(this.webClientFolder!=null){this.webClientFolder.InsertItem(Item.Extend({Name:f,ItemTypeID:ItemTypes.NameValue}),null,null,null)}}else{var i=this[g].GetFieldValue(FieldNames.Value);this[h]=(i==null)?{}:$.parseJSON(i)}};UserSettings.prototype.update=function(h,f){if(this.webClientFolder!=null){var g="item"+h;if(this[g]==null){this[g]=this.webClientFolder.GetItemByName(f,null)}var i=this[g].Copy();i.SetFieldValue(FieldNames.Value,JSON.stringify(this[h]));this[g].Update(i)}};function ActivityGallery(b){this.onSelectionChangedHandlers={};this.onActivityInstalledHandlers={};this.init(b)}ActivityGallery.prototype.init=function(b){this.categories=b;this.$element=null};ActivityGallery.prototype.addSelectionChangedHandler=function(e,c){this.onSelectionChangedHandlers[e]=c};ActivityGallery.prototype.removeSelectionChangedHandler=function(b){this.onSelectionChangedHandlers[b]=undefined};ActivityGallery.prototype.fireSelectionChanged=function(e,g){for(var h in this.onSelectionChangedHandlers){var f=this.onSelectionChangedHandlers[h];if(typeof(f)=="function"){f(e,g)}}};ActivityGallery.prototype.addActivityInstalledHandler=function(e,c){this.onActivityInstalledHandlers[e]=c};ActivityGallery.prototype.removeActivityInstalledHandler=function(b){this.onActivityInstalledHandlers[b]=undefined};ActivityGallery.prototype.fireActivityInstalled=function(e,g){for(var h in this.onActivityInstalledHandlers){var f=this.onActivityInstalledHandlers[h];if(typeof(f)=="function"){f(e,g)}}};ActivityGallery.prototype.render=function(e,f){this.delay=1;if(f!=null){this.init(f)}e.empty();$('<div class="nav-header">Gallery</div>').appendTo(e);this.$element=$('<ul class="nav nav-pills nav-stacked" />').appendTo(e);for(var h in this.categories){var g=this.categories[h];$category=$('<li class="position-relative"><a class="selector"><strong>&nbsp;'+g.Name+"</strong></a></li>").appendTo(this.$element);$category.find("strong").prepend(Control.Icons.forFolder(g));$category.data("control",this);$category.data("item",g);$category.click(function(a){if($(a.target).hasClass("selector")||$(a.target).parents("a").first().hasClass("selector")){Control.get(this).categoryClicked($(this))}return true});if(g.IsSelected()){this.select($category,g)}this.renderItems($category,g)}this.delay=400};ActivityGallery.prototype.renderItems=function(g,i){var l=i.GetActivities();$itemList=$('<ul class="itemlist nav nav-pills nav-stacked" />').appendTo(g.parent());for(var j in l){var k=l[j];if(k.IsGalleryActivity()){$item=$('<li class="position-relative"><a class="selector"><span>&nbsp;'+k.Name+"</span></a></li>").appendTo($itemList);$item.data("control",this);$item.data("item",k);$item.click(function(a){if($(a.target).hasClass("selector")||$(a.target).parents("a").first().hasClass("selector")){Control.get(this).itemClicked($(this))}return true});var h=$('<i class="btn-install icon-plus-sign" />').appendTo($item).hide();Control.tooltip(h,"Add Activity");h.click(function(){var a=$(this).parents("li").first();var b=a.data("item");var e=a.data("control");var c=b.Install(function(f){e.fireActivityInstalled(f.FolderID,f.ItemID)});Events.Track(Events.Categories.Gallery,Events.Gallery.AddGalleryActivity,b.Name)});if(k.IsSelected(true)){this.select($item,k)}}}if(i.IsExpanded()){this.expand(g)}else{this.collapse(g)}};ActivityGallery.prototype.categoryClicked=function(c){var e=c.data("item");this.toggle(c);this.select(c,e);this.fireSelectionChanged(e.ID)};ActivityGallery.prototype.itemClicked=function(c){var e=c.data("item");this.select(c,e);this.fireSelectionChanged(e.FolderID,e.ID)};ActivityGallery.prototype.select=function(h,j){this.deselect();h.addClass("active");h.find(".btn-install").show();var g=h.parents(".dashboard-list").first();var i=g.height();var l=g.scrollTop();var k=h.offset().top-i+l;if(k>0){g.animate({scrollTop:k},500)}};ActivityGallery.prototype.deselect=function(){$control=this;$.each(this.$element.find("li"),function(){$(this).removeClass("active");$(this).find(".btn-install").hide()})};ActivityGallery.prototype.expand=function(c){this.collapseAll(c);var e=c.data("item");c.addClass("expanded");e.Expand(true);$itemlist=c.next(".itemlist");Control.expand($itemlist,this.delay);$itemlist.removeClass("collapse")};ActivityGallery.prototype.collapse=function(e,g){var f=e.data("item");e.removeClass("expanded");f.Expand(false);Control.collapse(e.next(".itemlist"),g)};ActivityGallery.prototype.collapseAll=function(b){$this=this;$.each(b.siblings("li"),function(){$this.collapse($(this))})};ActivityGallery.prototype.toggle=function(c){var e=c.hasClass("expanded");if(c.hasClass("active")&&e){this.collapse(c)}else{if(!e){this.expand(c)}}};Control.Repeat={};Control.Repeat.closeHandler=null;Control.Repeat.disabled=false;Control.Repeat.render=function Control$Repeat$render(g,j,i){this.$element=g;var h=$("<label />").appendTo(g);h.addClass(i.Class);var f=$('<a class="btn btn-repeat icon"><i class="icon-repeat"></i></a>').appendTo(h);f.data("item",j);$("<span></span>").appendTo(h);this.rrule=Recurrence.Extend(j.GetFieldValue(i));this.refresh(f,j)};Control.Repeat.refresh=function Control$Repeat$refresh(e,f){var g="Enable";if(this.rrule.IsEnabled()){g="Edit";e.addClass("btn-success")}else{e.removeClass("btn-success")}if(Control.Repeat.disabled!=true){Control.tooltip(e,g);e.unbind("click").click(function(){$(this).tooltip("hide");Control.Repeat.dialog($(this))})}else{e.addClass("disabled")}e.parent().find("span").html(this.rrule.Summary("Repeat?"))};Control.Repeat.dialog=function Control$Repeat$dialog(e){var c=$("#repeatDialog").children().clone();Events.Track(Events.Categories.Organizer,Events.Organizer.RepeatButton);Control.popup(c,"Repeat",function(){Control.Repeat.updateItem(e,Control.Repeat.rrule);if(Control.Repeat.closeHandler!=null){Control.Repeat.closeHandler(true)}},function(){if(Control.Repeat.closeHandler!=null){Control.Repeat.closeHandler(false)}});this.init(e,c)};Control.Repeat.updateItem=function Control$Repeat$update(f,j){f.parent().find("span").html(j.Summary());var i=f.data("item");var h=f.data("field");if(i.ID!=null){var g=i.Copy();g.SetFieldValue(FieldNames.Repeat,j.ToJson());i.Update(g)}else{i.SetFieldValue(FieldNames.Repeat,j.ToJson())}this.refresh(f,i)};Control.Repeat.init=function Control$Repeat$init(r,p){var q=p.find(".btn-warning");var s=p.find(".repeat-frequency");var t=p.find(".repeat-interval");var v=p.find(".repeat-weekdays");var l=p.find(".repeat-bymonth");var o=l.find("select");var m=p.find(".repeat-byyear");var u=m.find("select").first();var n=m.find("select").last();q.click(function(){Control.Repeat.rrule.Disable();Control.Repeat.recalc(p)});s.change(function(a){Control.Repeat.rrule.Frequency=$(this).val();Control.Repeat.recalc(p)});t.change(function(a){if($(this).val()==0){Control.Repeat.rrule.Disable()}else{Control.Repeat.rrule.Enable();Control.Repeat.rrule.Interval=parseInt($(this).val())}Control.Repeat.recalc(p)});v.find("label.checkbox").each(function(){$(this).click(function(){Control.Repeat.setWeekdays(v);Control.Repeat.recalc(p)})});o.change(function(b){Control.Repeat.rrule.NoMonthDays();var a=parseInt($(this).val());if(a>0){Control.Repeat.rrule.AddMonthDay(a)}Control.Repeat.recalc(p)});u.change(function(a){Control.Repeat.rrule.NoMonths();var b=parseInt($(this).val());if(b>0){Control.Repeat.rrule.AddMonth(b)}Control.Repeat.recalc(p)});n.change(function(b){Control.Repeat.rrule.NoYearDays();var a=parseInt($(this).val());if(a>0){Control.Repeat.rrule.AddYearDay(a)}Control.Repeat.recalc(p)});s.val(this.rrule.Frequency);this.renderOptions(t,0,30);t.val(this.rrule.IsEnabled()?this.rrule.Interval:0);this.initWeekdays(p,this.rrule);this.renderOptions(o,0,31);o.val(this.rrule.FirstMonthDay());this.renderOptions(u,0,12,Recurrence.MonthLabels);u.val(this.rrule.FirstMonth());this.renderOptions(n,0,31);n.val(this.rrule.FirstYearDay());this.recalc(p)};Control.Repeat.recalc=function Control$Repeat$recalc(k){var l=k.find(".btn-warning");var m=k.find(".repeat-frequency");var n=k.find(".repeat-interval");var p=k.find(".repeat-weekdays");var i=k.find(".repeat-bymonth");var j=k.find(".repeat-byyear");p.hide();if(this.rrule.IsWeekly()){p.show()}i.hide();if(this.rrule.IsMonthly()){i.show()}j.hide();if(this.rrule.IsYearly()){j.show()}var o=k.find(".repeat-summary");o.html(this.rrule.Summary());if(this.rrule.IsEnabled()){l.show();o.addClass("alert-success")}else{l.hide();n.val(0);o.removeClass("alert-success")}};Control.Repeat.initWeekdays=function Control$Repeat$initWeekdays(f,h){for(var g in Recurrence.WeekdayLabels){var e=f.find('input[name="'+g+'"]').attr("checked",false);if(h!=null&&h.HasWeekday(parseInt(g))){e.attr("checked",true)}}};Control.Repeat.setWeekdays=function Control$Repeat$setWeekdays(b){this.rrule.ByDay=[];b.find('input[type="checkbox"]').each(function(){if($(this).attr("checked")=="checked"){Control.Repeat.rrule.AddWeekday(parseInt($(this).attr("name")))}})};Control.Repeat.renderOptions=function Control$Repeat$renderOptions(g,l,h,k){g.empty();for(var i=l;i<=h;i++){var j=(i==0)?"---":((k==null)?i:k[i-1]);$('<option value="'+i+'">'+j+"</option>").appendTo(g)}};var Dashboard=function Dashboard$(){this.dataModel=null;this.folderList=null;this.helpManager=null;this.settingsManager=null;this.folderManager=null;this.suggestionManager=null};Dashboard.Init=function Dashboard$Init(f,g,e){Dashboard.dataModel=f;Dashboard.checkBrowser();Dashboard.checkConsent(e);if(g==true){Service.GetFacebookConsent()}Dashboard.dataModel.AddDataChangedHandler("dashboard",Dashboard.ManageDataChange);Dashboard.$element=$(".dashboard-region");Dashboard.$center=$(".dashboard-center");Dashboard.$left=$(".dashboard-left");Dashboard.$right=$(".dashboard-right");Dashboard.folderList=new FolderList(this.dataModel.Folders);Dashboard.folderList.addSelectionChangedHandler("dashboard",Dashboard.ManageFolder);Dashboard.activityGallery=new ActivityGallery();Dashboard.activityGallery.addSelectionChangedHandler("dashboard",Dashboard.ManageGallery);Dashboard.activityGallery.addActivityInstalledHandler("dashboard",Dashboard.refreshAfterInstall);Dashboard.dataModel.GetGalleryCategories(Dashboard.renderGallery);Dashboard.suggestionManager=new SuggestionManager(Dashboard.dataModel);Dashboard.helpManager=new HelpManager(Dashboard,Dashboard.$center);Dashboard.settingsManager=new SettingsManager(Dashboard,Dashboard.$center);Dashboard.folderManager=new FolderManager(Dashboard,Dashboard.$center);Dashboard.folderManager.addSelectionChangedHandler("dashboard",Dashboard.ManageFolder);if(Dashboard.dataModel.UserSettings.ViewState.SelectedFolder!=null){Dashboard.showManager(Dashboard.folderManager);Dashboard.dataModel.restoreSelection()}else{Dashboard.showManager(Dashboard.helpManager);Dashboard.folderList.render(Dashboard.$left,Dashboard.dataModel.Folders)}$(window).bind("load",Dashboard.resize);$(window).bind("resize",Dashboard.resize);$(window).bind("unload",Dashboard.Close);$logo=$(".brand a");$logo.unbind("click");$logo.click(function(){Dashboard.dataModel.Refresh();return false});Dashboard.showHeaderOptions();Events.Track(Events.Categories.Organizer,Events.Organizer.OrganizerLoaded)};Dashboard.Close=function Dashboard$Close(b){$(".header-icons").hide();Dashboard.dataModel.Close()};Dashboard.ManageDataChange=function Dashboard$ManageDataChange(f,h,e){$(".dashboard-region i").tooltip("hide");$(".dashboard-region a").tooltip("hide");$(".dashboard-region button").tooltip("hide");var g=Dashboard.ManageFolder(f,h);if(e==DataChangeTypes.Update||(e==DataChangeTypes.Insert&&g.IsActivity())){Dashboard.folderList.refreshItem(g)}else{Dashboard.folderList.render(Dashboard.$left,Dashboard.dataModel.Folders)}};Dashboard.ManageFolder=function Dashboard$ManageFolder(f,h){var g;var e=(f!=null)?Dashboard.dataModel.Folders[f]:null;if(h==null){Dashboard.dataModel.UserSettings.Selection(f,h);if(e!=null&&e.ItemTypeID!=ItemTypes.Category){Dashboard.showManager(Dashboard.folderManager);Dashboard.folderManager.selectFolder(e)}else{Dashboard.showManager(Dashboard.helpManager)}return e}else{g=(e!=null&&h!=null)?e.Items[h]:null;Dashboard.dataModel.UserSettings.Selection(f,h);Dashboard.showManager(Dashboard.folderManager);Dashboard.folderManager.selectItem(g);return g}};Dashboard.render=function Dashboard$render(c,e){Dashboard.folderList.render(Dashboard.$left);Dashboard.dataModel.GetGalleryCategories(Dashboard.renderGallery)};Dashboard.showHeaderOptions=function Dashboard$showHeaderOptions(){var g=$(".navbar-fixed-top .pull-right");var h=g.find(".option-categories a i").addClass("icon-white");Control.tooltip(h,"Activity Dashboard","bottom");Control.tooltip(g.find(".option-nextsteps a i"),"Next Steps","bottom");var e=$(".navbar-fixed-top .pull-right .dropdown-menu");var f=e.find(".option-refresh");f.show();f.click(function(a){Dashboard.dataModel.Refresh();Events.Track(Events.Categories.Organizer,Events.Organizer.RefreshButton);a.preventDefault()});f=e.find(".option-settings");f.show();f.click(function(a){Dashboard.showManager(Dashboard.settingsManager);Events.Track(Events.Categories.Organizer,Events.Organizer.SettingsButton);a.preventDefault()});f=e.find(".option-help");f.show();f.click(function(a){Dashboard.showManager(Dashboard.helpManager,null,HelpManager.Views.Help);Events.Track(Events.Categories.Organizer,Events.Organizer.HelpButton);a.preventDefault()})};Dashboard.showManager=function Dashboard$showManager(f,e,g){if(Dashboard.currentManager!=f){Dashboard.currentManager=f;Dashboard.folderManager.hide();Dashboard.settingsManager.hide();Dashboard.helpManager.hide();(f.addWell==true)?Dashboard.$center.addClass("well"):Dashboard.$center.removeClass("well")}f.show(e,g)};Dashboard.resize=function Dashboard$resize(){if(Dashboard.resizing){return}Dashboard.resizing=true;$(window).unbind("resize",Dashboard.resize);var j=$(window).height();var i=$(".navbar-fixed-top").height();var h=$(".navbar-fixed-bottom").height();var g=Dashboard.$left.children(".nav-header").height()+30;var f=j-(i+h+20);Dashboard.$left.height(f);Dashboard.$left.children("ul").first().height(f-g);Dashboard.$center.height(f);Dashboard.$right.height(f);Dashboard.$right.children("ul").first().height(f-g);Dashboard.showManager(Dashboard.currentManager,true);$(window).bind("resize",Dashboard.resize);Dashboard.resizing=false};Dashboard.checkBrowser=function Dashboard$checkBrowser(){if(Browser.IsMSIE()&&Browser.MSIE_Version()<9){var c="We're Sorry!";var e="This application currently requires an HTML5-compatible browser. We encourage you to try using the application with the latest version of Internet Explorer, Chrome, or FireFox.<br/>Thank you";Control.alert(e,c)}};Dashboard.checkConsent=function Dashboard$checkConsent(e){if(e!=null&&e.length>0){var g,f;switch(e){case"FBConsentFail":f="Failed!";g="This application was not able to receive consent for accessing your Facebook information.";break;case"GoogleConsentFail":f="Failed!";g="This application was not able to receive consent for managing your Google calendar.";break;case"CloudADConsentFail":f="Failed!";g="This application was not able to receive consent for accessing your Cloud Directory.";break;default:Dashboard.consentStatus=e;Dashboard.dataModel.GetSuggestions(Dashboard.completeConsent)}if(g!=null){Control.alert(g,f,function(){Service.NavigateToDashboard()})}}};Dashboard.completeConsent=function Dashboard$completeConsent(h){if(Dashboard.consentStatus!=null&&Dashboard.consentStatus.length>0){var f,e,g;switch(Dashboard.consentStatus){case"FBConsentSuccess":e="Success!";f="This application has successfully received consent for accessing your Facebook information.";g=SuggestionManager.findSuggestion(h,SuggestionTypes.GetFBConsent);break;case"GoogleConsentSuccess":e="Success!";f="This application has successfully received consent for managing your Google calendar.";g=SuggestionManager.findSuggestion(h,SuggestionTypes.GetGoogleConsent);break;case"CloudADConsentSuccess":e="Success!";f="This application has successfully received consent for accessing your Cloud Directory.";g=SuggestionManager.findSuggestion(h,SuggestionTypes.GetADConsent);break}Dashboard.consentStatus=null;if(g!=null&&g.ReasonSelected!=Reasons.Chosen){Dashboard.dataModel.SelectSuggestion(g,Reasons.Chosen);Control.alert(f,e,function(){Service.NavigateToDashboard()})}}};Dashboard.renderGallery=function Dashboard$renderGallery(b){Dashboard.activityGallery.render(Dashboard.$right,b)};Dashboard.refreshAfterInstall=function Dashboard$refreshAfterInstall(e,f){Control.working(Messages.InstallButton.AddingActivity,0);var h=Dashboard.dataModel.UserSettings;var g=h.ViewState.SelectedFolder;if(g!=null){h.ExpandFolder(g,false)}h.ExpandFolder(e,true);h.Selection(e,f);if(HelpManager.gettingStarted==1){Dashboard.dataModel.Refresh(HelpManager.getStartedStep2)}else{Dashboard.dataModel.Refresh(Control.workingClose)}};function FolderList(c,e){this.onSelectionChangedHandlers={};this.folderTypes=(e==null)?[ItemTypes.Category]:e;this.init(c)}FolderList.prototype.init=function(c){this.folders={};for(var e in c){if(this.folderTypes.indexOf(c[e].ItemTypeID)!=-1){this.folders[e]=c[e]}}this.$element=null};FolderList.prototype.addSelectionChangedHandler=function(e,c){this.onSelectionChangedHandlers[e]=c};FolderList.prototype.removeSelectionChangedHandler=function(b){this.onSelectionChangedHandlers[b]=undefined};FolderList.prototype.fireSelectionChanged=function(e,g){for(var h in this.onSelectionChangedHandlers){var f=this.onSelectionChangedHandlers[h];if(typeof(f)=="function"){f(e,g)}}};FolderList.prototype.render=function(f,i){this.delay=1;if(i!=null){this.init(i)}f.empty();var g=$('<div class="nav-header"></div>').appendTo(f);this.renderTabs(g);this.$element=$('<ul class="nav nav-pills nav-stacked" />').appendTo(f);Control.List.sortable(this.$element);for(var j in this.folders){var h=this.folders[j];$folder=$('<li class="position-relative"></li>').appendTo(this.$element);this.renderItem($folder,h);this.renderItems($folder,h)}this.renderAddBtn(this.$element);this.delay=400};FolderList.prototype.refreshItem=function(e){if(this.$element!=null){var c=this.$element.find("li.active");if(c.length>0&&c.data("item")!=null&&(e.ID==c.data("item").ID)){this.renderItem(c,e)}}};FolderList.prototype.renderItems=function(f,g){var j=g.GetItems();$itemList=$('<ul class="itemlist nav nav-pills nav-stacked" />').appendTo(f.parent());Control.List.sortable($itemList);for(var h in j){var i=j[h];if(i.IsList){$item=$('<li class="position-relative"></li>').appendTo($itemList);this.renderItem($item,i)}}this.renderAddBtn(f);if(g.IsExpanded()){this.expand(f)}else{this.collapse(f)}};FolderList.prototype.renderItem=function(c,e){c.empty();if(e.IsFolder()){$('<a class="selector"><strong>&nbsp;'+e.Name+"</strong></a>").appendTo(c);c.find("strong").prepend(Control.Icons.forItemType(e))}else{$('<a class="selector"><span>&nbsp;'+e.Name+"</span></a>").appendTo(c);c.find("span").prepend(Control.Icons.forItemType(e));c.find("a").addClass(e.StatusClass())}c.data("control",this);c.data("item",e);c.click(function(a){if($(a.target).hasClass("selector")||$(a.target).parents("a").first().hasClass("selector")){Control.get(this).itemClicked($(this))}return true});$('<div class="btn-dropdown absolute-right"></div>').appendTo(c);$('<div class="icon drag-handle">⁞&nbsp;</div>').appendTo(c);if(e.IsSelected(true)){this.select(c,e)}};FolderList.prototype.renderTabs=function(e){var g=$('<ul class="nav nav-tabs" />').appendTo(e);var f=$('<li class="active"><a data-toggle="tab"><i class="icon-dashboard"></i> Organizer</a></li>').appendTo(g);f.css("width","70%");f=$('<li><a data-toggle="tab"><i class="icon-play"></i></a></li>').appendTo(g);f.css("width","30%");Control.tooltip(f,"Next Steps","bottom");f.click(function(){window.location="/dashboard/nextsteps"})};FolderList.prototype.itemClicked=function(c){var e=c.data("item");if(e.IsFolder()){this.toggle(c);this.select(c,e);this.fireSelectionChanged(e.ID)}else{this.select(c,e);this.fireSelectionChanged(e.FolderID,e.ID)}};FolderList.prototype.select=function(h,j){this.deselect();h.addClass("active");this.showCommands(h,j);var g=h.parents(".dashboard-list").first();var i=g.height();var l=g.scrollTop();var k=h.offset().top-i+l;if(k>0){g.animate({scrollTop:k},500)}};FolderList.prototype.deselect=function(){$control=this;$.each(this.$element.find("li"),function(){$(this).removeClass("active");$control.hideCommands($(this))})};FolderList.prototype.expand=function(c){this.collapseAll(c);var e=c.data("item");c.addClass("expanded");e.Expand(true);$itemlist=c.next(".itemlist");Control.expand($itemlist,this.delay);$itemlist.removeClass("collapse")};FolderList.prototype.collapse=function(e,f){var g=e.data("item");e.removeClass("expanded");g.Expand(false);Control.collapse(e.next(".itemlist"),f)};FolderList.prototype.collapseAll=function(b){$this=this;$.each(b.siblings("li"),function(){$this.collapse($(this))})};FolderList.prototype.toggle=function(c){var e=c.hasClass("expanded");if(c.hasClass("active")&&e){this.collapse(c)}else{if(!e){this.expand(c)}}};FolderList.prototype.renderAddBtn=function(h){var i=h.data("item");if(i!=null&&i.ItemTypeID!=ItemTypes.Category){return}var j=(i!=null)?"Add Activity":"Add Category";var g=(i!=null)?h.next(".itemlist"):$('<ul class="nav nav-pills nav-stacked" />').appendTo(h);var f=$('<li class="position-relative"><a class="btn-command"><em>&nbsp;</em></a></li>').appendTo(g);f.data("control",this);f.find("em").prepend('<i class="icon-plus-sign"></i>');f.find("em").append(j);f.click(function(){var k=Control.get(this);var b=$(this);var e=(i!=null)?Item.Extend({Name:"New Activity",ItemTypeID:ItemTypes.Activity,IsList:true,Status:StatusTypes.Stopped}):Folder.Extend({Name:"New Category",ItemTypeID:ItemTypes.Category});var a=$('<input type="text" class="popup-text" />').appendTo(b);a.val(e.Name).focus().select();a.blur(function(){b.find("input").remove()});a.change(function(){c($(this).val(),e);b.find("input").remove()});a.keypress(function(l){if(l.which==13){c($(this).val(),e);b.find("input").remove();return false}});var c=function(p,o){if(p!=null&&p.length>0&&o.ID===undefined){o.Name=p;if(i!=null){i.Expand(true);DataModel.InsertItem(o,i,null,null,null,function(l){l=Item.Extend(l);var m=Item.Extend({Name:p,ItemTypeID:ItemTypes.Step});l.InsertItem(m);l.Start(Date.now())});Events.Track(Events.Categories.Organizer,Events.Organizer.AddActivity)}else{DataModel.InsertFolder(o);var n=k.$element.find("li.active");k.expand(n);Events.Track(Events.Categories.Organizer,Events.Organizer.AddCategory)}}}})};FolderList.prototype.showCommands=function(n,t){if(t.IsCategory()||t.IsActivity()){var l=n.find(".btn-dropdown");$('<i class="icon-caret-down dropdown-toggle" data-toggle="dropdown"></i>').appendTo(l);var o=$('<ul class="dropdown-menu pull-right" role="menu"></ul>').appendTo(l);var p=$('<li><a href="#"><i class="icon-pencil"></i>&nbsp;Rename</a></li>').appendTo(o);p.click(function(){var b=$(this).parents("li").first();var c=b.data("item");var a=$('<input type="text" class="popup-text" />').appendTo(b);a.val(c.Name).focus().select();a.blur(function(){b.find("input").remove()});a.change(function(){e($(this).val(),c,c.Copy());b.find("input").remove()});a.keypress(function(f){if(f.which==13){e($(this).val(),c,c.Copy());b.find("input").remove()}});var e=function(h,g,f){if(h!=null&&h.length>0){f.Name=h;g.Update(f)}}});var m=$('<li><a href="#"><i class="icon-remove-sign"></i>&nbsp;Delete</a></li>').appendTo(o);m.click(function(){var a=$(this).parents("li").first().data("item");a.Delete();Events.Track(Events.Categories.Organizer,(a.IsFolder()?Events.Organizer.DeleteCategory:Events.Organizer.DeleteActivity))});if(t.IsActivity()){if(t.IsActive()){var s=$('<li><a href="#"><i class="icon-pause" />&nbsp;Suspend</a></li>').appendTo(o);s.click(function(){$(this).parents("li").first().data("item").Pause()})}else{var v=t.CanResume();if((t.IsPaused()&&v.Resume)||v.Start){var r=$('<li><a href="#"><i class="icon-play" />&nbsp;Resume</a></li>').appendTo(o);r.click(function(){var a=$(this).parents("li").first().data("item");var b=a.Start();if(b!=null){u(b,a)}})}else{if(t.IsComplete()||v.Restart){var q=$('<li><a href="#"><i class="icon-backward" />&nbsp;Restart</a></li>').appendTo(o);q.click(function(){var a=$(this).parents("li").first().data("item");var b=a.Restart();if(b!=null){u(b,a)}})}}}}var u=function(g,c){var f="Select date";f+=(g.IsActivity())?" for activity":" for first step";var e=g.GetField(FieldNames.DueDate);var b=$('<div class="control-group"><label class="control-label">Due Date</label></div>');var a=Control.DateTime.renderDatePicker(b,g,e);if(a.val().length==0){a.val(new Date().format("shortDate"))}Control.popup(b,f,function(h){if(h.length==1&&h[0].length>0){var i=c.Start(h[0]);if(i!=null){Control.alert("Activity is not running.","Could not set valid due date on activity or next step. Try setting due date first.")}}})}}};FolderList.prototype.hideCommands=function(e){var c=e.find(".btn-dropdown");c.empty()};function FolderManager(e,c){this.parentControl=e;this.$parentElement=c;this.addWell=false;this.$element=null;this.currentFolder=null;this.currentItem=null;this.views={};this.onSelectionChangedHandlers={};this.listEditor=new ListEditor(this);this.itemEditor=new ItemEditor(this)}FolderManager.ListView="fm-list-view";FolderManager.ItemView="fm-item-view";FolderManager.PropertyView="fm-property-view";FolderManager.prototype.addSelectionChangedHandler=function(e,c){this.onSelectionChangedHandlers[e]=c};FolderManager.prototype.removeSelectionChangedHandler=function(b){this.onSelectionChangedHandlers[b]=undefined};FolderManager.prototype.fireSelectionChanged=function(f){for(var g in this.onSelectionChangedHandlers){var e=this.onSelectionChangedHandlers[g];if(typeof(e)=="function"){e(f.FolderID,f.ID);this.activeView(FolderManager.ItemView)}}};FolderManager.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};FolderManager.prototype.show=function(j){if(this.$element==null){this.$element=$('<div class="manager-folders" />').appendTo(this.$parentElement);var h=$('<ul class="nav nav-tabs" />').appendTo(this.$element);h.data("control",this);var f=$('<li><a data-toggle="tab">List View</a></li>').appendTo(h);f.find("a").attr("href","."+FolderManager.ListView);f=$('<li><a data-toggle="tab">Item View</a></li>').appendTo(h);f.find("a").attr("href","."+FolderManager.ItemView);$('<div class="item-status"></div>').appendTo(this.$element);var g=$('<div class="tab-content" />').appendTo(this.$element);var i=$('<div class="tab-pane" />').appendTo(g);i.addClass(FolderManager.ListView);this.views[FolderManager.ListView]=i;i=$('<div class="tab-pane" />').appendTo(g);i.addClass(FolderManager.ItemView);this.views[FolderManager.ItemView]=i;$('a[data-toggle="tab"]').on("shown",function(b){var a=$(b.target).parents(".nav-tabs");Control.get(a).viewChanged($(b.target))})}if(j==true){this.render()}this.$element.show()};FolderManager.prototype.render=function(){var s=this.activeView();var q=this.activeItem();var r=this.activeList();var o=this.$element.find(".nav-tabs");var n=this.$element.find(".tab-content");var m=o.find("li a:first");m.empty().append(this.activeListName(r));var l=o.find('a[href=".'+FolderManager.ItemView+'"]');if(q==null||r.IsActivity()){l.empty().append("Edit Step");var k=$('<a><i class="icon-remove"></i></a>').prependTo(l);k.data("control",this);k.click(function(){Control.get(this).activeView(FolderManager.ListView);return false})}else{l.empty().append(this.activeItemName(q))}var p=this.views[s];var t=this.$parentElement.outerHeight()-o.outerHeight();if(s==FolderManager.ItemView){if(q==null){s=FolderManager.ListView;this.activeView(s)}else{this.itemEditor.render(p,q,t);l.show();m.hide()}}if(s==FolderManager.ListView){this.listEditor.render(p,r,t);m.show();l.hide()}o.find('a[href=".'+s+'"]').tab("show")};FolderManager.prototype.selectFolder=function(b){this.currentFolder=b;this.currentItem=null;if(this.currentFolder!=null){this.render()}};FolderManager.prototype.selectItem=function(b){this.currentItem=b;if(this.currentItem!=null){this.currentFolder=this.currentItem.GetFolder();this.render()}else{this.selectFolder(this.currentFolder)}};FolderManager.prototype.activeItem=function(){var g=null;if(this.currentItem!=null){if(this.currentItem.IsList){g=this.currentItem}else{return this.currentItem}}else{if(this.currentFolder!=null){g=this.currentFolder}}if(g!=null){var f=g.GetItems();for(var e in f){if(!f[e].IsList){this.currentItem=f[e];this.currentItem.Select();return this.currentItem}}}return null};FolderManager.prototype.activeItemName=function(e){if(e!=null){var c=Control.Icons.forItemType(e);return $("<span>&nbsp;"+e.GetItemType().Name+"</span>").prepend(c)}return $("<span />")};FolderManager.prototype.activeList=function(){if(this.currentItem!=null){return(this.currentItem.IsList)?this.currentItem:this.currentItem.GetParentContainer()}else{if(this.currentFolder!=null){return this.currentFolder}}return null};FolderManager.prototype.activeListName=function(h){var g=(h==null)?this.activeList():h;if(g!=null){var e=Control.Icons.forItemType(g);var f=$("<span>&nbsp;"+g.Name+"</span>").prepend(e);if(!h.IsFolder()){f.addClass(h.StatusClass())}return f}return $("<span>List View</span>")};FolderManager.prototype.activeView=function(b){if(b===undefined){if(this.activeViewName==null){this.activeViewName=FolderManager.ListView}return this.activeViewName}else{if(this.activeViewName!=b){this.activeViewName=b;this.render()}}};FolderManager.prototype.viewChanged=function(b){this.activeView(b.attr("href").substr(1))};function HelpManager(e,c){this.parentControl=e;this.$parentControl=c;this.$element=null}HelpManager.Views={Intro:"Intro",Help:"Help"};HelpManager.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};HelpManager.prototype.show=function(c,e){e=(e==null)?HelpManager.Views.Intro:e;if(this.$element==null){this.$element=$('<div class="manager-help" />').appendTo(this.$parentControl)}if(c||e!=this.currentView){if(e==HelpManager.Views.Intro){this.renderIntro(this.$element)}else{if(e==HelpManager.Views.Help){this.renderHelp(this.$element)}}this.currentView=e}this.$element.show()};HelpManager.prototype.renderIntro=function(j){j.empty();var n=this;var k=$('<div class="intro well"></div>').appendTo(j);$('<img src="/content/images/twostep-watermark.png" alt="TwoStep" />').appendTo(k);var m=this.parentControl.dataModel.UserSettings;if(m.ViewState.HideWelcome!=true){$('<div class="welcome background"></div>').appendTo(k);var l=$('<div class="welcome"><h1>Welcome to TwoStep!</h1></div>').appendTo(k);$("<h3>Are you new to TwoStep?</h3>").appendTo(l);var i=$('<div class="controls inline"></div>').appendTo(l);i=$('<input type="checkbox" /><label class="inline">Do not show welcome screen</label>').appendTo(i);i.click(function(){m.ViewState.HideWelcome=true;n.show(true)});var h=$('<button class="btn btn-large btn-success">Get Started!</button>').appendTo(l);h.click(function(){HelpManager.getStarted();return false})}};HelpManager.prototype.renderHelp=function(b){Service.InvokeControllerView("Dashboard","Help",null,function(e){var a=e.result;b.html(a);$("#help_carousel").show().carousel("pause")})};HelpManager.getStarted=function(){HelpManager.gettingStarted=1;var e="Step 1: Add Haircut Activity";var c="Add the pre-configured <em>Haircut Activity</em> from the <strong>Personal Category</strong> in the <strong>Gallery</strong> on the right.";Control.popover($(".dashboard-right"),$(".dashboard-region"),e,c,"left","110px")};HelpManager.getStartedStep2=function(){Control.workingClose();HelpManager.gettingStarted=2;var g="Step 2: Set Complete By";var f='The <em>Activity</em> has been added to your <strong>Organizer</strong>. Set the "complete by" date for the first <em>Step</em>.';var e=$(".dashboard-center li.st-active button.ui-datepicker-trigger");Control.popover(e,e,g,f,"bottom");Control.DateTime.closeHandler=HelpManager.getStartedStep3};HelpManager.getStartedStep3=function(){Control.DateTime.closeHandler=null;HelpManager.gettingStarted=3;var e="Step 3: Find Action";var c="Use the <em>Find Action</em> to search for a local hair salon. This will open a new browser tab. ";c+='When you are finished searching, return to the "TwoStep Dashboard" tab to continue with the product tutorial.';HelpManager.$element=$(".dashboard-center li.st-active a.btn:first");Control.popover(HelpManager.$element,null,e,c,"bottom");Control.Actions.openWindowHandler=HelpManager.getStartedStep4};HelpManager.getStartedStep4=function(){Control.popoverClose(HelpManager.$element);Control.Actions.openWindowHandler=null;HelpManager.gettingStarted=4;var g="Step 4: Complete First Step";var f="Complete the first <em>Step</em> by clicking on the <strong>Complete</strong> action.";var e=$(".dashboard-center li.st-active a.btn-complete");Control.popover(e,$(".dashboard-region"),g,f,"bottom");Dashboard.dataModel.AddDataChangedHandler("helpmanager",HelpManager.getStartedStep5)};HelpManager.getStartedStep5=function(){Dashboard.dataModel.RemoveDataChangedHandler("helpmanager");HelpManager.gettingStarted=5;var g="Step 5: Call Action";var f="Use the <em>Call Action</em> to phone the hair salon for an appointment.";var e=$(".dashboard-center li.st-active a.btn:first");Control.popover(e,$(".dashboard-region"),g,f,"bottom");Control.Actions.infoDialogCloseHandler=HelpManager.getStartedStep6};HelpManager.getStartedStep6=function(){Control.Actions.infoDialogCloseHandler=null;HelpManager.gettingStarted=null;var e="Step 6: View Next Steps";var c="View your <em>Next Steps</em> by clicking on the <strong>Next Steps</strong> tab.";Control.popover($(".dashboard-left .nav-tabs a:last"),$(".dashboard-region"),e,c,"bottom");Dashboard.dataModel.UserSettings.ViewState.IntroComplete=true;Dashboard.dataModel.UserSettings.Save()};function SettingsManager(e,c){this.parentControl=e;this.$parentElement=c;this.$element=null;this.addWell=false;this.views={}}SettingsManager.Display="sm-display-settings";SettingsManager.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};SettingsManager.prototype.show=function(){if(this.$element==null){this.$element=$('<div class="manager-settings" />').appendTo(this.$parentElement);var g=$('<ul class="nav nav-tabs" />').appendTo(this.$element);g.data("control",this);var e=$('<li><a data-toggle="tab"><i class="icon-cogs"></i> User Settings</a></li>').appendTo(g);e.find("a").attr("href","."+SettingsManager.Display);var f=$('<div class="tab-content" />').appendTo(this.$element);var h=$('<div class="tab-pane" />').appendTo(f);h.addClass(SettingsManager.Display);this.views[SettingsManager.Display]=h}this.render();this.$element.show()};SettingsManager.prototype.render=function(){var i=this.$element.find(".nav-tabs");i.find('a[href=".'+SettingsManager.Display+'"]').tab("show");var j=this.views[SettingsManager.Display];j.empty();var h=$('<form class="row-fluid form-vertical" />').appendTo(j);var g=$('<p style="margin: 64px 0 -32px 0"></p>').appendTo(h);if(this.connectSuggestions==null){var l=this;var k=this.parentControl;k.dataModel.GetSuggestions(function(a){l.renderConnect(g,a)})}else{this.renderConnect(g,this.connectSuggestions)}};SettingsManager.prototype.renderConnect=function(i,m){i.empty();this.connectSuggestions=m;var n=this;var l=this.parentControl.suggestionManager;var j=SuggestionManager.findSuggestion(m,SuggestionTypes.GetFBConsent);if(j!=null){i.append("<p><strong>Not connected to Facebook.</strong></p>");var h=$('<a><img src="/content/images/connect-to-facebook.png" alt="Facebook" /></a>').appendTo(i);h.css("margin-right","32px");h.click(function(){l.select(j);n.connectSuggestions=null});i.append("<p>Click to connect.</p>")}else{i.append("<p><strong>Connected to Facebook.</strong></p>");var h=$('<a><img src="/content/images/connect-to-facebook.png" alt="Facebook" /></a>').appendTo(i);h.css("margin-right","32px");h.click(function(){l.select({SuggestionType:SuggestionTypes.GetFBConsent});n.connectSuggestions=null});i.append("<p>Click to reconnect.</p>")}i.append("<br /><br />");var k=SuggestionManager.findSuggestion(m,SuggestionTypes.GetGoogleConsent);if(k!=null){i.append("<p><strong>Not connected to Google Calendar.</strong></p>");var h=$('<a class="btn"><img src="/content/images/google-calendar.png" alt="Google" /></a>').appendTo(i);h.css("margin-right","32px");h.click(function(){l.select(k);n.connectSuggestions=null});i.append("<p>Click to connect.</p>")}else{i.append("<p><strong>Connected to Google Calendar.</strong></p>");var h=$('<a class="btn"><img src="/content/images/google-calendar.png" alt="Google" /></a>').appendTo(i);h.css("margin-right","32px");h.click(function(){l.select({SuggestionType:SuggestionTypes.GetGoogleConsent});n.connectSuggestions=null});i.append("<p>Click to reconnect.</p>")}};function ListEditor(b){this.parentControl=b;this.$element=null;this.$activity=null;this.newItemEditor=new NewItemEditor(this);this.listView=new ListView(this)}ListEditor.prototype.render=function(i,l,m){if(this.$element==null){this.$element=i}var h=null,j=null;var k=0,n=0;h=this.renderActivity(this.$element,l);k=(h!=null)?h.outerHeight():0;j=this.newItemEditor.render(this.$element,l);n=(j!=null)?j.outerHeight():0;this.listView.render(this.$element,l,m-k-n-28);j.appendTo(this.$element)};ListEditor.prototype.renderActivity=function(h,k){if(this.$activity==null){this.$activity=$('<ul class="nav nav-list" />').prependTo(h)}this.$activity.empty();if(!k.IsActivity()){return this.$activity}var n=k.GetItems(true);var m=ItemMap.count(n)>0;var j=$("<li />").appendTo(this.$activity);var i=$('<div class="form-inline"/>').appendTo(j);if(m){$('<label class="control-label large">Steps</label>').css("margin-bottom","0").appendTo(this.$activity)}j.attr("style","margin-bottom: 12px; border-top-color: transparent;");var l=k.GetField(FieldNames.Repeat);Control.Repeat.render(i,k,l);return this.$activity};ListEditor.prototype.selectItem=function(b){this.parentControl.fireSelectionChanged(b)};function NewItemEditor(b){this.parentControl=b;this.$element=null;this.list;this.newItem}NewItemEditor.prototype.render=function(e,g){if(g!=null&&(g.IsFolder()||g.IsList)){if(this.$element==null){this.$element=$('<div class="row-fluid" />').appendTo(e)}this.$element.empty();this.list=g;this.newItem=Item.Extend({Name:"",ItemTypeID:(g.IsActivity()?ItemTypes.Step:g.ItemTypeID)});var f=this.renderNameField(this.$element);f.val("")}return this.$element};NewItemEditor.prototype.renderNameField=function(f){var i=this.newItem.GetFields();var j=i[FieldNames.Name];var g=$('<form class="new-item form-vertical well"/>').appendTo(f);if(this.newItem.IsStep()){$('<label class="control-label large">Add Step</label>').appendTo(g)}var h=Control.Text.renderInputNew(g,this.newItem,j,this.list);h.addClass("input-block-level");return h};function ListView(b){this.parentControl=b;this.$element=null;this.list=null}ListView.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};ListView.prototype.show=function(){if(this.$element!=null){this.$element.show()}};ListView.prototype.render=function(f,i,h){if(i==null){return}if(this.$element==null){this.$element=$('<ul class="nav nav-list" />').appendTo(f);Control.List.sortable(this.$element)}this.hide();this.$element.empty();if(h!=null){this.$element.css("max-height",h)}if(this.renderListItems(i)>0){this.show();var g=this.$element.find("li.selected");if(g.length==1){var j=g.offset().top-h+this.$element.scrollTop();if(j>0){this.$element.animate({scrollTop:j},500)}}}};ListView.prototype.renderListItems=function(p){var q=p.GetItems(true);var r=ItemMap.count(q);var o=0;for(var m in q){var n=q[m];var k=$('<li class="position-relative" />').appendTo(this.$element);k.data("control",this);k.data("item",n);if(n.IsSelected()){k.addClass("selected")}if(n.IsStep()){k.addClass(n.StatusClass())}var l=$('<div class="inline" />').appendTo(k).css("width","100%");$('<div class="icon drag-handle">⁞</div>').appendTo(l);if(n.IsActive()){var j=$('<div class="btn-toolbar pull-left" />').appendTo(l);Control.Actions.renderButton(n).appendTo(j).addClass("btn-primary")}var j=$('<div class="form-inline pull-left" />').appendTo(l);this.renderNameField(j,n);this.renderFields(j,n);if(!n.IsCompleted()){Control.Actions.render(l,n,this)}o++}return o};ListView.prototype.renderNameField=function(e,h){var g=h.GetFields();if(!h.IsStep()){var f=g[FieldNames.Complete];if(f!=null){Control.Checkbox.render(e,h,f)}var f=g[FieldNames.WebLinks];if(f!=null){e.append(Control.Icons.forMapLink(h))}e.append(Control.Icons.forSources(h))}else{if(!h.IsActive()){if(!h.IsStopped()){e.append(Control.Icons.forStatusType(h))}else{e.append(Control.Icons.forActionType(h.GetActionType()))}}}f=g[FieldNames.Name];Control.Text.renderLabel(e,h,f)};ListView.prototype.renderFields=function(g,k){var h=$("<div />").appendTo(g);var j=k.GetFields();for(var l in j){var i=j[l];this.renderField(h,k,i)}$("<small>&nbsp;</small>").appendTo(h)};ListView.prototype.renderField=function(g,l,k){var h;switch(k.Name){case FieldNames.DueDate:if(l.HasField(FieldNames.EndDate)){var j=l.GetField(FieldNames.EndDate);h=Control.DateTime.renderRange(g,l,k,j,"small")}else{if(!(l.IsComplete()||l.IsSkipped())){h=Control.Text.render(g,l,k,"small","Complete by ")}}break;case FieldNames.CompletedOn:if(l.IsComplete()){h=Control.Text.render(g,l,k,"small","Completed on ")}else{if(l.IsSkipped()){h=Control.Text.render(g,l,k,"small","Skipped on ")}}break;case FieldNames.Category:h=Control.Text.render(g,l,k,"small");break;case FieldNames.Email:h=Control.Text.renderEmail(g,l,k);break;case FieldNames.Address:var i=l.GetFieldValue(FieldNames.Address);if(i!=l.Name){h=Control.Text.render(g,l,k,"small")}break;default:break}return h};function ItemEditor(b){this.parentControl=b;this.$element=null;this.expanded=true;this.item}ItemEditor.prototype.hide=function(){this.$element.hide()};ItemEditor.prototype.show=function(){this.$element.show()};ItemEditor.prototype.render=function(f,h){if(h!=null&&!(h.IsFolder()||h.IsList)){if(this.$element==null){this.$element=$('<form class="row-fluid form-vertical carousel" />').appendTo(f);this.$element.data("control",this)}this.$element.empty();this.item=h;this.siblings=this.item.GetParentContainer().GetItems(true);this.renderFields(this.$element);var g=$('<div class="control-group pull-right"></div>').css("margin-bottom","-16px").appendTo(this.$element);var e=$('<button class="btn btn-primary">Close</button>').appendTo(g);e.data("control",this.parentControl);e.click(function(){Control.get(this).activeView(FolderManager.ListView);return false})}};ItemEditor.prototype.renderNextItem=function(f){var i=f.hasClass("page-turn-next");var g=ItemMap.indexOf(this.siblings,this.item.ID);var h=ItemMap.count(this.siblings)-1;if(i){g=(g==h)?0:g+1}else{g=(g==0)?h:g-1}var j=ItemMap.itemAt(this.siblings,g);this.parentControl.fireSelectionChanged(j)};ItemEditor.prototype.renderFields=function(f){this.renderNameField(f);var g=$("<div />").appendTo(f);var i=this.item.GetFields();for(var j in i){var h=i[j];if(h.IsPrimary||this.expanded){this.renderField(g,h)}}};ItemEditor.prototype.renderNameField=function(n){var p=$('<form class="form-inline well"/>').appendTo(n);var m=$('<div class="span10" />').appendTo(p);var o;var u=this.item.GetFields();var t=u[FieldNames.Name];if(this.item.ItemTypeID==ItemTypes.Location){o=Control.Text.renderInputAddress(m,this.item,t)}else{if(this.item.ItemTypeID==ItemTypes.Grocery){o=Control.Text.renderInputGrocery(m,this.item,t)}else{o=Control.Text.renderInput(m,this.item,t)}}o.addClass("span12");var r=$('<div class="span2 thumbnail" />').appendTo(p);if(this.item.IsStep()){var s=$('<div class="span2" />').appendTo(p);var l=Control.ActionType.renderDropdown(r,this.item,true).addClass("pull-right");Control.tooltip(l.find("i"),"Change Action")}else{var v=this.item.GetFieldValue(FieldNames.Picture);if(v!=null){$image=$("<img />").appendTo(r);$image.attr("src",v)}else{var q=$('<a class="icon" />').appendTo(r);Control.Icons.forItemType(this.item).appendTo(q)}}return o};ItemEditor.prototype.renderField=function(e,h){if(h.Name==FieldNames.Name||h.Name==FieldNames.Complete){return}var f;var g=$('<div class="control-group"><label class="control-label">'+h.DisplayName+"</label></div>");switch(h.DisplayType){case DisplayTypes.Hidden:case DisplayTypes.Priority:case DisplayTypes.Reference:case DisplayTypes.TagList:break;case DisplayTypes.ContactList:f=Control.ContactList.renderInput(g,this.item,h);break;case DisplayTypes.LocationList:f=Control.LocationList.renderInput(g,this.item,h);break;case DisplayTypes.Address:f=Control.Text.renderInputAddress(g,this.item,h);break;case DisplayTypes.LinkArray:f=Control.LinkArray.render(g,this.item,h);break;case DisplayTypes.DateTimePicker:f=Control.DateTime.renderDateTimePicker(g,this.item,h);break;case DisplayTypes.DatePicker:f=Control.DateTime.renderDatePicker(g,this.item,h);break;case DisplayTypes.TextArea:f=Control.Text.renderTextArea(g,this.item,h);break;case DisplayTypes.Checkbox:f=Control.Checkbox.render(g,this.item,h);break;case DisplayTypes.Text:default:f=Control.Text.renderInput(g,this.item,h);break}if(f!=null){f.addClass("input-block-level");g.appendTo(e)}return f};function SuggestionManager(b){this.dataModel=b}SuggestionManager.findSuggestion=function SuggestionManager$findSuggestion(i,j){if(i!=null){for(var g in i){var f=i[g].Suggestions;if(f!=null){for(var h in f){if(f[h].SuggestionType==j){return f[h]}}}}}return null};SuggestionManager.prototype.select=function(g,e){var f=false;switch(g.SuggestionType){case SuggestionTypes.ChooseOne:f=this.chooseSuggestion(g);break;case SuggestionTypes.ChooseOneSubject:f=this.chooseSuggestion(g);break;case SuggestionTypes.ChooseMany:f=this.chooseMany(g);break;case SuggestionTypes.NavigateLink:f=this.navigateLink(g);break;case SuggestionTypes.GetFBConsent:f=this.getFacebookConsent(g,e);break;case SuggestionTypes.GetGoogleConsent:f=this.getGoogleConsent(g,e);break;case SuggestionTypes.GetADConsent:f=this.getCloudADConsent(g);break;default:f=this.chooseSuggestion(g);break}return f};SuggestionManager.prototype.chooseSuggestion=function(g,e){var f=this.dataModel;f.SelectSuggestion(g,Reasons.Chosen,function(a){if(e!=null){e()}});this.ignoreSuggestions(g);return true};SuggestionManager.prototype.ignoreSuggestions=function(j){var f=this.dataModel;var g=f.Suggestions[j.GroupID];if(g!=null){for(var h in g.Suggestions){var i=g.Suggestions[h];if(i.ID!=j.ID){f.SelectSuggestion(i,Reasons.Ignore)}}}};SuggestionManager.prototype.likeSuggestion=function(e,c){this.dataModel.SelectSuggestion(e,Reasons.Like,function(a){if(c!=null){c()}});return false};SuggestionManager.prototype.dislikeSuggestion=function(g,e){var f=this.dataModel;f.SelectSuggestion(g,Reasons.Dislike,function(a){if(e!=null){e()}});return false};SuggestionManager.prototype.navigateLink=function(b){return this.likeSuggestion(b,function(){window.open(b.Value)})};SuggestionManager.prototype.chooseMany=function(b){return this.likeSuggestion(b,function(){})};SuggestionManager.prototype.getFacebookConsent=function(h,f){var e=this.dataModel;var g="You will be redirected to Facebook to allow this application to access your Facebook information. This application will use information about yourself to help setup your user profile. This application will use information about your friends to help manage your Contacts. <br><br>Do you want to continue?";Control.confirm(g,"Facebook Consent?",function(){Service.GetFacebookConsent(f)});return false};SuggestionManager.prototype.getCloudADConsent=function(g){var e=this.dataModel;var f="You will be redirected to the Cloud Directory portal. Login with your Office 365 credentials to allow this application to access your directory information. This application will use information about yourself and other users to help manage your Contacts. <br><br>Do you want to continue?";Control.confirm(f,"Cloud Directory Consent?",function(){Service.GetCloudADConsent()});return false};SuggestionManager.prototype.getGoogleConsent=function(h,f){var e=this.dataModel;var g="You will be redirected to Google to allow this application to manage your Google Calendar. This application will interact with your calendar to keep your tasks and appointments synchronized. <br><br>Do you want to continue?";Control.confirm(g,"Google Calendar Consent?",function(){Service.GetGoogleConsent(f)});return false};