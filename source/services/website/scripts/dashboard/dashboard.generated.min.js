var Control=function Control$(){};Control.noDelay={delay:{show:0,hide:0}};Control.noDelayBottom={delay:{show:0,hide:0},placement:"bottom"};Control.ttDelay={delay:{show:500,hide:200}};Control.ttDelayBottom={delay:{show:500,hide:200},placement:"bottom"};Control.preventDefault=function Control$preventDefault(b){b.preventDefault()};Control.delegate=function Control$delegate(f,e){var d={object:f,handler:e};d.invoke=function(){return this.object[this.handler]()};return d};Control.get=function Control$get(b){return $(b).data("control")};Control.findParent=function Control$findParent(c,d){while(c.parentControl!=null){c=c.parentControl;if(c[d]!=null){return c}}return null};Control.expand=function Control$expand(d,f){var e=!(isNaN(f));if(e==true){if(Browser.IsMSIE()){d.collapse("show");d.show("blind",{direction:"vertical"},f)}else{d.show("blind",{direction:"vertical"},f,function(){d.collapse("show")})}}else{d.collapse("show")}};Control.collapse=function Control$collapse(d,f){var e=!(isNaN(f));if(e==true){d.collapse("hide")}else{d.collapse("hide")}};Control.alert=function Control$alert(h,g,f){var e=$("#modalMessage");if(e.length==0){h.replace("<br/>","\r");alert(h);if(f!=null){f()}}else{if(g==null){g="Warning!"}e.find(".modal-header h3").html(g);e.find(".modal-body p").html(h);e.modal("show");if(f!=null){e.find(".modal-header .close").unbind("click").click(function(){f()});e.find(".modal-footer .btn-primary").unbind("click").click(function(){f()})}}};Control.confirm=function Control$confirm(j,i,h,g){var f=$("#modalPrompt");if(f.length==0){j.replace("<br>","\r");if(confirm(j)==true){if(h!=null){h()}}else{if(g!=null){g()}}}else{if(i==null){i="Confirm?"}f.find(".modal-header h3").html(i);f.find(".modal-body p").html(j);f.modal({backdrop:"static",keyboard:false});f.find(".modal-footer .btn-primary").unbind("click").click(function(){f.modal("hide");if(h!=null){h()}});f.find(".modal-footer .btn-cancel").unbind("click").click(function(){f.modal("hide");if(g!=null){g()}})}};Control.popup=function Control$popup(f,j,i,h){var g=$("#modalPrompt");if(g.length==0){alert("Page requires modalPrompt control to support popup!")}else{if(j==null){j="Input required."}g.find(".modal-header h3").html(j);g.find(".modal-body p").empty().append(f);g.modal({backdrop:"static",keyboard:false});g.find(".modal-footer .btn-primary").unbind("click").click(function(){g.modal("hide");var a=[];$.each(g.find(".modal-body input"),function(){a.push($(this).val())});$.each(g.find(".modal-body textarea"),function(){a.push($(this).val())});if(i!=null){i(a)}});g.find(".modal-footer .btn-cancel").unbind("click").click(function(){g.modal("hide");if(h!=null){h()}})}};var Browser=function Browser$(){};Browser.IsMSIE=function Browser$IsMSIE(){return(navigator.appName=="Microsoft Internet Explorer")};Browser.IsMobile=function Browser$IsMobile(b){if(b!==undefined){Browser.isMobile=b}return Browser.isMobile};Browser.isMobile=false;Browser.MSIE_Version=function Browser$MSIE_Version(){var d=-1;if(Browser.IsMSIE){var c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(c.exec(navigator.userAgent)!=null){d=parseFloat(RegExp.$1)}}return d};Control.Icons={};Control.Icons.forSources=function Control$Icons$forSources(k){var h=$("<span />");if(k.HasField(FieldNames.Sources)){var l=k.GetFieldValue(FieldNames.Sources);if(l!=null){l=l.split(",");for(var j in l){switch(l[j]){case"Facebook":var i=k.GetFieldValue(FieldNames.FacebookID);var g=$('<i class="icon-facebook-sign" />').appendTo(h);if(i!=null){g.click(function(){window.open("http://www.facebook.com/"+i);return false})}break;case"Directory":h.append('<i class="icon-azure" />');break}}}else{if(k.ItemTypeID==ItemTypes.Contact){h.append('<i class="icon-user"></i>')}}}return h};Control.Icons.forItemType=function Control$Icons$forItemType(e){var f=e;if(typeof(e)=="object"){f=e.ItemTypeID}var d=$("<i></i>");switch(f){case ItemTypes.Activity:if(typeof(e)=="object"){if(e.IsPaused()){d.addClass("icon-pause")}else{if(e.IsActive()){d.addClass("icon-play")}else{if(e.IsComplete()){d.addClass("icon-check")}else{d.addClass("icon-stop")}}}}else{d.addClass("icon-play")}break;case ItemTypes.Step:d.addClass("icon-check");break;case ItemTypes.Contact:d.addClass(e.IsFolder()?"icon-group":"icon-user");break;case ItemTypes.Location:d.addClass("icon-map-marker");break;case ItemTypes.Category:return Control.Icons.forFolder(e.IsFolder()?e:e.GetFolder());default:d.addClass("icon-folder-close");break}return d};Control.Icons.forActionType=function Control$Icons$forActionType(e){var f=e;if(e!=null&&typeof(e)=="object"){f=e.Name}var d=$("<i></i>");switch(f){case ActionTypes.All:d.addClass("icon-play");break;case ActionTypes.Reminder:d.addClass("icon-time");break;case ActionTypes.Call:d.addClass("icon-phone");break;case ActionTypes.SendEmail:d.addClass("icon-envelope");break;case ActionTypes.Find:d.addClass("icon-search");break;case ActionTypes.AskFriends:d.addClass("icon-facebook");break;case ActionTypes.Schedule:d.addClass("icon-calendar");break;case ActionTypes.Errand:d.addClass("icon-shopping-cart");break;case ActionTypes.TextMessage:d.addClass("icon-list-alt");break;default:d.addClass("icon-question-sign");break}return d};Control.Icons.forFolder=function Control$Icons$forFolder(e){var f=e;if(e!=null&&typeof(e)=="object"){f=e.Name}var d=$("<i></i>");switch(f){case UserEntities.Inbox:d.addClass("icon-envelope");break;case UserEntities.People:d.addClass("icon-group");break;case UserEntities.Places:d.addClass("icon-globe");break;case UserEntities.Personal:d.addClass("icon-user");break;case UserEntities.Home:d.addClass("icon-home");break;case UserEntities.Auto:d.addClass("icon-truck");break;default:d.addClass("icon-folder-close");break}return d};Control.Icons.forMap=function Control$Icons$forMap(i){var j=i.GetFieldValue(FieldNames.WebLinks);if(j!=null&&j.length>0){var l=new LinkArray(j).Links();for(var h in l){var k=l[h];if(k.Name=="Map"&&k.Url!=null){var g=$('<i class="icon-map-marker"></i>');g.attr("href",k.Url);g.attr("title","Map").tooltip(Control.ttDelay);g.click(function(){window.open($(this).attr("href"));return false});return g}}}return $("<i></i>")};Control.Icons.deleteBtn=function Control$Icons$deleteBtn(d){var c=$('<i class="icon-remove-sign"></i>');c.css("cursor","pointer");c.data("item",d);c.attr("title","Delete").tooltip(Control.noDelay);c.bind("click",function(){var a=$(this);a.tooltip("hide");var f=a.data("item");var b=(f.ParentID==null)?f.GetFolder():f.GetParent();f.Delete(b);return false});return $('<a class="icon" />').append(c)};Control.Icons.createToolbarButton=function Control$Icons$createToolbarButton(i,k){var g=$('<a class="btn btn-step" />').append(i);var h=i.find("i");h.addClass("icon-blue");var l=h.attr("title");h.attr("title",null);var j=$("<p />").appendTo(g);j.html(l);g.click(function(a){h.click();return(k==true)?true:false});return g};Control.Icons.completeBtn=function Control$Icons$completeBtn(f,e){var d=$('<i class="icon-check icon-large"></i>');d.data("item",f);d.attr("title","Done");if(!Browser.IsMobile()){d.attr("title","Complete").tooltip(Control.ttDelay)}d.click(function(){var a=$(this);a.tooltip("hide");var b=a.data("item");if(e==null){b.Complete();return true}if(e(b)){b.Complete();return true}return false});return $('<a class="icon" />').append(d)};Control.Icons.completeHandler=function Control$Icons$completeHandler(n){var j=n.GetActionType();var k=n.GetParent();if(j==null||k==null){return false}var h=null;var m=null;switch(j.Name){case ActionTypes.Find:h=$("<div>Where will this happen?<p/></div>");var l=n.GetField(FieldNames.Locations);var i=Control.LocationList.renderInput(h,n,l);m=k.Name;break;default:return true}if(h!=null){Control.popup(h,m,function(a){n.Complete();return true},function(a){return false})}return false};Control.Icons.skipBtn=function Control$Icons$skipBtn(d){var c=$('<i class="icon-step-forward icon-large"></i>');c.data("item",d);c.attr("title","Skip");if(!Browser.IsMobile()){c.tooltip(Control.ttDelay)}c.bind("click",function(){var a=$(this);a.tooltip("hide");var b=a.data("item");b.Skip();return true});return $('<a class="icon" />').append(c)};Control.Icons.deferBtn=function Control$Icons$deferBtn(d){var c=$('<i class="icon-time icon-large icon-blue"></i>');c.data("item",d);c.attr("title","Defer");if(!Browser.IsMobile()){c.tooltip(Control.ttDelay)}c.bind("click",function(){var a=$(this);a.tooltip("hide");return true});return c};Control.Icons.infoBtn=function Control$Icons$infoBtn(d){var c=$('<i class="icon-info-sign  icon-large"></i>');c.data("item",d);c.attr("title","Info");if(!Browser.IsMobile()){c.tooltip(Control.ttDelay)}c.bind("click",function(){var a=$(this);a.tooltip("hide");var b=a.data("item");NextStepsPage.showManager(NextStepsPage.infoManager);NextStepsPage.infoManager.selectItem(b);return false});return $('<a class="icon" />').append(c)};Control.Icons.callBtn=function Control$Icons$callBtn(d){var c=$('<i class="icon-phone icon-large"></i>');c.data("item",d);c.attr("title","Call");if(!Browser.IsMobile()){c.tooltip(Control.ttDelay)}c.bind("click",function(){var a=$(this);a.tooltip("hide");var b=a.data("item");var f=b.GetPhoneNumber();if(f!=null){if(Browser.IsMobile()){window.open("tel:"+f)}else{Control.alert("<p>This action only works on a mobile device</p>","call "+Control.Icons.formatPhoneNumber(f))}return false}return false});return $('<a class="icon" />').append(c)};Control.Icons.formatPhoneNumber=function Control$Icons$formatPhoneNumber(b){if(b.length==7){return b.slice(0,3)+"-"+b.slice(3,7)}if(b.length==10){return"("+b.slice(0,3)+") "+b.slice(3,6)+"-"+b.slice(6,10)}return b};Control.Icons.mapBtn=function Control$Icons$mapBtn(e){var f=e.GetMapLink();if(f!=null){var d=$('<i class="icon-map-marker icon-large icon-blue"></i>');d.attr("href",f.Url);d.attr("title","Map");if(!Browser.IsMobile()){d.tooltip(Control.ttDelay)}d.click(function(){window.open($(this).attr("href"));return false});return $('<a class="icon" />').append(d)}};Control.Icons.emailBtn=function Control$Icons$emailBtn(d){var c=$('<i class="icon-envelope icon-large icon-blue"></i>');c.data("item",d);c.attr("title","Email");if(!Browser.IsMobile()){c.tooltip(Control.ttDelay)}c.click(function(){var a=$(this);a.tooltip("hide");var f=a.data("item");var b=f.GetEmail();if(b!=null){window.open("mailto:"+b)}return false});return $('<a class="icon" />').append(c)};Control.Icons.textBtn=function Control$Icons$textBtn(d){var c=$('<i class="icon-list-alt icon-large"></i>');c.data("item",d);c.attr("title","Text");if(!Browser.IsMobile()){c.tooltip(Control.ttDelay)}c.click(function(){var a=$(this);a.tooltip("hide");var b=a.data("item");var f=b.GetPhoneNumber();if(f!=null){if(Browser.IsMobile()){window.open("sms:"+f)}else{Control.alert("<p>This action only works on a mobile device</p>","text "+Control.Icons.formatPhoneNumber(f))}return false}return false});return $('<a class="icon" />').append(c)};Control.Icons.scheduleBtn=function Control$Icons$scheduleBtn(d){var c=$('<i class="icon-calendar icon-large"></i>');c.data("item",d);c.attr("title","Calendar");if(!Browser.IsMobile()){c.attr("title","Add to calendar").tooltip(Control.ttDelay)}c.bind("click",function(){var b=$(this);b.tooltip("hide");var j=b.data("item");var h=j.GetParent();var a=$('<div><label>Date: </label><input type="date"/><label>Start time: </label><input type="time"/><label>End time: </label><input type="time"/><label>Title: </label><input type="text" id="name"/></div>');a.find("#name").val(h.Name);var i="When should appointment be scheduled for?";Control.popup(a,i,function(r){if(r[0].length==0){Control.alert("Please provide a date for the appointment","Schedule appointment")}else{var v=new Date();var w=new Date(r[0]);if(w<v){Control.alert("The date you provided is in the past","Schedule appointment");return}var f=new Date(w);var x=Utilities.parseTime(r[1]);var g=Utilities.parseTime(r[2]);if(x!=null){w.setHours(x.getHours());w.setMinutes(x.getMinutes());if(g!=null){f.setHours(g.getHours());f.setMinutes(g.getMinutes())}else{f.setHours(x.getHours()+1);f.setMinutes(x.getMinutes())}}else{w.setHours(0);w.setMinutes(0);f.setDate(f.getDate()+1);f.setHours(0);f.setMinutes(0)}var s=j.GetLocation();var t=(s!=null)?s.Address:null;var u=(r[3].length>0)?r[3]:h.Name;var e=Appointment.Extend({Name:u,StartTime:w,EndTime:f,Location:t,ItemID:j.ID});Service.InvokeController("Actions","CreateAppointment",{Appointment:e},function(l){var m=l.result;if(m.StatusCode!="200"){Control.alert("Server was unable to add appointment","Schedule appointment")}else{var n=m.Result;var o=j.update(n,null);j.Complete();var k=(x!=null)?w.format("shortDateTime"):w.format("shortDate");Control.alert("An appointment for "+k+" was created on your calendar","Schedule appointment")}})}});return false});return $('<a class="icon" />').append(c)};Control.Icons.askFriendsBtn=function Control$Icons$askFriendsBtn(d){var c=$('<i class="icon-facebook icon-large"></i>');c.data("item",d);c.attr("title","Ask");if(!Browser.IsMobile()){c.attr("title","Ask Facebook Friends").tooltip(Control.ttDelay)}c.bind("click",function(){var b=$(this);b.tooltip("hide");var l=b.data("item");var j=l.GetParent();var a=$("<div><label>Question: </label><textarea /></div>");var m="Redmond";var n="Do you know a good "+l.GetExtendedFieldValue(ExtendedFieldNames.Article)+" in "+m+"?";a.find("textarea").val(n).css("height","75");var k="Ask Facebook friends";Control.popup(a,k,function(e){if(e[0].length==0){Control.alert("Please provide a question to ask on Facebook","Ask Facebook friends")}else{n=e[0];Service.InvokeController("Actions","PostOnFacebook",{Question:n},function(f){var g=f.result;if(g.StatusCode!="200"){Control.alert("Server was unable to post on Facebook","Ask Facebook friends")}else{var h=g.Result;if(h!=null){var i=l.update(h,null);l.Complete()}Control.alert("Question posted on Facebook!","Ask Facebook friends")}})}});return false});return $('<a class="icon" />').append(c)};Control.Icons.findLocalBtn=function Control$Icons$findLocalBtn(d){var c=$('<i class="icon-search icon-large"></i>');c.data("item",d);c.attr("title","Find");if(!Browser.IsMobile()){c.tooltip(Control.ttDelay)}c.bind("click",function(){var a=$(this);a.tooltip("hide");var b=a.data("item");var f=b.Name.toLowerCase();f=f.replace(/^find an /,"");f=f.replace(/^find a /,"");f=f.replace(/^find /,"");window.open("https://maps.google.com/?q="+f+"&radius=1");return false});return $('<a class="icon" />').append(c)};Control.Text={};Control.Text.render=function Control$Text$render(i,l,k,m,o,n){var m=(m==null)?"span":m;var j;var p=l.GetFieldValue(k);if(k.DisplayType==DisplayTypes.DatePicker){p=Control.DateTime.format(p,"mediumDate")}else{if(k.FieldType==FieldTypes.DateTime){p=Control.DateTime.format(p)}}if(p!=null){j=$("<"+m+"/>").appendTo(i);j.addClass(k.Class);p=((o==null)?"":o)+p+((n==null)?"":n);j.html(p)}return j};Control.Text.renderLabel=function Control$Text$renderLabel(f,i,h){var g;var j=i.GetFieldValue(h);if(j!=null){g=$("<label><strong>"+j+"</strong></label>").appendTo(f);g.addClass(h.Class)}return g};Control.Text.renderEmail=function Control$Text$renderEmail(f,i,h){var g;var j=i.GetFieldValue(h);if(j!=null){g=$("<a />").appendTo(f);g.addClass(h.Class);g.attr("href","mailto:"+j);g.html(j)}return g};Control.Text.renderActivityLink=function Control$Text$renderActivityLink(g,j,i){var h;var k=j.GetParent();var l=k.Name;if(l!=null){h=$("<a>"+l+"</a>").appendTo(g);h.css("whitespace","nowrap");h.click(function(a){i(k)})}return h};Control.Text.renderInput=function Control$Text$renderInput(d,f,e){$text=$('<input type="text" />').appendTo(d);$text=Control.Text.base($text,f,e);Control.Text.placeholder($text,e);$text.change(function(a){Control.Text.update($(a.srcElement))});$text.keypress(function(a){if(a.which==13){Control.Text.update($(a.srcElement));return false}});return $text};Control.Text.renderInputNew=function Control$Text$renderInput(e,g,f,h){$text=$('<input type="text" />').appendTo(e);$text=Control.Text.base($text,g,f);$text.data("list",h);$text.keypress(function(a){if(a.which==13){Control.Text.insert($(a.srcElement));return false}});if(g.ItemTypeID==ItemTypes.Location){Control.Text.autoCompletePlace($text,Control.Text.insert)}else{if(g.ItemTypeID==ItemTypes.Contact){Control.Text.autoCompleteContact($text,Control.Text.insert);Control.Text.placeholder($text,"Enter a contact")}else{if(g.ItemTypeID==ItemTypes.Step){Control.Text.placeholder($text,"Enter next step")}else{Control.Text.placeholder($text,"Enter an item")}}}return $text};Control.Text.renderTextArea=function Control$Text$renderTextArea(d,f,e){$text=$("<textarea></textarea>").appendTo(d);$text=Control.Text.base($text,f,e);Control.Text.placeholder($text,e);$text.change(function(a){Control.Text.update($(a.srcElement))});return $text};Control.Text.renderInputAddress=function Control$Text$renderInputAddress(d,f,e){$text=$('<input type="text" />').appendTo(d);$text=Control.Text.base($text,f,e);$text.keypress(function(a){if(a.which==13){Control.Text.updateAddress($(a.srcElement));return false}});$text=Control.Text.autoCompletePlace($text,Control.Text.updateAddress);return $text};Control.Text.renderInputGrocery=function Control$Text$renderInputGrocery(d,f,e){$text=$('<input type="text" />').appendTo(d);$text=Control.Text.base($text,f,e);$text.keypress(function(a){if(a.which==13){Control.Text.updateGrocery($(a.srcElement));return false}});$text=Control.Text.autoCompleteGrocery($text,Control.Text.updateGrocery);return $text};Control.Text.autoCompletePlace=function Control$Text$autoCompletePlace(f,j){f.unbind("keypress");f.keypress(function(a){if(a.which==13){return false}});f.unbind("click").bind("click",function(a){$(".pac-container").css("z-index","10000");f.unbind("click");return true});var g=new google.maps.places.Autocomplete(f[0]);var h=function(a,b){var c=0.5;return new google.maps.LatLngBounds(new google.maps.LatLng(a-c,b-c),new google.maps.LatLng(a+c,b+c))};var i=h(47.65,-122.3);g.setBounds(i);google.maps.event.addListener(g,"place_changed",function(){f.data("place",g.getPlace());j(f)});return f};Control.Text.autoCompleteAddress=function Control$Text$autoCompleteAddress(c,d){c.autocomplete({source:function(a,b){Service.Geocoder().geocode({address:a.term},function(i,j){if(j==google.maps.GeocoderStatus.OK){var h=$.map(i,function(e){return{label:e.formatted_address,value:e.formatted_address,latlong:e.geometry.location.toUrlValue()}});b(h)}})},select:function(a,b){$(this).val(b.item.label);$(this).data(FieldNames.LatLong,b.item.latlong);d($(this));return false},minLength:2});return c};Control.Text.autoCompleteContact=function Control$Text$autoCompleteContact(c,d){c.autocomplete({source:function(a,b){Service.InvokeController("UserInfo","PossibleContacts",{startsWith:a.term},function(k){var l=k.result;var i=[];if(l.Count>0){for(var j in l.Contacts){i.push({label:j,value:j,json:l.Contacts[j]})}}b(i)})},select:function(a,b){$(this).val(b.item.label);$(this).data(FieldNames.Contacts,b.item.json);d($(this));return false},minLength:1});return c};Control.Text.autoCompleteGrocery=function Control$Text$autoCompleteGrocery(c,d){c.autocomplete({source:function(a,b){Service.InvokeController("Grocery","GroceryNames",{startsWith:a.term},function(m){var n=m.result;var i=[];if(n.Count>0){for(var k in n.Groceries){var l=n.Groceries[k];i.push({label:l.Name,value:l.Name,json:l})}}b(i)})},select:function(a,b){$(this).val(b.item.label);$(this).data("grocery",b.item.json);d($(this));return false},minLength:1});return c};Control.Text.insert=function Control$Text$insert(j){var k=j.data("field");if(k.Name==FieldNames.Name){var r=j.val();if(r==null||r.length==0){return false}var m=j.data("item");var p=j.data("list");if(m.ItemTypeID==ItemTypes.Location){var q=j.data("place");var o=j.data(FieldNames.LatLong);if(q!=null&&q.geometry!=null){m=Control.Text.applyPlace(m,q);r=q.name}else{if(o!=null){m.SetFieldValue(FieldNames.LatLong,o);m.SetFieldValue(FieldNames.Address,r)}}}if(m.ItemTypeID==ItemTypes.Contact){var n=j.data(FieldNames.Contacts);if(n!=null){contact=$.parseJSON(n);if(contact.ItemTypeID==ItemTypes.Contact){m=Item.Extend(contact)}}}if(m.ItemTypeID==ItemTypes.Grocery){var l=j.data("grocery");if(l!=null){Control.Text.applyGrocery(m,l);r=l.Name}}m.SetFieldValue(k,r);p.InsertItem(m)}};Control.Text.update=function Control$Text$update(h,i){var l=h.data("item");var k=h.data("field");var n=h.val();var j=l.GetFieldValue(k);if(k.FieldType==FieldTypes.DateTime){n=Control.DateTime.formatUTC(n)}if(n!=j){var m=l.Copy();m.SetFieldValue(k,n);l.Update(m,i)}};Control.Text.updateAddress=function Control$Text$updateAddress(j){var n=j.data("item");var m=j.data("field");var r=j.val();var l=n.GetFieldValue(m);var q=n.Copy();var p=j.data("place");var o=j.data(FieldNames.LatLong);if(p!=null&&p.geometry!=null){q=Control.Text.applyPlace(q,p,m.Name)}else{if(o!=null){var k=n.GetFieldValue(FieldNames.LatLong);if(k==null||k!=o){q.SetFieldValue(FieldNames.LatLong,o);q.SetFieldValue(m,r)}}else{if(r!=l){q.SetFieldValue(m,r)}}}n.Update(q)};Control.Text.applyPlace=function Control$Text$applyPlace(g,i,f){if(g.Name==null||f==FieldNames.Name){g.SetFieldValue(FieldNames.Name,i.name)}g.SetFieldValue(FieldNames.LatLong,i.geometry.location.toUrlValue());g.SetFieldValue(FieldNames.Address,i.formatted_address);if(i.formatted_phone_number!=null&&g.GetFieldValue(FieldNames.Phone)==null){g.SetFieldValue(FieldNames.Phone,i.formatted_phone_number)}var h=g.GetFieldValue(FieldNames.WebLinks);if(h==null||h=="[]"){var j=new LinkArray();if(i.types[0]=="street_address"){j.Add("http://maps.google.com/maps?z=15&t=m&q="+i.formatted_address,"Map")}else{j.Add(i.url,"Map")}if(i.website!=null){j.Add(i.website,"Website")}g.SetFieldValue(FieldNames.WebLinks,j.ToJson())}return g};Control.Text.updateGrocery=function Control$Text$updateGrocery(h){var l=h.data("item");var j=h.data("field");var n=h.val();var i=l.GetFieldValue(j);var m=l.Copy();var k=h.data("grocery");if(k!=null){m=Control.Text.applyGrocery(m,k,j.Name)}else{if(n!=i){m.SetFieldValue(j,n)}}l.Update(m)};Control.Text.applyGrocery=function Control$Text$applyGrocery(f,e,d){if(f.Name==null||d==FieldNames.Name){f.SetFieldValue(FieldNames.Name,e.Name)}f.SetFieldValue(FieldNames.Category,e.Category);f.SetFieldValue(FieldNames.Picture,e.ImageUrl);return f};Control.Text.base=function Control$Text$base(d,f,e){d.addClass(e.Class);d.data("item",f);d.data("field",e);d.val(f.GetFieldValue(e));return d};Control.Text.placeholder=function Control$Text$placeholder(c,d){if(typeof(d)=="object"){d="Enter "+d.DisplayName.toLowerCase()}c.attr("placeholder",d);if(Browser.IsMSIE()){if(c.val()==null||c.val().length==0){c.val(d);c.addClass("ie-placeholder")}c.focus(function(){var a=$(this);if(a.val()==a.attr("placeholder")){a.val("");a.removeClass("ie-placeholder")}});c.blur(function(){var a=$(this);if(a.val()==null||a.val().length==0){a.val(a.attr("placeholder"));a.addClass("ie-placeholder")}})}};Control.Checkbox={};Control.Checkbox.render=function Control$Checkbox$render(e,g,f){$checkbox=$('<input type="checkbox" class="checkbox" />').appendTo(e);$checkbox.addClass(f.Class);$checkbox.attr("title",f.DisplayName).tooltip(Control.ttDelay);if(g.GetFieldValue(f)==true){$checkbox.attr("checked","checked")}$checkbox.data("item",g);$checkbox.data("field",f);$checkbox.change(function(){Control.Checkbox.update($(this))});var h=g.GetParentContainer();if(g.IsStep()&&h.IsActivity()&&!h.IsPaused()&&(g.IsComplete()||g.IsSkipped())){$checkbox.attr("disabled","disabled")}return $checkbox};Control.Checkbox.update=function Control$Checkbox$update(g){var k=g.data("item");var j=g.data("field");var l=(g.attr("checked")=="checked");var i=k.GetFieldValue(j);if(l!=i){g.tooltip("hide");if(l==true&&j.Name==FieldNames.Complete&&k.HasField(FieldNames.CompletedOn)){k.Complete()}else{var h=k.Copy();h.SetFieldValue(j,l);k.Update(h)}}};Control.LinkArray={};Control.LinkArray.render=function Control$LinkArray$render(i,p,n){var m=$('<div class="link-array" />').appendTo(i);$text=$('<input type="text" />').appendTo(m);$text=Control.Text.base($text,p,n);$text.val("");Control.Text.placeholder($text,"Add a link");$text.change(function(a){Control.LinkArray.update($(a.srcElement))});$text.keypress(function(a){if(a.which==13){Control.LinkArray.update($(a.srcElement));return false}});var r=new LinkArray(p.GetFieldValue(n));var s=r.Links();if(s.length>0){for(var o in s){Control.LinkArray.deleteBtn(o).appendTo(m);var q=s[o];var l=$("<a/>").appendTo(m);var t=(q.Name==null)?q.Url:q.Name;l.html(t);l.attr("href",q.Url);l.attr("target","new")}}return $text};Control.LinkArray.update=function Control$LinkArray$update(g){var i=g.data("item");var h=g.data("field");var j=new LinkArray(i.GetFieldValue(h));var l=g.val();if(l!=null&&l.length>0){j.Add(l);var k=i.Copy();k.SetFieldValue(h,j.ToJson());i.Update(k)}};Control.LinkArray.deleteBtn=function Control$Icons$deleteBtn(d){var c=$('<i class="icon-remove-circle"></i>');c.css("cursor","pointer");c.attr("title","Remove Link").tooltip(Control.noDelay);c.data("index",d);c.bind("click",function(){var b=$(this);b.tooltip("hide");var a=b.parents(".link-array").first().find("input");var j=a.data("item");var i=a.data("field");var k=new LinkArray(j.GetFieldValue(i));k.Remove(b.data("index"));var l=j.Copy();l.SetFieldValue(i,k.ToJson());j.Update(l);return false});return $('<a class="icon" />').append(c)};Control.DateTime={};Control.DateTime.renderDatePicker=function Control$DateTime$renderDatePicker(d,f,e){$date=$('<input type="text" />').appendTo(d);$date.addClass(e.Class);$date.data("item",f);$date.data("field",e);$date.val(Control.DateTime.format(f.GetFieldValue(e),"shortDate"));$date.datepicker({numberOfMonths:2,onClose:function(b,a){Control.DateTime.update(a.input)}});return $date};Control.DateTime.renderDateTimePicker=function Control$DateTime$renderDateTimePicker(d,f,e){$date=$('<input type="text" />').appendTo(d);$date.addClass(e.Class);$date.data("item",f);$date.data("field",e);$date.val(Control.DateTime.format(f.GetFieldValue(e),"shortDateTime"));$date.datetimepicker({ampm:true,timeFormat:"h:mm TT",hourGrid:4,minuteGrid:15,stepMinute:15,numberOfMonths:2,onClose:function(b,a){Control.DateTime.update(a.input)}});return $date};Control.DateTime.renderRange=function Control$DateTime$renderRange(n,v,u,t,y){var y=(y==null)?"span":y;var o,z;var x=v.GetFieldValue(u);var s=v.GetFieldValue(t);if(x!=null&&s!=null){if(u.FieldType==FieldTypes.DateTime&&t.FieldType==FieldTypes.DateTime){var w=new Date().parseRFC3339(x);var p=new Date().parseRFC3339(s);if(w.toDateString()==p.toDateString()){var r=p.format().split(" ");var q=r[r.length-2]+" "+r[r.length-1];z="On "+w.format()+" to "+q}else{z="From "+w.format()+" until "+p.format()}}else{z="From "+x+" until "+s}}if(z!=null){o=$("<"+y+"/>").appendTo(n);o.addClass(u.Class);o.html(z)}return o};Control.DateTime.update=function Control$DateTime$update(b){Control.Text.update(b,null)};Control.DateTime.format=function Control$DateTime$format(h,g){if(h!=null&&h.length>0){try{var e=new Date().parseRFC3339(h);return e.format(g)}catch(f){}}return h};Control.DateTime.formatUTC=function Control$DateTime$formatUTC(b){return Control.DateTime.format(b,"isoUtcDateTime")};Control.ContactList={};Control.ContactList.renderInput=function Control$ContactList$renderInput(i,n,l){$input=$('<input type="text" />').appendTo(i);$input.addClass(l.Class);$input.data("item",n);$input.data("field",l);$input.keypress(function(a){if(a.which==13){Control.ContactList.update($(a.srcElement));return false}});var p=n.GetFieldValue(l);var o="";if(p!=null&&p.IsList){var k=p.GetItems();for(var m in k){var j=k[m].GetFieldValue(FieldNames.EntityRef);if(j!=null){o+=j.Name}break}}$input.val(o);Control.Text.autoCompleteContact($input,Control.ContactList.update);return $input};Control.ContactList.update=function Control$ContactList$update(k){var r=k.data("item");var q=k.data("field");var n=k.val();if(n==null||n.length==0){r.RemoveReferences(q);return}var l;var s=k.data(FieldNames.Contacts);if(s!=null){l=$.parseJSON(s)}var t=r.GetParent();if(l!=null&&l.ItemTypeID==ItemTypes.Reference){l={Name:l.Name,ID:l.FieldValues[0].Value};r.AddReference(q,l,true);if(t!=null&&t.IsActivity){t.AddReference(q,l,false)}}else{if(l!=null){l=Item.Extend(l);var p=l.GetFieldValue(FieldNames.FacebookID);var o=DataModel.FindContact(l.Name,p);if(o!=null){r.AddReference(q,l,true);if(t!=null&&t.IsActivity){t.AddReference(q,o,false)}return}}else{l=Item.Extend({Name:n,ItemTypeID:ItemTypes.Contact})}var m=DataModel.UserSettings.GetDefaultList(ItemTypes.Contact);DataModel.InsertItem(l,m,null,null,null,function(a){r.AddReference(q,a,true);if(t!=null&&t.IsActivity){t.AddReference(q,a,false)}})}};Control.LocationList={};Control.LocationList.renderInput=function Control$LocationList$renderInput(i,l,j){$input=$('<input type="text" />').appendTo(i);$input.addClass(j.Class);$input.data("item",l);$input.data("field",j);$input.keypress(function(a){if(a.which==13){Control.LocationList.update($(a.srcElement));return false}});var p=l.GetFieldValue(j);var o="";if(p!=null&&p.IsList){var n=p.GetItems();for(var k in n){var m=n[k].GetFieldValue(FieldNames.EntityRef);if(m!=null){o=m.Name}break}}$input.val(o);Control.Text.autoCompletePlace($input,Control.LocationList.update);return $input};Control.LocationList.update=function Control$LocationList$update(k){var o=k.data("item");var n=k.data("field");var l=k.val();if(l==null||l.length==0){o.RemoveReferences(n);return}var s=o.GetParent();var p=k.data(FieldNames.LatLong);var t=k.data("place");if(t!=null&&t.geometry!=null){p=t.geometry.location.toUrlValue()}var m=DataModel.FindLocation(l,p);if(m!=null){o.AddReference(n,m,true);if(s!=null&&s.IsActivity){s.AddReference(n,m,false)}}else{var q=DataModel.UserSettings.GetDefaultList(ItemTypes.Location);var r=Item.Extend({Name:l,ItemTypeID:ItemTypes.Location});if(t!=null&&t.geometry!=null){Control.Text.applyPlace(r,t)}else{r.SetFieldValue(FieldNames.Address,l);if(p!=null){r.SetFieldValue(FieldNames.LatLong,p)}}DataModel.InsertItem(r,q,null,null,null,function(a){o.AddReference(n,a,true);if(s!=null&&s.IsActivity){s.AddReference(n,a,false)}})}};Control.List={};Control.List.sortable=function Control$List$sortable(b){b.sortable({axis:"y",handle:".drag-handle",stop:function(u,A){$("i").tooltip("hide");var a=A.item;var w=a.data("item");if(w!=null){var z=a.parent("ul").children("li");for(var v in z){var t=$(z[v]).data("item");if(t!=null&&w.ID==t.ID){var i=$(z[v]).prevAll("li").first();var y=(i.length==0)?null:i.data("item");var s=Number((y==null)?0:y.SortOrder);var e=$(z[v]).nextAll("li").first();var x=(e.length==0)?null:e.data("item");var r=Number((x==null)?s+1000:x.SortOrder);var B=w.Copy();B.SortOrder=s+((r-s)/2);w.Update(B);break}}}}})};Control.ItemType={};Control.ItemType.renderDropdown=function Control$ItemType$renderDropdown(r,w,B){var y=DataModel.Constants.ItemTypes;var u=y[w.ItemTypeID].Name;var t=t=$('<div class="control-group"></div>').appendTo(r);if(B!=true){var A=(w.IsFolder()||w.IsList)?"List":"Item";var z='<label class="control-label">Type of '+A+"</label>";$(z).appendTo(t)}var p=$('<div class="btn-group" />').appendTo(t);var o=$('<a class="btn dropdown-toggle" data-toggle="dropdown" />').appendTo(p);Control.Icons.forItemType(w).appendTo(o);if(B!=true){$("<span>&nbsp;&nbsp;"+u+"</span>").appendTo(o);$('<span class="pull-right">&nbsp;&nbsp;<span class="caret" /></span>').appendTo(o)}var q=$('<ul class="dropdown-menu" />').appendTo(p);q.data("item",w);for(var v in y){var x=y[v];if(x.UserID==SystemUsers.User||x.UserID==DataModel.User.ID){var s=$("<li><a></a></li>").appendTo(q);s.find("a").append(Control.Icons.forItemType(v));s.find("a").append("<span>&nbsp;&nbsp;"+y[v].Name+"</span>");s.data("value",v);s.click(function(a){Control.ItemType.update($(this));a.preventDefault()})}}return t};Control.ItemType.update=function Control$ItemType$update(h){var i=h.parent().data("item");var j=i.Copy();j.ItemTypeID=h.data("value");var f=h.parents(".btn-group").first().find(".btn");f.find("i").replaceWith(Control.Icons.forItemType(j));var g=h.find("span").first();if(g.length>0){f.find("span").first().html(g.html())}i.Update(j)};Control.ActionType={};Control.ActionType.renderDropdown=function Control$ActionType$renderDropdown(q,w,z){if(!w.HasField(FieldNames.ActionType)){return}var u=w.GetFieldValue(FieldNames.ActionType);if(u==null){u=ActionTypes.Reminder}var s=s=$('<div class="control-group"></div>').appendTo(q);if(z!=true){var y=(w.IsFolder()||w.IsList)?"List":"Item";var x='<label class="control-label">Type of '+y+"</label>";$(x).appendTo(s)}var o=$('<div class="btn-group" />').appendTo(s);var n=$('<a class="btn dropdown-toggle" data-toggle="dropdown" />').appendTo(o);Control.Icons.forActionType(u).appendTo(n);if(z!=true){$("<span>&nbsp;&nbsp;"+u+"</span>").appendTo(n);$('<span class="pull-right">&nbsp;&nbsp;<span class="caret" /></span>').appendTo(n)}var p=$('<ul class="dropdown-menu" />').appendTo(o);p.data("item",w);for(var v in ActionTypes){var t=ActionTypes[v];if(t==ActionTypes.All){continue}var r=$("<li><a></a></li>").appendTo(p);r.find("a").append(Control.Icons.forActionType(t));r.find("a").append("<span>&nbsp;&nbsp;"+t+"</span>");r.data("value",v);r.click(function(a){Control.ActionType.update($(this));a.preventDefault()})}return s};Control.ActionType.update=function Control$ActionType$update(j){var k=j.parent().data("item");var n=k.Copy();var l=j.data("value");var m=ActionTypes[l];n.SetFieldValue(n.GetField(FieldNames.ActionType),m);var h=j.parents(".btn-group").first().find(".btn");h.find("i").replaceWith(Control.Icons.forActionType(m));var i=j.find("span").first();if(i.length>0){h.find("span").first().html(i.html())}k.Update(n)};Control.DeferButton={};Control.DeferButton.renderDropdown=function Control$DeferButton$renderDropdown(q,x){if(!x.HasField(FieldNames.DueDate)){return}var o=$('<div class="control-group inline" />').appendTo(q);if(Browser.IsMobile()){o.addClass("btn-group")}else{o.addClass("dropdown")}var r=Control.Icons.deferBtn(x);var n=$('<a class="dropdown-toggle" data-toggle="dropdown"></a>').append(r).appendTo(o);if(Browser.IsMobile()){n.addClass("btn btn-step")}var p=$('<ul class="dropdown-menu" />').appendTo(o);p.data("item",x);var y=r.attr("title");r.attr("title",null);var t=$("<p />").appendTo(n);t.html(y);var w=x.GetField(FieldNames.DueDate);var u=x.GetFieldValue(w);var v=new Date(u);var z=new Date();var s;if(v<=z.setDate(z.getDate()+1)){var s=$("<li><a></a></li>").css("border-top","0px").appendTo(p);s.find("a").append("<span>&nbsp;Tomorrow</span>");s.click(function(a){Control.DeferButton.update(x,1);a.preventDefault()})}if(v<=z.setDate(z.getDate()+6)){s=$("<li><a></a></li>").css("border-top","0px").appendTo(p);s.find("a").append("<span>&nbsp;Next week</span>");s.click(function(a){Control.DeferButton.update(x,7);a.preventDefault()})}if(v<=z.setDate(z.getDate()+23)){s=$("<li><a></a></li>").css("border-top","0px").appendTo(p);s.find("a").append("<span>&nbsp;Next month</span>");s.click(function(a){Control.DeferButton.update(x,30);a.preventDefault()})}return o};Control.DeferButton.update=function Control$DeferButton$update(k,i){var l=k.Copy();var j=k.GetField(FieldNames.DueDate);var g=k.GetFieldValue(j);var h=new Date(g);h=new Date();switch(i){case 7:i=7-h.getDay();h.setDate(h.getDate()+i);break;case 30:h.setDate(1);h.setMonth(h.getMonth()+1);break;default:h.setDate(h.getDate()+i);break}l.SetFieldValue(j,h.toUTCString());k.Update(l)};Control.ThemePicker={};Control.ThemePicker.render=function Control$ThemePicker$render(l){var p=DataModel.Constants.Themes;var n=DataModel.UserSettings.Preferences.Theme;var m=$('<div class="control-group"><label class="control-label">Theme</label></div>').appendTo(l);var j=$('<div class="btn-group" />').appendTo(m);var i=$('<a class="btn dropdown-toggle" data-toggle="dropdown" />').appendTo(j);$("<span>"+n+"</span>").appendTo(i);$('<span class="pull-right">&nbsp;&nbsp;<span class="caret" /></span>').appendTo(i);var k=$('<ul class="dropdown-menu" />').appendTo(j);for(var o in p){$("<li><a>"+p[o]+"</a></li>").appendTo(k)}k.click(function(b){var a=$(b.target);var c=a.html();DataModel.UserSettings.UpdateTheme(c);a.parents(".btn-group").find("span").first().html(c);b.preventDefault()});return m};Control.DateFormat=function Control$DateFormat(){var h=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,f=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,g=/[^-+\dA-Z]/g,e=function(b,a){b=String(b);a=a||2;while(b.length<a){b="0"+b}return b};return function(d,z,C){var m=Control.DateFormat;if(arguments.length==1&&Object.prototype.toString.call(d)=="[object String]"&&!/\d/.test(d)){z=d;d=undefined}d=d?new Date(d):new Date;if(isNaN(d)){throw SyntaxError("invalid date")}z=String(m.masks[z]||z||m.masks["default"]);if(z.slice(0,4)=="UTC:"){z=z.slice(4);C=true}var a=C?"getUTC":"get",b=d[a+"Date"](),c=d[a+"Day"](),x=d[a+"Month"](),D=d[a+"FullYear"](),s=d[a+"Hours"](),y=d[a+"Minutes"](),B=d[a+"Seconds"](),w=d[a+"Milliseconds"](),A=C?0:d.getTimezoneOffset(),o={d:b,dd:e(b),ddd:m.i18n.dayNames[c],dddd:m.i18n.dayNames[c+7],m:x+1,mm:e(x+1),mmm:m.i18n.monthNames[x],mmmm:m.i18n.monthNames[x+12],yy:String(D).slice(2),yyyy:D,h:s%12||12,hh:e(s%12||12),H:s,HH:e(s),M:y,MM:e(y),s:B,ss:e(B),l:e(w,3),L:e(w>99?Math.round(w/10):w),t:s<12?"a":"p",tt:s<12?"am":"pm",T:s<12?"A":"P",TT:s<12?"AM":"PM",Z:C?"UTC":(String(d).match(f)||[""]).pop().replace(g,""),o:(A>0?"-":"+")+e(Math.floor(Math.abs(A)/60)*100+Math.abs(A)%60,4),S:["th","st","nd","rd"][b%10>3?0:(b%100-b%10!=10)*b%10]};return z.replace(h,function(i){return i in o?o[i]:i.slice(1,i.length-1)})}}();Control.DateFormat.masks={"default":"ddd, mmm dd, yyyy h:MM TT",shortDate:"m/d/yy",mediumDate:"ddd, mmm dd, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",shortDateTime:"mm/dd/yyyy h:MM TT",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};Control.DateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(c,d){return Control.DateFormat(this,c,d)};Date.prototype.parseRFC3339=function(h){var g=/(\d\d\d\d)(-)?(\d\d)(-)?(\d\d)(T)?(\d\d)(:)?(\d\d)(:)?(\d\d)(\.\d+)?(Z|([+-])(\d\d)(:)?(\d\d))/;if(h.toString().match(new RegExp(g))){var d=h.match(new RegExp(g));var f=0;this.setUTCDate(1);this.setUTCFullYear(parseInt(d[1],10));this.setUTCMonth(parseInt(d[3],10)-1);this.setUTCDate(parseInt(d[5],10));this.setUTCHours(parseInt(d[7],10));this.setUTCMinutes(parseInt(d[9],10));this.setUTCSeconds(parseInt(d[11],10));if(d[12]){this.setUTCMilliseconds(parseFloat(d[12])*1000)}else{this.setUTCMilliseconds(0)}if(d[13]!="Z"){f=(d[15]*60)+parseInt(d[17],10);f*=((d[14]=="-")?-1:1);this.setTime(this.getTime()-f*60*1000)}}else{this.setTime(Date.parse(h))}return this};var DataModel=function DataModel$(){};DataModel.Constants={};DataModel.User={};DataModel.Folders={};DataModel.Suggestions={};DataModel.GalleryCategories={};DataModel.ActionTypes={};DataModel.UserSettings;DataModel.onDataChangedHandlers={};DataModel.timeStamp="/Date(0)/";DataModel.Init=function DataModel$Init(c,d){this.processConstants($.parseJSON(c));this.processUserData($.parseJSON(d))};DataModel.Close=function DataModel$Close(){Service.Close();DataModel.UserSettings.Save()};DataModel.AddDataChangedHandler=function(d,c){this.onDataChangedHandlers[d]=c};DataModel.RemoveDataChangedHandler=function(b){delete this.onDataChangedHandlers[b]};DataModel.Refresh=function DataModel$Refresh(d){var c=DataModel.UserSettings.ViewState;Service.GetResource(Service.UsersResource,null,function(a){DataModel.processUserData(a.result);DataModel.UserSettings.ViewState=c;DataModel.restoreSelection()})};DataModel.FindItem=function DataModel$FindItem(f){if(f!=null){var d=DataModel.Folders[f];if(d!=null){return d}for(id in DataModel.Folders){d=DataModel.Folders[id];var e=d.Items[f];if(e!=null){return e}}}return null};DataModel.FindActionType=function DataModel$FindActionType(c){if(c!=null){var d=DataModel.ActionTypes[c];if(d!=null){return d}}return null};DataModel.FindLocation=function DataModel$FindLocation(g,l){for(id in DataModel.Folders){var h=DataModel.Folders[id];if(h.ItemTypeID==ItemTypes.Location){for(id in h.Items){var i=h.Items[id];if(i.ItemTypeID==ItemTypes.Location){var k=i.GetFieldValue(FieldNames.LatLong);if(l!=null&&k!=null){if(l==k){return i}}else{var j=i.GetFieldValue(FieldNames.Address);if(g==j){return i}}}}}}return null};DataModel.FindContact=function DataModel$FindContact(j,f){for(id in DataModel.Folders){var g=DataModel.Folders[id];if(g.ItemTypeID==ItemTypes.Contact){for(id in g.Items){var h=g.Items[id];if(h.ItemTypeID==ItemTypes.Contact){var i=h.GetFieldValue(FieldNames.FacebookID);if(f!=null&&i!=null){if(f==i){return h}}else{if(j==h.Name){return h}}}}}}return null};DataModel.GetItems=function DataModel$GetItems(j,n,h){var m={};var i=(typeof(j)=="object")?j:DataModel.Folders[j];if(i!=undefined){if(h!=true){for(var k in i.Items){var l=i.Items[k];if(l.ParentID==n&&l.IsList){m[k]=i.Items[k]}}}for(var k in i.Items){var l=i.Items[k];if(l.ParentID==n&&!l.IsList){m[k]=i.Items[k]}}}return m};DataModel.InsertItem=function DataModel$InsertItem(q,m,k,n,j,l){if(q!=null&&q.Name!=null){var r=Service.ItemsResource;if(m==null){r=Service.FoldersResource}else{if(m.IsFolder()){q.FolderID=m.ID;q.ParentID=null;q.ItemTypeID=(q.ItemTypeID==null)?m.ItemTypeID:q.ItemTypeID}else{if(m.IsList!=null&&m.IsList){q.FolderID=m.FolderID;q.ParentID=m.ID;q.ItemTypeID=(q.ItemTypeID==null)?m.ItemTypeID:q.ItemTypeID}else{return false}}}if(k==null){if(m==null){var o=DataModel.FoldersMap.itemAt(-1);q.SortOrder=(o==null)?1000:o.SortOrder+1000}else{var p=ItemMap.itemAt(m.GetItems(),-1);q.SortOrder=(p==null)?1000:p.SortOrder+1000}}if(q.ID==null){q.ID=Math.uuid()}delete q.Created;if(m==null){q=DataModel.addFolder(q,j)}else{m.addItem(q,j)}Service.InsertResource(r,q,function(b){var a=b.result;q.update(a,null);if(l!=null){l(a)}});return true}return false};DataModel.InsertFolder=function DataModel$InsertFolder(f,d,e){return DataModel.InsertItem(f,null,d,e)};DataModel.UpdateItem=function DataModel$UpdateItem(h,j,f){if(h!=null&&j!=null){h.update(j,f);j.LastModified=DataModel.timeStamp;var i=(h.IsFolder())?Service.FoldersResource:Service.ItemsResource;var g=[h,j];if(i==Service.FoldersResource){g=[h.Copy(),j]}Service.UpdateResource(i,h.ID,g,function(a){var b=a.result;var c=h.update(b,null)});return true}return false};DataModel.DeleteItem=function DataModel$DeleteItem(l,j){if(l!=null){if(l.IsFolder()){DataModel.FoldersMap.remove(l);DataModel.fireDataChanged()}else{var o=l.GetParent();if(o!=null&&o.ItemTypeID==ItemTypes.Reference){l.GetFolder().ItemsMap.remove(l)}else{if(j!=null){var i=j.IsFolder()?j.ID:j.FolderID;var k=j.IsFolder()?null:j.ID;l.GetFolder().ItemsMap.remove(l);DataModel.deleteReferences(l.ID);DataModel.fireDataChanged(i,k)}else{var m=l.selectNextItem();var n=(m==null)?null:m.ID;l.GetFolder().ItemsMap.remove(l);DataModel.deleteReferences(l.ID);DataModel.fireDataChanged(l.FolderID,n)}}}var p=(l.IsFolder())?Service.FoldersResource:Service.ItemsResource;Service.DeleteResource(p,l.ID,l,function(b){var a=b.result});return true}return false};DataModel.GetGalleryCategories=function DataModel$GetGalleryCategories(d,c){if(c==null){c="system"}Service.GetResource(Service.GalleryResource,c,function(b){var a=b.result;if(a.length>0){DataModel.GalleryCategoriesRetrieved=new Date()}DataModel.processGalleryCategories(a);if(d!=null){d(DataModel.GalleryCategories)}})};DataModel.GetSuggestions=function DataModel$GetSuggestions(h,e,f){var g={};if(e==null){e=DataModel.User}g.EntityID=e.ID;g.FieldName=f;g.EntityType=EntityTypes.User;if(e.hasOwnProperty("ItemTypeID")){g.EntityType=(e.hasOwnProperty("FolderID"))?EntityTypes.Item:EntityTypes.Folder}Service.InsertResource(Service.SuggestionsResource,g,function(a){var b=a.result;if(b.length>0){DataModel.SuggestionsRetrieved=new Date()}DataModel.processSuggestions(b);if(h!=null){h(DataModel.Suggestions)}})};DataModel.SelectSuggestion=function DataModel$SelectSuggestion(j,h,g){h=(h==null)?Reasons.Chosen:h;var i=$.extend({},j);i.TimeSelected=DataModel.timeStamp;i.ReasonSelected=h;var f=[j,i];Service.UpdateResource(Service.SuggestionsResource,j.ID,f,function(a){var b=a.result;if(g!=null){g(i)}})};DataModel.RemoveSuggestion=function DataModel$RemoveSuggestion(d){var c=DataModel.Suggestions[d.GroupID];if(c!=null){delete c.Suggestions[d.ID]}};DataModel.fireDataChanged=function(e,g){if(DataModel.UserSettings.GetFolder(e)==null){for(var h in DataModel.onDataChangedHandlers){var f=DataModel.onDataChangedHandlers[h];if(typeof(f)=="function"){f(e,g)}}}};DataModel.getFolder=function(d){var c=DataModel.Folders[d];if(c==null){c=DataModel.UserSettings.GetFolder(d)}return c};DataModel.addFolder=function(d,c){d=Folder.Extend(d);if(d.ItemsMap==null){d.ItemsMap=new ItemMap([]);d.Items=d.ItemsMap.Items}DataModel.FoldersMap.append(d);if(c===undefined){DataModel.fireDataChanged(d.ID)}else{if(c!=null){DataModel.fireDataChanged(c.FolderID,c.ID)}}return d};DataModel.deleteReferences=function(n){for(var h in DataModel.Folders){var i=DataModel.Folders[h];for(var l in i.Items){var m=i.Items[l];if(m.ItemTypeID==ItemTypes.Reference){for(var k in m.FieldValues){var j=m.FieldValues[k];if(j.FieldName==FieldNames.EntityRef&&j.Value==n){m.GetFolder().ItemsMap.remove(m)}}}}}};DataModel.processConstants=function DataModel$processConstants(r){var i={};for(var s in r){i[s]=r[s]}var p=i.ItemTypes;for(var n in p){var o=ItemType.Extend(p[n]);var m={};for(var q in o.Fields){var j=o.Fields[q];j.ClassName="fn-"+j.Name.toLowerCase();j.Class=j.ClassName+" dt-"+j.DisplayType.toLowerCase();m[j.Name]=j}o.Fields=m;p[n]=o}i.ItemTypesMap=new ItemMap(p);i.ItemTypes=i.ItemTypesMap.Items;i.PrioritiesByName={};for(var n in i.Priorities){var t=i.Priorities[n];i.PrioritiesByName[t.Name]=t}DataModel.Constants=i};DataModel.processUserData=function DataModel$processUserData(e){var h={};for(var f in e){h[f]=e[f]}var g={};g.ID=h.ID;g.Name=h.Name;g.Email=h.Email;g.CreateDate=h.CreateDate;DataModel.User=g;DataModel.processFolders(h.Folders);DataModel.processActionTypes(DataModel.Constants.ActionTypes)};DataModel.processSuggestions=function DataModel$processSuggestions(t){var x={};var n=[];var r={};var u=0;for(var s in t){var w=t[s];if(w.ParentID==null){var q=w.GroupDisplayName;var p=r[q];if(p===undefined){p=(w.GroupDisplayName==SuggestionTypes.RefreshEntity)?w.GroupDisplayName:"Group_"+(u++).toString();r[q]=p;x[p]={GroupID:p,DisplayName:w.GroupDisplayName,Suggestions:{}}}w.GroupID=p;x[p].Suggestions[w.ID]=w}else{n.push(w)}}for(s in n){var i=n[s];for(p in x){var o=x[p];var v=o.Suggestions[i.ParentID];if(v!=null){if(v.Suggestions==null){v.Suggestions={}}v.Suggestions[i.ID]=i;break}}}DataModel.Suggestions=x};DataModel.processFolders=function DataModel$processFolders(k){var j,p;for(var l in k){k[l]=Folder.Extend(k[l]);var m=k[l].Items;for(var n in m){m[n]=Item.Extend(m[n])}k[l].ItemsMap=new ItemMap(m);k[l].Items=k[l].ItemsMap.Items;if(k[l].Name==SystemFolders.Client){j=l}if(k[l].Name==SystemFolders.WebClient){p=l}}var i=k.splice(j,1)[0];if(p==null){DataModel.UserSettings=new UserSettings(i);Service.InsertResource(Service.FoldersResource,{Name:SystemFolders.WebClient,ItemTypeID:ItemTypes.NameValue,SortOrder:0},function(a){var b=a.result;b=Folder.Extend(b);DataModel.UserSettings=new UserSettings(i,b)})}else{if(p>j){p--}var o=k.splice(p,1)[0];DataModel.UserSettings=new UserSettings(i,o)}DataModel.FoldersMap=new ItemMap(k);DataModel.Folders=DataModel.FoldersMap.Items};DataModel.processActionTypes=function DataModel$processActionTypes(c){var c={};for(var d in ActionTypes){c[d]=ActionType.Extend({Name:ActionTypes[d],ID:ActionTypes[d]})}DataModel.ActionTypesMap=new ItemMap(c);DataModel.ActionTypes=DataModel.ActionTypesMap.Items};DataModel.processGalleryCategories=function DataModel$processGalleryCategories(g){for(var i in g){var h=GalleryCategory.Extend(g[i]);g[i]=h;var f=h.Activities;for(var j in f){f[j]=GalleryActivity.Extend(f[j])}h.ActivitiesMap=new ItemMap(f);h.Activities=h.ActivitiesMap.Items}DataModel.GalleryCategoriesMap=new ItemMap(g);DataModel.GalleryCategories=DataModel.GalleryCategoriesMap.Items};DataModel.restoreSelection=function DataModel$restoreSelection(f){if(f===undefined&&DataModel.UserSettings!=null){f=DataModel.UserSettings.ViewState.SelectedItem}if(f!=null){var e=DataModel.FindItem(f);if(e!=null){DataModel.fireDataChanged(e.FolderID,e.ID);return}}var d=DataModel.UserSettings.ViewState.SelectedFolder;if(d!=null){DataModel.fireDataChanged(d);return}DataModel.fireDataChanged()};function Folder(){}Folder.Extend=function Folder$Extend(b){return $.extend(new Folder(),b)};Folder.prototype.Copy=function(){var b=$.extend(new Folder(),this);b.Items={};b.ItemsMap={};return b};Folder.prototype.IsFolder=function(){return true};Folder.prototype.IsCategory=function(){return(this.ItemTypeID==ItemTypes.Category)};Folder.prototype.IsActivity=function(){return(this.ItemTypeID==ItemTypes.Activity)};Folder.prototype.IsDefault=function(){var b=DataModel.UserSettings.GetDefaultList(this.ItemTypeID);if(b!=null){return(b.IsFolder())?(this.ID==b.ID):(this.ID==b.FolderID)}return false};Folder.prototype.IsSelected=function(){return DataModel.UserSettings.IsFolderSelected(this.ID)};Folder.prototype.IsExpanded=function(){return DataModel.UserSettings.IsFolderExpanded(this.ID)};Folder.prototype.Expand=function(b){DataModel.UserSettings.ExpandFolder(this.ID,b)};Folder.prototype.GetItemType=function(){return DataModel.Constants.ItemTypes[this.ItemTypeID]};Folder.prototype.GetItems=function(b){return DataModel.GetItems(this,null,b)};Folder.prototype.GetItem=function(b){return this.Items[b]};Folder.prototype.GetItemByName=function(e,f){for(id in this.Items){var d=this.Items[id];if(d.Name==e){if(f===undefined||d.ParentID==f){return d}}}return null};Folder.prototype.GetItemByValue=function(f,e){for(id in this.Items){var d=this.Items[id];if(d.ItemTypeID==ItemTypes.NameValue||d.ItemTypeID==ItemTypes.Reference){if(f==d.GetFieldValue(FieldNames.Value)&&(e===undefined||d.ParentID==e)){return d}}}return null};Folder.prototype.GetSelectedItem=function(){for(id in this.Items){if(DataModel.UserSettings.IsItemSelected(id)==true){return this.Items[id]}}return null};Folder.prototype.InsertItem=function(h,f,g,e){return DataModel.InsertItem(h,this,f,g,e)};Folder.prototype.Update=function(b){return DataModel.UpdateItem(this,b)};Folder.prototype.Delete=function(){return DataModel.DeleteItem(this)};Folder.prototype.addItem=function(f,d){f=Item.Extend(f);if(this.ItemsMap==null){this.ItemsMap=new ItemMap([f]);this.Items=this.ItemsMap.Items}else{this.ItemsMap.append(f)}if(d===undefined){var e=(f.IsList)?f.ID:f.ID;DataModel.fireDataChanged(this.ID,e)}else{if(d!=null){DataModel.fireDataChanged(d.FolderID,d.ID)}}};Folder.prototype.update=function(b){if(this.ID==b.ID){b=Folder.Extend(b);b.ItemsMap=this.ItemsMap;b.Items=this.ItemsMap.Items;b.FolderUsers=this.FolderUsers;DataModel.FoldersMap.update(b);DataModel.Folders=DataModel.FoldersMap.Items;DataModel.fireDataChanged(this.ID);return true}return false};function Item(){}Item.Extend=function Item$Extend(b){return $.extend(new Item(),b)};Item.prototype.Copy=function(){var d=this.GetFolder();var c=(d==null)?this:d.GetItem(this.ID);return $.extend(true,new Item(),(c==null)?this:c)};Item.prototype.IsFolder=function(){return false};Item.prototype.IsDefault=function(){var b=DataModel.UserSettings.GetDefaultList(this.ItemTypeID);if(b!=null){return(this.ID==b.ID)}return false};Item.prototype.Select=function(){return DataModel.UserSettings.Selection(this.FolderID,this.ID)};Item.prototype.IsSelected=function(b){return DataModel.UserSettings.IsItemSelected(this.ID,b)};Item.prototype.GetFolder=function(){return(DataModel.getFolder(this.FolderID))};Item.prototype.GetParent=function(){return(this.ParentID==null)?null:this.GetFolder().Items[this.ParentID]};Item.prototype.GetParentContainer=function(){return(this.ParentID==null)?this.GetFolder():this.GetParent()};Item.prototype.GetItemType=function(){return DataModel.Constants.ItemTypes[this.ItemTypeID]};Item.prototype.GetItems=function(b){return DataModel.GetItems(this.FolderID,this.ID,b)};Item.prototype.InsertItem=function(h,f,g,e){return DataModel.InsertItem(h,this,f,g,e)};Item.prototype.Update=function(d,c){return DataModel.UpdateItem(this,d,c)};Item.prototype.Delete=function(b){return DataModel.DeleteItem(this,b)};Item.prototype.HasField=function(b){return this.GetItemType().HasField(b)};Item.prototype.GetField=function(b){return this.GetItemType().Fields[b]};Item.prototype.GetFields=function(){return this.GetItemType().Fields};Item.prototype.Refresh=function(){var b=this;Service.GetResource(Service.ItemsResource,this.ID,function(d){var a=d.result;if(a!=null){b.update(a,null)}})};Item.prototype.GetFieldValue=function(f,h){if(typeof(f)=="string"){f=this.GetField(f)}if(f!=null&&this.HasField(f.Name)){if(f.Name==FieldNames.Name){return this.Name}if(f.Name==FieldNames.Complete){return(this.Status==StatusTypes.Complete)}for(var i in this.FieldValues){var g=this.FieldValues[i];if(g.FieldName==f.Name){if(g.Value!=null&&f.FieldType==FieldTypes.Guid){var j=DataModel.FindItem(g.Value);if(j!=null){return j}}if(f.FieldType==FieldTypes.Boolean){if(typeof(g.Value)=="string"){g.Value=(g.Value.toLowerCase()=="true")}}return g.Value}}if(f.FieldType=="Boolean"){return false}return null}return undefined};Item.prototype.GetExtendedFieldValue=function(d){for(var f in this.FieldValues){var e=this.FieldValues[f];if(e.FieldName==d){return e.Value}}return undefined};Item.prototype.SetFieldValue=function(f,j){if(typeof(f)=="string"){f=this.GetField(f)}if(f!=null&&this.HasField(f.Name)){if(f.Name==FieldNames.Name){this.Name=j;return true}if(f.Name==FieldNames.Complete){this.Status=(j==true)?StatusTypes.Complete:null;return true}if(this.FieldValues==null){this.FieldValues=[]}var i=false;for(var h in this.FieldValues){var g=this.FieldValues[h];if(g.FieldName==f.Name){g.Value=j;i=true;break}}if(!i){this.FieldValues=this.FieldValues.concat({FieldName:f.Name,ItemID:this.ID,Value:j})}return true}return false};Item.prototype.AddReference=function(g,h,k){if(typeof(g)=="string"){g=this.GetField(g)}if(g!=null&&this.HasField(g.Name)&&g.FieldType==FieldTypes.Guid){var j=this.GetFieldValue(g);if(j!=null){if(k==true){return this.replaceReference(j,h)}else{return this.addReference(j,h,true)}}else{var l=this;var i={Name:g.Name,IsList:true,ItemTypeID:ItemTypes.Reference,FolderID:l.FolderID,ParentID:l.ID,UserID:l.UserID};Service.InsertResource(Service.ItemsResource,i,function(b){var a=b.result;l.addItem(a,null);a=DataModel.FindItem(a.ID);l.addReference(a,h);var c=$.extend({},l);c.SetFieldValue(g.Name,a.ID);l.Update(c)})}return true}return false};Item.prototype.RemoveReferences=function(f){if(typeof(f)=="string"){f=this.GetField(f)}if(f!=null&&this.HasField(f.Name)&&f.FieldType==FieldTypes.Guid){var j=this.GetFieldValue(f);if(j!=null&&j.IsList){var i=j.GetItems();for(var g in i){var h=i[g];h.Delete()}}return true}return false};Item.prototype.GetActionType=function(){var d=this.GetFieldValue(FieldNames.ActionType);if(d==null){d=ActionTypes.Reminder}var c=DataModel.FindActionType(d);return c};Item.prototype.GetLocation=function(){var g=this.GetFieldValue(FieldNames.Locations);if(g!=null){var f=DataModel.GetItems(g.FolderID,g.ID,true);for(var e in f){return f[e].GetFieldValue(FieldNames.EntityRef)}}var h=this.GetParent();if(h!=null){g=h.GetFieldValue(FieldNames.Locations);if(g!=null){f=DataModel.GetItems(g.FolderID,g.ID,true);for(var e in f){return f[e].GetFieldValue(FieldNames.EntityRef)}}}return null};Item.prototype.GetContact=function(){var g=this.GetFieldValue(FieldNames.Contacts);if(g!=null){var f=DataModel.GetItems(g.FolderID,g.ID,true);for(var e in f){return f[e].GetFieldValue(FieldNames.EntityRef)}}var h=this.GetParent();if(h!=null){g=h.GetFieldValue(FieldNames.Locations);if(g!=null){f=DataModel.GetItems(g.FolderID,g.ID,true);for(var e in f){return f[e].GetFieldValue(FieldNames.EntityRef)}}}return null};Item.prototype.GetPhoneNumber=function(){var c=this.GetLocation();if(c==null){c=this.GetContact()}if(c!=null){var d=c.GetFieldValue(FieldNames.Phone);if(d!=null){d=d.replace(/[^0-9]+/g,"")}return d}return null};Item.prototype.GetEmail=function(){var d=this.GetLocation();if(d==null){d=this.GetContact()}if(d!=null){var c=d.GetFieldValue(FieldNames.Email);return c}return null};Item.prototype.GetMapLink=function(){var g=this.GetLocation();if(g==null){g=this.GetContact()}if(g!=null){var h=g.GetFieldValue(FieldNames.WebLinks);if(h!=null&&h.length>0){var j=new LinkArray(h).Links();for(var f in j){var i=j[f];if(i.Name=="Map"&&i.Url!=null){return i}}}}return null};Item.prototype.UpdateStatus=function(f,d){var e=this.Copy();e.Status=f;return this.Update(e,d)};Item.prototype.IsNullStatus=function(){return(this.Status==null)};Item.prototype.IsActive=function(){return(this.Status==StatusTypes.Active)};Item.prototype.IsComplete=function(){return(this.Status==StatusTypes.Complete)};Item.prototype.IsPaused=function(){return(this.Status==StatusTypes.Paused)};Item.prototype.IsSkipped=function(){return(this.Status==StatusTypes.Skipped)};Item.prototype.StatusClass=function(){return(this.IsNullStatus())?"":("st-"+this.Status.toLowerCase())};Item.prototype.IsCategory=function(){return(this.ItemTypeID==ItemTypes.Category)};Item.prototype.IsActivity=function(){return(this.ItemTypeID==ItemTypes.Activity)};Item.prototype.IsStep=function(){return(this.ItemTypeID==ItemTypes.Step)};Item.prototype.CanResume=function(){var v={Start:false,Resume:false,Restart:false};var x=this.GetItems(true);if(ItemMap.count(x)==0){var q=this.GetFieldValue(FieldNames.DueDate);var p=this.GetFieldValue(FieldNames.CompletedOn);var s=(q!=null&&q.length>0);var r=(p!=null&&p.length>0);v.Start=!s;v.Resume=s&&!r;v.Restart=s&&r;return v}var n=true;var o=true;var m=true;var u=0;for(var t in x){var w=x[t];if(!w.IsNullStatus()){n=false}if(w.IsPaused()){u++}if(u==0&&!(w.IsComplete()||w.IsSkipped())){m=false}if(u==1&&!(w.IsPaused()||w.IsNullStatus())){o=false}}v.Start=n;v.Resume=(u==1&&m&&o);v.Restart=!v.Start;return v};Item.prototype.Complete=function(){var d=this.Copy();d.Status=StatusTypes.Complete;if(d.HasField(FieldNames.CompletedOn)){d.SetFieldValue(FieldNames.CompletedOn,new Date().format())}var e=this.nextItem();if(e!=null&&e.IsStep()){this.Update(d,null);e.Active(this.GetFieldValue(FieldNames.DueDate))}else{if(this.IsStep()){var f=this.GetParent();if(f!=null&&f.IsActivity()){f.UpdateStatus(StatusTypes.Complete,null)}}this.Update(d)}};Item.prototype.Skip=function(){var c=this.Copy();c.Status=StatusTypes.Skipped;if(c.HasField(FieldNames.CompletedOn)){c.SetFieldValue(FieldNames.CompletedOn,new Date().format())}var d=this.nextItem();if(d!=null&&d.IsStep()){this.Update(c,null);d.Active(this.GetFieldValue(FieldNames.DueDate))}else{this.Update(c)}};Item.prototype.Pause=function(){var f=this.GetItems(true);for(var d in f){var e=f[d];if(e.IsActive()){e.UpdateStatus(StatusTypes.Paused,null);break}}this.UpdateStatus(StatusTypes.Paused)};Item.prototype.Start=function(b){return this.Active(b)};Item.prototype.Active=function(k){var n=this.GetItems(true);if(ItemMap.count(n)==0){var i=(k!=null)?k:this.GetFieldValue(FieldNames.DueDate);if(i==null||i.length==0){return this}else{var h=this.Copy();h.Status=StatusTypes.Active;h.SetFieldValue(FieldNames.DueDate,i);this.Update(h);return null}}var l=null;for(var j in n){var m=n[j];if(m.IsPaused()){m.UpdateStatus(StatusTypes.Active,null);this.UpdateStatus(StatusTypes.Active);return null}if(m.IsNullStatus()){var i=(k!=null)?k:m.GetFieldValue(FieldNames.DueDate);if(i==null||i.length==0){if(l!=null){i=l.GetFieldValue(FieldNames.DueDate)}else{i=this.GetFieldValue(FieldNames.DueDate)}}if(i!=null&&i.length>0){var h=m.Copy();h.Status=StatusTypes.Active;h.SetFieldValue(FieldNames.DueDate,i);m.Update(h,null);this.UpdateStatus(StatusTypes.Active);return null}else{return m}}l=m}return null};Item.prototype.Restart=function(){var h=this.GetItems(true);if(ItemMap.count(h)==0){var e=this.Copy();e.SetFieldValue(FieldNames.DueDate,null);e.SetFieldValue(FieldNames.CompletedOn,null);this.Update(e,null);return e.Active()}else{for(var f in h){var g=h[f];var e=g.Copy();e.Status=null;e.SetFieldValue(FieldNames.DueDate,null);g.Update(e,null)}}return this.Active()};Item.prototype.addItem=function(d,c){this.GetFolder().addItem(d,c)};Item.prototype.update=function(f,d){if(this.ID==f.ID){f=Item.Extend(f);var e=this.GetFolder();if(this.FolderID==f.FolderID){e.ItemsMap.update(f);e.Items=e.ItemsMap.Items}else{e.ItemsMap.remove(this);f.GetFolder().ItemsMap.append(f)}if(d===undefined){DataModel.fireDataChanged(this.FolderID,this.ID)}else{if(d!=null){DataModel.fireDataChanged(this.FolderID,d.ID)}}return true}return false};Item.prototype.nextItem=function(){var g=this.GetParent();var h=(g==null)?this.GetFolder().GetItems():g.GetItems();var e=ItemMap.indexOf(h,this.ID);var f=ItemMap.itemAt(h,e+1);return f};Item.prototype.selectNextItem=function(){var h=this.GetParent();var i=(h==null)?this.GetFolder().GetItems():h.GetItems();var f=ItemMap.indexOf(i,this.ID);var g=ItemMap.itemAt(i,f+1);if(g!=null){return g}else{if(f==0){if(h!=null){return h}}else{var j=ItemMap.itemAt(i,f-1);if(j!=null){return j}}}return null};Item.prototype.addReference=function(n,l,h){if(n.IsList){if(h){var k=n.GetItems();for(var i in k){var j=k[i];var m=j.GetFieldValue(FieldNames.EntityRef);if(m.ID==l.ID){return false}}}var j=Item.Extend({Name:l.Name,ItemTypeID:ItemTypes.Reference,FolderID:n.FolderID,ParentID:n.ID,UserID:n.UserID});j.SetFieldValue(FieldNames.EntityRef,l.ID);j.SetFieldValue(FieldNames.EntityType,EntityTypes.Item);n.InsertItem(j,null,null,null);return true}return false};Item.prototype.replaceReference=function(k,j){if(k.IsList){var i=k.GetItems();for(var g in i){var h=i[g];var l=h.Copy();l.SetFieldValue(FieldNames.EntityRef,j.ID);h.Update(l,k.GetParent());return true}return this.addReference(k,j)}return false};function ActionType(){}ActionType.Extend=function ActionType$Extend(b){return $.extend(new ActionType(),b)};ActionType.prototype.Copy=function(){var b=$.extend(new ActionType(),this);return b};ActionType.prototype.GetSteps=function(n,o){if(o===undefined){o=StatusTypes.Active}var p=[];var k=0;for(var j in DataModel.Folders){var i=DataModel.Folders[j];for(var m in i.Items){var l=i.Items[m];if(l.IsStep()){if(this.Name==ActionTypes.All||l.GetActionType()===this){if(l.Status==o){p[k++]=l}}}}}p.sort(function(a,b){var c=a.GetFieldValue(FieldNames.DueDate);var d=b.GetFieldValue(FieldNames.DueDate);if(c==d){return 0}if(c==null){return 1}if(d==null){return -1}var e=new Date(c);var f=new Date(d);if(e==f){return 0}if(e>f){return 1}return -1});return p};function GalleryCategory(){}GalleryCategory.Extend=function GalleryCategory$Extend(b){return $.extend(new GalleryCategory(),b)};GalleryCategory.prototype.Copy=function(){var b=$.extend(new GalleryCategory(),this);b.Activities={};b.ItemsMap={};return b};GalleryCategory.prototype.IsSelected=function(){return DataModel.UserSettings.IsCategorySelected(this.ID)};GalleryCategory.prototype.IsExpanded=function(){return DataModel.UserSettings.IsCategoryExpanded(this.ID)};GalleryCategory.prototype.Expand=function(b){DataModel.UserSettings.ExpandCategory(this.ID,b)};GalleryCategory.prototype.GetActivities=function(){return this.Activities};GalleryCategory.prototype.GetActivity=function(b){return this.Activities[b]};GalleryCategory.prototype.IsGalleryCategory=function(){return true};GalleryCategory.prototype.IsGalleryActivity=function(){return false};GalleryCategory.prototype.Install=function(){Service.InvokeController("Actions","InstallCategory",{category:this},function(c){var d=c.result;if(d.StatusCode!="200"){Control.alert("Server was unable to install the category","Install Category")}else{Dashboard.dataModel.Refresh()}})};function GalleryActivity(){}GalleryActivity.Extend=function GalleryActivity$Extend(b){return $.extend(new GalleryActivity(),b)};GalleryActivity.prototype.Copy=function(){var b=$.extend(new GalleryActivity(),this);b.ItemsMap={};return b};GalleryActivity.prototype.IsGalleryCategory=function(){return false};GalleryActivity.prototype.IsGalleryActivity=function(){return true};GalleryActivity.prototype.IsSelected=function(){return DataModel.UserSettings.IsActivitySelected(this.ID)};GalleryActivity.prototype.Install=function(){Service.InvokeController("Actions","InstallActivity",{activity:this},function(c){var d=c.result;if(d.StatusCode!="200"){Control.alert("Server was unable to install the category","Install Activity")}else{Dashboard.dataModel.Refresh()}})};function Appointment(){}Appointment.Extend=function Appointment$Extend(b){return $.extend(new Appointment(),b)};Appointment.prototype.Copy=function(){var b=$.extend(new Appointment(),this);return b};function ItemType(){}ItemType.Extend=function ItemType$Extend(b){return $.extend(new ItemType(),b)};ItemType.prototype.HasField=function(b){return(this.Fields.hasOwnProperty(b))};function ItemMap(b){this.array=b;this.updateMap()}ItemMap.prototype.updateMap=function(){this.Items={};for(var b in this.array){if(this.array[b].hasOwnProperty("ID")){this.Items[this.array[b].ID]=this.array[b]}else{throw ItemMap.errorMustHaveID}}};ItemMap.prototype.indexOf=function(d){for(var c in this.array){if(this.array[c].ID==d.ID){return c}}return -1};ItemMap.prototype.itemAt=function(b){if(b<0){return this.array[this.array.length-1]}if(b<this.array.length){return this.array[b]}return null};ItemMap.prototype.append=function(b){if(b.hasOwnProperty("ID")){this.array=this.array.concat(b);this.Items[b.ID]=this.array[this.array.length-1]}else{throw ItemMap.errorMustHaveID}};ItemMap.prototype.update=function(h){if(h.hasOwnProperty("ID")){var g=this.indexOf(h);var e=this.itemAt(g);if(h.hasOwnProperty("SortOrder")&&e.hasOwnProperty("SortOrder")&&(h.SortOrder!=e.SortOrder)){this.array.splice(g,1);for(var f in this.array){if(this.array[f].hasOwnProperty("SortOrder")&&h.SortOrder<this.array[f].SortOrder){this.array.splice(f,0,h);this.updateMap();return}}this.array.push(h);this.updateMap()}else{this.array[g]=h;this.Items[h.ID]=this.array[g]}}else{throw ItemMap.errorMustHaveID}};ItemMap.prototype.remove=function(d){if(d.hasOwnProperty("ID")){var c=this.indexOf(d);if(c>=0){this.array.splice(c,1);delete this.Items[d.ID]}}else{throw ItemMap.errorMustHaveID}};ItemMap.count=function(f){var d=0,e;for(e in f){if(f.hasOwnProperty(e)){d++}}return d};ItemMap.indexOf=function(j,g){var h=-1,f=0;for(var i in j){if(i==g){h=f;break}f++}return h};ItemMap.itemAt=function(h,e){for(var g in h){var f=h[g];if(e--==0){return f}}return(e<0)?f:null};ItemMap.errorMustHaveID="ItemMap requires all items in array to have an ID property.";function LinkArray(b){this.links=[];if(b!=null&&b.length>0){this.links=$.parseJSON(b)}}LinkArray.prototype.Links=function(){return this.links};LinkArray.prototype.ToJson=function(){return JSON.stringify(this.links)};LinkArray.prototype.Remove=function(b){this.links.splice(b,1)};LinkArray.prototype.Add=function(d,e){if(e!=null){this.links.push({Name:e,Url:d});return this.links}var f=d.split(",");if(f.length>1){e=$.trim(f[0]);d=$.trim(f[1]);this.links.push({Name:e,Url:d})}else{this.links.push({Url:d})}return this.links};LinkArray.prototype.ToText=function(){var f="";for(var d in this.links){var e=this.links[d];if(e.hasOwnProperty("Name")){if(e.Name!=null&&e.Name.length>0&&e.Name!=e.Url){f+=e.Name+", "}}f+=e.Url+"\r\n"}return f};LinkArray.prototype.Parse=function(h){var f=h.split(/\r\n|\r|\n/g);for(var e in f){var g=f[e].split(",");if(g.length==1&&g[0].length>0){this.links.push({Url:g[0]})}if(g.length==2){this.links.push({Name:g[0],Url:g[1]})}}};function UserSettings(c,d){this.clientFolder=c;this.webClientFolder=d;this.init(UserSettings.viewStateName,UserSettings.viewStateKey);this.init(UserSettings.preferencesName,UserSettings.preferencesKey)}UserSettings.defaultListsKey="DefaultLists";UserSettings.viewStateName="ViewState";UserSettings.viewStateKey="WebViewState";UserSettings.preferencesName="Preferences";UserSettings.preferencesKey="WebPreferences";UserSettings.prototype.GetFolder=function(b){if(this.clientFolder.ID==b){return this.clientFolder}if(this.webClientFolder.ID==b){return this.webClientFolder}return null};UserSettings.prototype.GetDefaultList=function(i){var g=this.clientFolder.GetItemByName(UserSettings.defaultListsKey);if(g!=null){var f=this.clientFolder.GetItemByValue(i,g.ID);if(f!=null){var j=f.GetFieldValue(FieldNames.EntityRef);if(typeof(j)=="object"){return j}}}var h;for(id in DataModel.Folders){h=DataModel.Folders[id];if(h.ItemTypeID==i){return h}}return h};UserSettings.prototype.Selection=function(c,d){this.ViewState.SelectedFolder=c;this.ViewState.SelectedItem=d};UserSettings.prototype.IsFolderSelected=function(b){return(this.ViewState.SelectedFolder==b)};UserSettings.prototype.IsCategorySelected=function(b){return(this.ViewState.SelectedCategory==b)};UserSettings.prototype.IsActivitySelected=function(b){return(this.ViewState.SelectedActivity==b)};UserSettings.prototype.IsItemSelected=function(f,d){if(d==true){var e=DataModel.FindItem(this.ViewState.SelectedItem);if(e!=null&&e.ParentID==f){return true}}return(this.ViewState.SelectedItem==f)};UserSettings.prototype.ExpandFolder=function(d,c){if(this.ViewState.ExpandedFolders==null){this.ViewState.ExpandedFolders={}}if(c==true){this.ViewState.ExpandedFolders[d]=true}else{delete this.ViewState.ExpandedFolders[d]}};UserSettings.prototype.ExpandCategory=function(c,d){if(this.ViewState.ExpandedCategories==null){this.ViewState.ExpandedCategories={}}if(d==true){this.ViewState.ExpandedCategories[c]=true}else{delete this.ViewState.ExpandedCategories[c]}};UserSettings.prototype.IsFolderExpanded=function(b){return(this.ViewState.ExpandedFolders!=null&&this.ViewState.ExpandedFolders[b]==true)};UserSettings.prototype.IsCategoryExpanded=function(b){return(this.ViewState.ExpandedCategories!=null&&this.ViewState.ExpandedCategories[b]==true)};UserSettings.prototype.Save=function(){var c={};for(var d in DataModel.Folders){if(DataModel.Folders[d].IsExpanded()){c[d]=true}}this.ViewState.ExpandedFolders=c;this.update(UserSettings.viewStateName,UserSettings.viewStateKey)};UserSettings.prototype.UpdateTheme=function(b){if(this.Preferences.Theme!=b){this.Preferences.Theme=b;this.update(UserSettings.preferencesName,UserSettings.preferencesKey);Service.ChangeTheme(b)}};UserSettings.prototype.init=function(g,e){var f="item"+g;if(this.webClientFolder!=null){this[f]=this.webClientFolder.GetItemByName(e,null)}if(this[f]==null){this[g]={};if(this.webClientFolder!=null){this.webClientFolder.InsertItem(Item.Extend({Name:e,ItemTypeID:ItemTypes.NameValue}),null,null,null)}}else{var h=this[f].GetFieldValue(FieldNames.Value);this[g]=(h==null)?{}:$.parseJSON(h)}};UserSettings.prototype.update=function(g,e){if(this.webClientFolder!=null){var f="item"+g;if(this[f]==null){this[f]=this.webClientFolder.GetItemByName(e,null)}var h=this[f].Copy();h.SetFieldValue(FieldNames.Value,JSON.stringify(this[g]));this[f].Update(h)}};var ItemTypes={Category:"00000000-0000-0000-0000-000000000007",Activity:"00000000-0000-0000-0000-000000000001",Step:"00000000-0000-0000-0000-000000000002",Contact:"00000000-0000-0000-0000-000000000003",Location:"00000000-0000-0000-0000-000000000004",System:"00000000-0000-0000-0000-000000000000",Reference:"00000000-0000-0000-0000-000000000005",NameValue:"00000000-0000-0000-0000-000000000006"};var FieldNames={Name:"Name",Description:"Description",Repeat:"Repeat",Complete:"Complete",CompletedOn:"CompletedOn",DueDate:"DueDate",EndDate:"EndDate",ActionType:"ActionType",Birthday:"Birthday",Address:"Address",WebLink:"WebLink",WebLinks:"WebLinks",Email:"Email",Phone:"Phone",HomePhone:"HomePhone",WorkPhone:"WorkPhone",Amount:"Amount",Cost:"Cost",ItemTags:"ItemTags",EntityRef:"EntityRef",EntityType:"EntityType",Contacts:"Contacts",Locations:"Locations",Value:"Value",Category:"Category",LatLong:"LatLong",FacebookID:"FacebookID",Sources:"Sources",Gender:"Gender",Picture:"Picture"};var ExtendedFieldNames={Intent:"Intent",SubjectHint:"SubjectHint",Article:"Article",CalEventID:"CalEventID",SelectedCount:"SelectedCount",SortBy:"SortBy",};var EntityTypes={User:"User",Folder:"Folder",Item:"Item"};var FieldTypes={String:"String",Boolean:"Boolean",Integer:"Integer",DateTime:"DateTime",Phone:"Phone",Email:"Email",Url:"Url",Address:"Address",Currency:"Currency",TagIDs:"TagIDs",Guid:"Guid",JSON:"JSON"};var DisplayTypes={Hidden:"Hidden",Text:"Text",TextArea:"TextArea",Checkbox:"Checkbox",DatePicker:"DatePicker",DateTimePicker:"DateTimePicker",Phone:"Phone",Email:"Email",Link:"Link",Currency:"Currency",Address:"Address",Priority:"Priority",TagList:"TagList",Reference:"Reference",Contact:"Contact",ContactList:"ContactList",LocationList:"LocationList",LinkArray:"LinkArray"};var SuggestionTypes={ChooseOne:"ChooseOne",ChooseOneSubject:"ChooseOneSubject",ChooseMany:"ChooseMany",ChooseManyWithChildren:"ChooseManyWithChildren",GetFBConsent:"GetFBConsent",GetGoogleConsent:"GetGoogleConsent",GetADConsent:"GetADConsent",NavigateLink:"NavigateLink",RefreshEntity:"RefreshEntity"};var Reasons={Chosen:"Chosen",Ignore:"Ignore",Like:"Like",Dislike:"Dislike"};var StatusTypes={Active:"Active",Complete:"Complete",Paused:"Paused",Skipped:"Skipped"};var Sources={Directory:"Directory",Facebook:"Facebook",Local:"Local"};var SystemFolders={Client:"$Client",WebClient:"$WebClient"};var UserEntities={Inbox:"Inbox",People:"People",Places:"Places",Personal:"Personal",Home:"Home",Auto:"Auto"};var SystemUsers={System:"00000000-0000-0000-0000-000000000001",User:"00000000-0000-0000-0000-000000000002"};var ActionTypes={All:"All",Reminder:"Reminder",Call:"Call",Schedule:"Add to calendar",Errand:"Errand",SendEmail:"Email",TextMessage:"Text",AskFriends:"Ask on Facebook",Find:"Find local business",};function ActivityGallery(b){this.onSelectionChangedHandlers={};this.init(b)}ActivityGallery.prototype.init=function(b){this.categories=b;this.$element=null};ActivityGallery.prototype.addSelectionChangedHandler=function(d,c){this.onSelectionChangedHandlers[d]=c};ActivityGallery.prototype.removeSelectionChangedHandler=function(b){this.onSelectionChangedHandlers[b]=undefined};ActivityGallery.prototype.fireSelectionChanged=function(e,g){for(var h in this.onSelectionChangedHandlers){var f=this.onSelectionChangedHandlers[h];if(typeof(f)=="function"){f(e,g)}}};ActivityGallery.prototype.render=function(e,f){if(f!=null){this.init(f)}e.empty();this.$element=$('<ul class="nav nav-pills nav-stacked" />').appendTo(e);for(var h in this.categories){var g=this.categories[h];$category=$('<li class="position-relative"><a class="selector"><strong>&nbsp;'+g.Name+"</strong></a></li>").appendTo(this.$element);$category.find("strong").prepend(Control.Icons.forFolder(g));$category.data("control",this);$category.data("item",g);$category.click(function(a){if($(a.target).hasClass("selector")||$(a.target).parents("a").first().hasClass("selector")){Control.get(this).categoryClicked($(this))}return true});$('<div class="btn-dropdown absolute-right"></div>').appendTo($category);if(g.IsSelected()){this.select($category,g)}this.renderItems($category,g)}};ActivityGallery.prototype.renderItems=function(f,g){var j=g.GetActivities();$itemList=$('<ul class="itemlist nav nav-pills nav-stacked" />').appendTo(f.parent());for(var h in j){var i=j[h];if(i.IsGalleryActivity()){$item=$('<li class="position-relative"><a class="selector"><span>&nbsp;'+i.Name+"</span></a></li>").appendTo($itemList);$item.find("span").prepend(Control.Icons.forItemType(ItemTypes.Activity));$item.data("control",this);$item.data("item",i);$item.click(function(a){if($(a.target).hasClass("selector")||$(a.target).parents("a").first().hasClass("selector")){Control.get(this).itemClicked($(this))}return true});if(i.IsSelected(true)){this.select($item,i)}}}if(g.IsExpanded()){this.expand(f)}else{this.collapse(f)}};ActivityGallery.prototype.categoryClicked=function(c){var d=c.data("item");this.toggle(c);this.select(c,d);this.fireSelectionChanged(d.ID)};ActivityGallery.prototype.itemClicked=function(c){var d=c.data("item");this.select(c,d);this.fireSelectionChanged(d.FolderID,d.ID)};ActivityGallery.prototype.select=function(h,j){this.deselect();h.addClass("active");this.showCommands(h,j);var g=h.parents(".dashboard-list").first();var i=g.height();var l=g.scrollTop();var k=h.offset().top-i+l;if(k>0){g.animate({scrollTop:k},500)}};ActivityGallery.prototype.deselect=function(){$control=this;$.each(this.$element.find("li"),function(){$(this).removeClass("active");$control.hideCommands($(this))})};ActivityGallery.prototype.expand=function(c){this.collapseAll(c);var d=c.data("item");c.addClass("expanded");d.Expand(true);$itemlist=c.next(".itemlist");Control.expand($itemlist,400);$itemlist.removeClass("collapse")};ActivityGallery.prototype.collapse=function(d,f){var e=d.data("item");d.removeClass("expanded");e.Expand(false);Control.collapse(d.next(".itemlist"),f)};ActivityGallery.prototype.collapseAll=function(b){$this=this;$.each(b.siblings("li"),function(){$this.collapse($(this))})};ActivityGallery.prototype.toggle=function(c){var d=c.hasClass("expanded");if(c.hasClass("active")&&d){this.collapse(c)}else{if(!d){this.expand(c)}}};ActivityGallery.prototype.showCommands=function(h,j){if(j.IsGalleryCategory()||j.IsGalleryActivity()){var f=h.find(".btn-dropdown");$('<i class="icon-caret-down dropdown-toggle" data-toggle="dropdown"></i>').appendTo(f);var i=$('<ul class="dropdown-menu pull-right" role="menu"></ul>').appendTo(f);var g=$('<li><a href="#"><i class="icon-download"></i>&nbsp;Install</a></li>').appendTo(i);g.click(function(){$(this).parents("li").first().data("item").Install()})}};ActivityGallery.prototype.hideCommands=function(d){var c=d.find(".btn-dropdown");c.empty()};var Dashboard=function Dashboard$(){this.dataModel=null;this.folderList=null;this.helpManager=null;this.settingsManager=null;this.folderManager=null;this.suggestionList=null;this.suggestionManager=null};Dashboard.Init=function Dashboard$Init(e,f,d){Dashboard.dataModel=e;Dashboard.checkBrowser();Dashboard.checkConsent(d);if(f==true){Service.GetFacebookConsent()}Dashboard.dataModel.AddDataChangedHandler("dashboard",Dashboard.ManageDataChange);Dashboard.$element=$(".dashboard-region");Dashboard.$center=$(".dashboard-center");Dashboard.$left=$(".dashboard-left");Dashboard.$right=$(".dashboard-right");Dashboard.folderList=new FolderList(this.dataModel.Folders);Dashboard.folderList.addSelectionChangedHandler("dashboard",Dashboard.ManageFolder);Dashboard.suggestionList=new SuggestionList();Dashboard.suggestionList.addSelectionChangedHandler("dashboard",Dashboard.ManageChoice);Dashboard.activityGallery=new ActivityGallery();Dashboard.activityGallery.addSelectionChangedHandler("dashboard",Dashboard.ManageGallery);Dashboard.dataModel.GetGalleryCategories(Dashboard.renderGallery);Dashboard.suggestionManager=new SuggestionManager(Dashboard.dataModel);Dashboard.helpManager=new HelpManager(Dashboard,Dashboard.$center);Dashboard.settingsManager=new SettingsManager(Dashboard,Dashboard.$center);Dashboard.folderManager=new FolderManager(Dashboard,Dashboard.$center);Dashboard.folderManager.addSelectionChangedHandler("dashboard",Dashboard.ManageFolder);if(Dashboard.dataModel.UserSettings.ViewState.SelectedFolder!=null){Dashboard.showManager(Dashboard.folderManager);Dashboard.dataModel.restoreSelection()}else{Dashboard.showManager(Dashboard.helpManager);Dashboard.folderList.render(Dashboard.$left,Dashboard.dataModel.Folders)}$(window).bind("load",Dashboard.resize);$(window).bind("resize",Dashboard.resize);$(window).bind("unload",Dashboard.Close);$logo=$(".brand a");$logo.unbind("click");$logo.click(function(){Dashboard.dataModel.Refresh();return false});Dashboard.showHeaderOptions()};Dashboard.Close=function Dashboard$Close(b){$(".header-icons").hide();Dashboard.dataModel.Close()};Dashboard.ManageDataChange=function Dashboard$ManageDataChange(c,d){Dashboard.ManageFolder(c,d);Dashboard.folderList.render(Dashboard.$left,Dashboard.dataModel.Folders)};Dashboard.ManageFolder=function Dashboard$ManageFolder(f,h){var g;var e=(f!=null)?Dashboard.dataModel.Folders[f]:null;if(h==null){Dashboard.dataModel.UserSettings.Selection(f,h);if(e!=null&&e.ItemTypeID!=ItemTypes.Category){Dashboard.showManager(Dashboard.folderManager);Dashboard.folderManager.selectFolder(e)}else{Dashboard.showManager(Dashboard.helpManager)}}else{g=(e!=null&&h!=null)?e.Items[h]:null;Dashboard.dataModel.UserSettings.Selection(f,h);Dashboard.showManager(Dashboard.folderManager);Dashboard.folderManager.selectItem(g)}};Dashboard.ManageChoice=function Dashboard$ManageChoice(j){var i=Dashboard.suggestionManager.select(j);if(i){Dashboard.suggestionList.hideGroup(j.GroupID);Dashboard.suggestionList.working(true);var h=0;var g=new Date();var f=function(){if(g>Dashboard.dataModel.SuggestionsRetrieved&&h++<5){Dashboard.getSuggestions(Dashboard.folderManager.currentFolder,Dashboard.folderManager.currentItem);setTimeout(f,5000)}else{Dashboard.suggestionList.working(false)}};f()}};Dashboard.render=function Dashboard$render(c,d){Dashboard.folderList.render(Dashboard.$left);Dashboard.dataModel.GetGalleryCategories(Dashboard.renderGallery)};Dashboard.showHeaderOptions=function Dashboard$showHeaderOptions(){$dropdown=$(".navbar-fixed-top .pull-right .dropdown-menu");$menuitem=$dropdown.find(".option-refresh");$menuitem.show();$menuitem.click(function(b){Dashboard.dataModel.Refresh();b.preventDefault()});$menuitem=$dropdown.find(".option-settings");$menuitem.show();$menuitem.click(function(b){Dashboard.showManager(Dashboard.settingsManager);b.preventDefault()});$menuitem=$dropdown.find(".option-help");$menuitem.show();$menuitem.click(function(b){Dashboard.showManager(Dashboard.helpManager);b.preventDefault()})};Dashboard.showManager=function Dashboard$showManager(d,c){if(Dashboard.currentManager!=d){Dashboard.currentManager=d;Dashboard.folderManager.hide();Dashboard.settingsManager.hide();Dashboard.helpManager.hide();(d.addWell==true)?Dashboard.$center.addClass("well"):Dashboard.$center.removeClass("well")}d.show(c)};Dashboard.resize=function Dashboard$resize(){if(Dashboard.resizing){return}Dashboard.resizing=true;$(window).unbind("resize",Dashboard.resize);var h=$(window).height();var g=$(".navbar-fixed-top").height();var f=$(".navbar-fixed-bottom").height();var e=h-(g+f+30);Dashboard.$left.height(e);Dashboard.$center.height(e);Dashboard.$right.height(e);$(window).bind("resize",Dashboard.resize);Dashboard.resizing=false};Dashboard.checkBrowser=function Dashboard$checkBrowser(){if(Browser.IsMSIE()&&Browser.MSIE_Version()<9){var c="We're Sorry!";var d="This application currently requires an HTML5-compatible browser. We encourage you to try using the application with the latest version of Internet Explorer, Chrome, or FireFox.<br/>Thank you";Control.alert(d,c)}};Dashboard.checkConsent=function Dashboard$checkConsent(d){if(d!=null&&d.length>0){var f,e;switch(d){case"FBConsentFail":e="Failed!";f="This application was not able to receive consent for accessing your Facebook information.";break;case"GoogleConsentFail":e="Failed!";f="This application was not able to receive consent for managing your Google calendar.";break;case"CloudADConsentFail":e="Failed!";f="This application was not able to receive consent for accessing your Cloud Directory.";break;default:Dashboard.consentStatus=d;Dashboard.dataModel.GetSuggestions(Dashboard.completeConsent)}if(f!=null){Control.alert(f,e,function(){Service.NavigateToDashboard()})}}};Dashboard.completeConsent=function Dashboard$completeConsent(h){if(Dashboard.consentStatus!=null&&Dashboard.consentStatus.length>0){var f,e,g;switch(Dashboard.consentStatus){case"FBConsentSuccess":e="Success!";f="This application has successfully received consent for accessing your Facebook information.";g=SuggestionManager.findSuggestion(h,SuggestionTypes.GetFBConsent);break;case"GoogleConsentSuccess":e="Success!";f="This application has successfully received consent for managing your Google calendar.";g=SuggestionManager.findSuggestion(h,SuggestionTypes.GetGoogleConsent);break;case"CloudADConsentSuccess":e="Success!";f="This application has successfully received consent for accessing your Cloud Directory.";g=SuggestionManager.findSuggestion(h,SuggestionTypes.GetADConsent);break}Dashboard.consentStatus=null;if(g!=null&&g.ReasonSelected!=Reasons.Chosen){Dashboard.dataModel.SelectSuggestion(g,Reasons.Chosen);Control.alert(f,e,function(){Service.NavigateToDashboard()})}}};Dashboard.getSuggestions=function Dashboard$getSuggestions(c,d){if(d!=null){if(d.hasOwnProperty("Created")){this.dataModel.GetSuggestions(Dashboard.renderSuggestions,d)}else{Dashboard.renderSuggestions({})}}else{if(c!=null){if(c.hasOwnProperty("Items")){Dashboard.dataModel.GetSuggestions(Dashboard.renderSuggestions,c)}else{Dashboard.renderSuggestions({})}}else{return Dashboard.dataModel.GetSuggestions(Dashboard.renderSuggestions)}}};Dashboard.renderGallery=function Dashboard$renderGallery(b){Dashboard.activityGallery.render(Dashboard.$right,b)};Dashboard.renderSuggestions=function Dashboard$renderSuggestions(j){var f=j[SuggestionTypes.RefreshEntity];if(f!=null){var h;for(var g in f.Suggestions){var i=f.Suggestions[g];Dashboard.dataModel.SelectSuggestion(i,Reasons.Ignore);if(i.EntityType=="Item"){h=i.EntityID}}delete j[SuggestionTypes.RefreshEntity];Dashboard.dataModel.Refresh(h)}Dashboard.suggestionList.render(Dashboard.$right,j);if(j.Group_0!=null){Dashboard.suggestionList.working(false)}};function FolderList(b){this.onSelectionChangedHandlers={};this.init(b)}FolderList.prototype.init=function(c){this.folders={};for(var d in c){if(c[d].IsCategory()){this.folders[d]=c[d]}}for(var d in c){if(!c[d].IsCategory()){this.folders[d]=c[d]}}this.$element=null};FolderList.prototype.addSelectionChangedHandler=function(d,c){this.onSelectionChangedHandlers[d]=c};FolderList.prototype.removeSelectionChangedHandler=function(b){this.onSelectionChangedHandlers[b]=undefined};FolderList.prototype.fireSelectionChanged=function(e,g){for(var h in this.onSelectionChangedHandlers){var f=this.onSelectionChangedHandlers[h];if(typeof(f)=="function"){f(e,g)}}};FolderList.prototype.render=function(e,g){if(g!=null){this.init(g)}e.empty();this.$element=$('<ul class="nav nav-pills nav-stacked" />').appendTo(e);Control.List.sortable(this.$element);for(var h in this.folders){var f=this.folders[h];$folder=$('<li class="position-relative"><a class="selector"><strong>&nbsp;'+f.Name+"</strong></a></li>").appendTo(this.$element);$folder.find("strong").prepend(Control.Icons.forItemType(f));$folder.data("control",this);$folder.data("item",f);$folder.click(function(a){if($(a.target).hasClass("selector")||$(a.target).parents("a").first().hasClass("selector")){Control.get(this).folderClicked($(this))}return true});$('<div class="btn-dropdown absolute-right"></div>').appendTo($folder);$('<div class="icon drag-handle"><span>⁞&nbsp;</span></div>').appendTo($folder);if(f.IsSelected()){this.select($folder,f)}this.renderItems($folder,f)}this.renderAddBtn(e)};FolderList.prototype.renderItems=function(f,g){var j=g.GetItems();$itemList=$('<ul class="itemlist nav nav-pills nav-stacked" />').appendTo(f.parent());Control.List.sortable($itemList);for(var h in j){var i=j[h];if(i.IsList){$item=$('<li class="position-relative"><a class="selector"><span>&nbsp;'+i.Name+"</span></a></li>").appendTo($itemList);$item.find("span").prepend(Control.Icons.forItemType(i));if(i.IsActivity()&&i.IsPaused()){$item.find("a").addClass(StatusTypes.Paused.toLowerCase())}$item.data("control",this);$item.data("item",i);$item.click(function(a){if($(a.target).hasClass("selector")||$(a.target).parents("a").first().hasClass("selector")){Control.get(this).itemClicked($(this))}return true});$('<div class="btn-dropdown absolute-right"></div>').appendTo($item);$('<div class="icon drag-handle">⁞&nbsp;</div>').appendTo($item);if(i.IsSelected(true)){this.select($item,i)}}}this.renderAddBtn(f);if(g.IsExpanded()){this.expand(f)}else{this.collapse(f)}};FolderList.prototype.folderClicked=function(c){var d=c.data("item");this.toggle(c);this.select(c,d);this.fireSelectionChanged(d.ID)};FolderList.prototype.itemClicked=function(c){var d=c.data("item");this.select(c,d);this.fireSelectionChanged(d.FolderID,d.ID)};FolderList.prototype.select=function(h,j){this.deselect();h.addClass("active");this.showCommands(h,j);var g=h.parents(".dashboard-list").first();var i=g.height();var l=g.scrollTop();var k=h.offset().top-i+l;if(k>0){g.animate({scrollTop:k},500)}};FolderList.prototype.deselect=function(){$control=this;$.each(this.$element.find("li"),function(){$(this).removeClass("active");$control.hideCommands($(this))})};FolderList.prototype.expand=function(c){this.collapseAll(c);var d=c.data("item");c.addClass("expanded");d.Expand(true);$itemlist=c.next(".itemlist");Control.expand($itemlist,400);$itemlist.removeClass("collapse")};FolderList.prototype.collapse=function(d,e){var f=d.data("item");d.removeClass("expanded");f.Expand(false);Control.collapse(d.next(".itemlist"),e)};FolderList.prototype.collapseAll=function(b){$this=this;$.each(b.siblings("li"),function(){$this.collapse($(this))})};FolderList.prototype.toggle=function(c){var d=c.hasClass("expanded");if(c.hasClass("active")&&d){this.collapse(c)}else{if(!d){this.expand(c)}}};FolderList.prototype.renderAddBtn=function(h){var i=h.data("item");if(i!=null&&i.ItemTypeID!=ItemTypes.Category){return}var j=(i!=null)?"Add Activity":"Add Category";var g=(i!=null)?h.next(".itemlist"):$('<ul class="nav nav-pills nav-stacked" />').appendTo(h);var f=$('<li class="position-relative"><a class="btn-command"><em>&nbsp;</em></a></li>').appendTo(g);f.data("control",this);f.find("em").prepend('<i class="icon-plus-sign"></i>');f.find("em").append(j);f.click(function(){var e=Control.get(this);var b=$(this);var d=(i!=null)?Item.Extend({Name:"New Activity",ItemTypeID:ItemTypes.Activity,IsList:true,Status:StatusTypes.Paused}):Folder.Extend({Name:"New Category",ItemTypeID:ItemTypes.Category});var a=$('<input type="text" class="popup-text" />').appendTo(b);a.val(d.Name).focus().select();a.blur(function(){b.find("input").remove()});a.change(function(){c($(this).val(),d);b.find("input").remove()});a.keypress(function(l){if(l.which==13){c($(this).val(),d);b.find("input").remove();return false}});var c=function(p,o){if(p!=null&&p.length>0&&o.ID===undefined){o.Name=p;if(i!=null){i.Expand(true);i.InsertItem(o)}else{DataModel.InsertFolder(o);var n=e.$element.find("li.active");e.expand(n)}}}})};FolderList.prototype.showCommands=function(i,l){if(l.IsCategory()||l.IsActivity()){var g=i.find(".btn-dropdown");$('<i class="icon-caret-down dropdown-toggle" data-toggle="dropdown"></i>').appendTo(g);var j=$('<ul class="dropdown-menu pull-right" role="menu"></ul>').appendTo(g);var k=$('<li><a href="#"><i class="icon-pencil"></i>&nbsp;Rename</a></li>').appendTo(j);k.click(function(){var b=$(this).parents("li").first();var c=b.data("item");var a=$('<input type="text" class="popup-text" />').appendTo(b);a.val(c.Name).focus().select();a.blur(function(){b.find("input").remove()});a.change(function(){d($(this).val(),c,c.Copy());b.find("input").remove()});a.keypress(function(e){if(e.which==13){d($(this).val(),c,c.Copy());b.find("input").remove()}});var d=function(n,f,e){if(n!=null&&n.length>0){e.Name=n;f.Update(e)}}});var h=$('<li><a href="#"><i class="icon-remove-sign"></i>&nbsp;Delete</a></li>').appendTo(j);h.click(function(){$(this).parents("li").first().data("item").Delete()})}};FolderList.prototype.hideCommands=function(d){var c=d.find(".btn-dropdown");c.empty()};function FolderManager(d,c){this.parentControl=d;this.$parentElement=c;this.addWell=false;this.$element=null;this.currentFolder=null;this.currentItem=null;this.views={};this.onSelectionChangedHandlers={};this.listEditor=new ListEditor(this);this.itemEditor=new ItemEditor(this)}FolderManager.ListView="fm-list-view";FolderManager.ItemView="fm-item-view";FolderManager.PropertyView="fm-property-view";FolderManager.prototype.addSelectionChangedHandler=function(d,c){this.onSelectionChangedHandlers[d]=c};FolderManager.prototype.removeSelectionChangedHandler=function(b){this.onSelectionChangedHandlers[b]=undefined};FolderManager.prototype.fireSelectionChanged=function(e){for(var f in this.onSelectionChangedHandlers){var d=this.onSelectionChangedHandlers[f];if(typeof(d)=="function"){d(e.FolderID,e.ID);this.activeView(FolderManager.ItemView)}}};FolderManager.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};FolderManager.prototype.show=function(j){if(this.$element==null){this.$element=$('<div class="manager-folders" />').appendTo(this.$parentElement);var h=$('<ul class="nav nav-tabs" />').appendTo(this.$element);h.data("control",this);var f=$('<li><a data-toggle="tab">List View</a></li>').appendTo(h);f.find("a").attr("href","."+FolderManager.ListView);f=$('<li><a data-toggle="tab">Item View</a></li>').appendTo(h);f.find("a").attr("href","."+FolderManager.ItemView);$('<div class="item-status"></div>').appendTo(this.$element);var g=$('<div class="tab-content" />').appendTo(this.$element);var i=$('<div class="tab-pane" />').appendTo(g);i.addClass(FolderManager.ListView);this.views[FolderManager.ListView]=i;i=$('<div class="tab-pane" />').appendTo(g);i.addClass(FolderManager.ItemView);this.views[FolderManager.ItemView]=i;$('a[data-toggle="tab"]').on("shown",function(b){var a=$(b.target).parents(".nav-tabs");Control.get(a).viewChanged($(b.target))})}if(j==true){this.render()}this.$element.show()};FolderManager.prototype.render=function(){var n=this.activeView();var l=this.activeItem();var m=this.activeList();var j=this.$element.find(".nav-tabs");var i=this.$element.find(".tab-content");j.find("li a:first").empty().append(this.activeListName(m));var o=m.IsActivity()&&!m.IsPaused();if(l==null||o){j.find('a[href=".'+FolderManager.ItemView+'"]').hide()}else{$itemTab=j.find('a[href=".'+FolderManager.ItemView+'"]');$itemTab.empty().append(this.activeItemName(l));$itemTab.show()}var k=this.views[n];var p=this.$parentElement.outerHeight()-j.outerHeight();if(n==FolderManager.ItemView){if(l==null||o){n=FolderManager.ListView;this.activeView(n)}else{this.itemEditor.render(k,l,p)}}if(n==FolderManager.ListView){this.listEditor.render(k,m,p)}j.find('a[href=".'+n+'"]').tab("show");this.renderStatus()};FolderManager.prototype.renderStatus=function(){var l=this.$element.children("div.item-status").empty();var m=this.activeList();if(m!=null&&!m.IsFolder()&&m.IsActivity()){if(!m.IsPaused()){var i=$('<a><i class="icon-pause"></i></a>').appendTo(l);i.attr("title","Pause Activity").tooltip(Control.noDelayBottom);i.click(function(){$(this).tooltip("hide");m.Pause()})}else{var n=function(e,b){var d="Select due date";d+=(e.IsActivity())?" for activity":" for first step";var c=e.GetField(FieldNames.DueDate);var a=$('<div class="control-group"><label class="control-label">Due Date</label></div>');Control.DateTime.renderDatePicker(a,e,c);Control.popup(a,d,function(f){if(f.length==1&&f[0].length>0){var g=b.Start(f[0]);if(g!=null){Control.alert("Activity is not running.","Could not set valid due date on activity or next step. Try setting due date first.")}}})};var o=m.CanResume();if(o.Start||o.Resume){var p=(o.Start)?"Start Activity":"Resume Activity";var k=$('<a><i class="icon-play"></i></a>').appendTo(l);k.attr("title",p).tooltip(Control.noDelayBottom);k.click(function(){$(this).tooltip("hide");var a=m.Start();if(a!=null){n(a,m)}})}if(o.Restart){var j=$('<a><i class="icon-backward"></i></a>').prependTo(l);j.attr("title","Restart Activity").tooltip(Control.noDelayBottom);j.click(function(){$(this).tooltip("hide");var a=m.Restart();if(a!=null){n(a,m)}})}}}};FolderManager.prototype.selectFolder=function(b){this.currentFolder=b;this.currentItem=null;if(this.currentFolder!=null){this.render()}};FolderManager.prototype.selectItem=function(b){this.currentItem=b;if(this.currentItem!=null){this.currentFolder=this.currentItem.GetFolder();this.render()}else{this.selectFolder(this.currentFolder)}};FolderManager.prototype.activeItem=function(){var f=null;if(this.currentItem!=null){if(this.currentItem.IsList){f=this.currentItem}else{return this.currentItem}}else{if(this.currentFolder!=null){f=this.currentFolder}}if(f!=null){var e=f.GetItems();for(var d in e){if(!e[d].IsList){this.currentItem=e[d];this.currentItem.Select();return this.currentItem}}}return null};FolderManager.prototype.activeItemName=function(d){if(d!=null){var c=Control.Icons.forItemType(d);return $("<span>&nbsp;"+d.GetItemType().Name+"</span>").prepend(c)}return $("<span />")};FolderManager.prototype.activeList=function(){if(this.currentItem!=null){return(this.currentItem.IsList)?this.currentItem:this.currentItem.GetParentContainer()}else{if(this.currentFolder!=null){return this.currentFolder}}return null};FolderManager.prototype.activeListName=function(f){var e=(f==null)?this.activeList():f;if(e!=null){var d=Control.Icons.forItemType(e);return $("<span>&nbsp;"+e.Name+"</span>").prepend(d)}return $("<span>List View</span>")};FolderManager.prototype.activeView=function(d){var c=Control.findParent(this,"dataModel").dataModel;if(d===undefined){return(c.UserSettings.ViewState.ActiveView!=null)?c.UserSettings.ViewState.ActiveView:FolderManager.ListView}else{if(c.UserSettings.ViewState.ActiveView!=d){c.UserSettings.ViewState.ActiveView=d;this.render()}}};FolderManager.prototype.viewChanged=function(b){this.activeView(b.attr("href").substr(1))};function HelpManager(d,c){this.parentControl=d;this.$parentControl=c;this.$element=null}HelpManager.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};HelpManager.prototype.show=function(){if(this.$element==null){this.$element=$('<div class="manager-help" />').appendTo(this.$parentControl)}this.render();this.$element.show()};HelpManager.prototype.render=function(){this.$element.empty();var d=$('<div class="hero-unit" />').appendTo(this.$element);d.append('<img src="/content/images/twostep-large.png" alt="TwoStep" />');d.append(HelpManager.tagline);$connect=$('<p style="margin: 64px 0 -32px 0"></p>').appendTo(d);if(this.connectSuggestions==null){var f=this;var e=this.parentControl;e.dataModel.GetSuggestions(function(a){f.renderConnect($connect,a)})}else{this.renderConnect($connect,this.connectSuggestions)}};HelpManager.prototype.renderConnect=function(i,m){i.empty();this.connectSuggestions=m;var n=this;var l=this.parentControl.suggestionManager;var j=SuggestionManager.findSuggestion(m,SuggestionTypes.GetFBConsent);if(j!=null){var h=$('<a><img src="/content/images/connect-to-facebook.png" alt="Facebook" /></a>').appendTo(i);h.css("margin-right","32px");h.click(function(){l.select(j);n.connectSuggestions=null})}var k=SuggestionManager.findSuggestion(m,SuggestionTypes.GetGoogleConsent);if(k!=null){h=$('<a class="btn"><img src="/content/images/google-calendar.png" alt="Google" /></a>').appendTo(i);h.css("margin-right","32px");h.click(function(){l.select(k);n.connectSuggestions=null})}};HelpManager.tagline="<p>The ideal tool for managing your life activities. Organize the activities in your life into actionable steps and get a categorized list of next steps for getting things done. Get connected and have relevant information just one click away. Stay two steps ahead of life with TwoStep!</p>";function SettingsManager(d,c){this.parentControl=d;this.$parentElement=c;this.$element=null;this.addWell=false;this.views={}}SettingsManager.Display="sm-display-settings";SettingsManager.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};SettingsManager.prototype.show=function(){if(this.$element==null){this.$element=$('<div class="manager-settings" />').appendTo(this.$parentElement);var g=$('<ul class="nav nav-tabs" />').appendTo(this.$element);g.data("control",this);var e=$('<li><a data-toggle="tab"><i class="icon-cogs"></i> User Settings</a></li>').appendTo(g);e.find("a").attr("href","."+SettingsManager.Display);var f=$('<div class="tab-content" />').appendTo(this.$element);var h=$('<div class="tab-pane" />').appendTo(f);h.addClass(SettingsManager.Display);this.views[SettingsManager.Display]=h}this.render();this.$element.show()};SettingsManager.prototype.render=function(){var e=this.$element.find(".nav-tabs");e.find('a[href=".'+SettingsManager.Display+'"]').tab("show");var f=this.views[SettingsManager.Display];f.empty();var d=$('<form class="row-fluid form-vertical" />').appendTo(f)};function ListEditor(b){this.parentControl=b;this.$element=null;this.$activity=null;this.newItemEditor=new NewItemEditor(this);this.listView=new ListView(this)}ListEditor.prototype.render=function(i,l,m){if(this.$element==null){this.$element=i}var h=null,j=null;var k=0,n=0;h=this.renderActivity(this.$element,l);k=(h!=null)?h.outerHeight():0;j=this.newItemEditor.render(this.$element,l);n=(j!=null)?j.outerHeight():0;this.listView.render(this.$element,l,m-k-n-28);if(j!=null){j.find(".fn-name").focus()}};ListEditor.prototype.renderActivity=function(g,j){if(this.$activity==null){this.$activity=$('<ul class="nav nav-list" />').prependTo(g)}this.$activity.empty();if(!j.IsActivity()){return this.$activity}if(!j.IsPaused()){var l=j.GetItems(true);if(ItemMap.count(l)==0){var i=$("<li />").appendTo(this.$activity);i.addClass(j.StatusClass());var h=$('<a class="form-inline icon"/>').appendTo(i);var k=j.GetField(FieldNames.Complete);Control.Checkbox.render(h,j,k);if(j.IsComplete()){k=j.GetField(FieldNames.CompletedOn);Control.Text.render(h,j,k,"small","Completed on ")}else{k=j.GetField(FieldNames.DueDate);Control.Text.render(h,j,k,"small","Due on ")}}else{}}else{}return this.$activity};ListEditor.prototype.selectItem=function(b){this.parentControl.fireSelectionChanged(b)};function NewItemEditor(b){this.parentControl=b;this.$element=null;this.list;this.newItem}NewItemEditor.prototype.render=function(d,f){if(f!=null&&(f.IsFolder()||f.IsList)){if(this.$element==null){this.$element=$('<div class="row-fluid" />').appendTo(d)}this.$element.empty();if(!f.IsActivity()||f.IsPaused()){this.list=f;this.newItem=Item.Extend({Name:"",ItemTypeID:(f.IsActivity()?ItemTypes.Step:f.ItemTypeID)});var e=this.renderNameField(this.$element);e.val("")}}return this.$element};NewItemEditor.prototype.renderNameField=function(f){var i=this.newItem.GetFields();var j=i[FieldNames.Name];var g=$('<form class="form-inline"/>').appendTo(f);var h=Control.Text.renderInputNew(g,this.newItem,j,this.list);h.addClass("input-block-level");return h};function ListView(b){this.parentControl=b;this.$element=null;this.list=null}ListView.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};ListView.prototype.show=function(){if(this.$element!=null){this.$element.show()}};ListView.prototype.render=function(f,i,h){if(i==null){return}if(this.$element==null){this.$element=$('<ul class="nav nav-list" />').appendTo(f);Control.List.sortable(this.$element)}this.hide();this.$element.empty();if(h!=null){this.$element.css("max-height",h)}if(this.renderListItems(i)>0){this.show();var g=this.$element.find("li.selected");if(g.length==1){var j=g.offset().top-h+this.$element.scrollTop();if(j>0){this.$element.animate({scrollTop:j},500)}}}};ListView.prototype.renderListItems=function(p){var q=p.GetItems(true);var r=p.IsActivity()&&!p.IsPaused();var o=0;for(var m in q){var n=q[m];var l=$('<li class="position-relative" />').appendTo(this.$element);l.data("control",this);l.data("item",n);var k;if(r){if(n.IsActive()){l.addClass("selected")}l.addClass(n.StatusClass());k=$('<a class="form-inline" />').appendTo(l);this.renderNameField(k,n)}else{if(n.IsSelected()){l.addClass("selected")}if(n.IsPaused()){l.addClass(n.StatusClass())}k=$('<a class="form-inline drag-handle" />').appendTo(l);var j=Control.Icons.deleteBtn(n).appendTo(l);j.addClass("absolute-right");this.renderNameField(k,n);l.bind("click",function(a){if($(this).hasClass("ui-sortable-helper")||$(a.srcElement).hasClass("dt-checkbox")||$(a.srcElement).hasClass("dt-email")){return}var b=$(this).data("item");Control.get(this).parentControl.selectItem(b)})}this.renderFields(k,n);o++}return o};ListView.prototype.renderNameField=function(e,h){var g=h.GetFields();var f=g[FieldNames.Complete];if(f!=null){Control.Checkbox.render(e,h,f)}var f=g[FieldNames.WebLinks];if(f!=null){e.append(Control.Icons.forMap(h))}e.append(Control.Icons.forSources(h));f=g[FieldNames.Name];Control.Text.renderLabel(e,h,f)};ListView.prototype.renderFields=function(g,k){var h=$("<div />").appendTo(g);var j=k.GetFields();for(var l in j){var i=j[l];this.renderField(h,k,i)}$("<small>&nbsp;</small>").appendTo(h)};ListView.prototype.renderField=function(g,l,k){var h;switch(k.Name){case FieldNames.DueDate:if(l.HasField(FieldNames.EndDate)){var j=l.GetField(FieldNames.EndDate);h=Control.DateTime.renderRange(g,l,k,j,"small")}else{if(!(l.IsComplete()||l.IsSkipped())){h=Control.Text.render(g,l,k,"small","Due on ")}}break;case FieldNames.CompletedOn:if(l.IsComplete()){h=Control.Text.render(g,l,k,"small","Completed on ")}else{if(l.IsSkipped()){h=Control.Text.render(g,l,k,"small","Skipped on ")}}break;case FieldNames.Category:h=Control.Text.render(g,l,k,"small");break;case FieldNames.Email:h=Control.Text.renderEmail(g,l,k);break;case FieldNames.Address:var i=l.GetFieldValue(FieldNames.Address);if(i!=l.Name){h=Control.Text.render(g,l,k,"small")}break;default:break}return h};function ItemEditor(b){this.parentControl=b;this.$element=null;this.expanded=true;this.item}ItemEditor.prototype.hide=function(){this.$element.hide()};ItemEditor.prototype.show=function(){this.$element.show()};ItemEditor.prototype.render=function(c,d){if(d!=null&&!(d.IsFolder()||d.IsList)){if(this.$element==null){this.$element=$('<form class="row-fluid form-vertical carousel" />').appendTo(c);this.$element.data("control",this)}this.$element.empty();this.item=d;this.siblings=this.item.GetParentContainer().GetItems(true);this.renderFields(this.$element);if(ItemMap.count(this.siblings)>1){$('<a class="page-turn-control left"><div class="page-turn-prev" /></a>').appendTo(this.$element);$('<a class="page-turn-control right"><div class="page-turn-next" /></a>').appendTo(this.$element);this.$element.find(".page-turn-control").click(function(e){var a=$(e.target);var b=Control.get(a.parents(".carousel").first());b.renderNextItem(a);e.preventDefault()});this.$element.find(".carousel-control").dblclick(function(a){a.preventDefault()})}}};ItemEditor.prototype.renderNextItem=function(f){var i=f.hasClass("page-turn-next");var g=ItemMap.indexOf(this.siblings,this.item.ID);var h=ItemMap.count(this.siblings)-1;if(i){g=(g==h)?0:g+1}else{g=(g==0)?h:g-1}var j=ItemMap.itemAt(this.siblings,g);this.parentControl.fireSelectionChanged(j)};ItemEditor.prototype.renderFields=function(f){this.renderNameField(f);var g=$("<div />").appendTo(f);var i=this.item.GetFields();for(var j in i){var h=i[j];if(h.IsPrimary||this.expanded){this.renderField(g,h)}}};ItemEditor.prototype.renderNameField=function(n){var v="span12";var t=this.item.GetFields();var s=t[FieldNames.Complete];var p=$('<form class="form-inline well"/>').appendTo(n);$controls=$('<div class="span10" />').appendTo(p);if(s!=null){var m=Control.Checkbox.render($controls,this.item,s);m.addClass("inline-left");v="span11"}var o;s=t[FieldNames.Name];if(this.item.ItemTypeID==ItemTypes.Location){o=Control.Text.renderInputAddress($controls,this.item,s)}else{if(this.item.ItemTypeID==ItemTypes.Grocery){o=Control.Text.renderInputGrocery($controls,this.item,s)}else{o=Control.Text.renderInput($controls,this.item,s)}}o.addClass(v);var r=$('<div class="btn-toolbar span12" />').prependTo($controls);Control.Icons.deleteBtn(this.item).appendTo(r);var l=Control.ActionType.renderDropdown(r,this.item,true);if(l!=null){l.addClass("pull-right");l.find(".btn").addClass("btn-mini").css("border-style","none")}var q=$('<div class="span2 thumbnail" />').appendTo(p);var u=this.item.GetFieldValue(FieldNames.Picture);if(u!=null){$image=$("<img />").appendTo(q);$image.attr("src",u)}return o};ItemEditor.prototype.renderField=function(e,h){if(h.Name==FieldNames.Name||h.Name==FieldNames.Complete){return}var f;var g=$('<div class="control-group"><label class="control-label">'+h.DisplayName+"</label></div>");switch(h.DisplayType){case DisplayTypes.Hidden:case DisplayTypes.Priority:case DisplayTypes.Reference:case DisplayTypes.TagList:break;case DisplayTypes.ContactList:f=Control.ContactList.renderInput(g,this.item,h);break;case DisplayTypes.LocationList:f=Control.LocationList.renderInput(g,this.item,h);break;case DisplayTypes.Address:f=Control.Text.renderInputAddress(g,this.item,h);break;case DisplayTypes.LinkArray:f=Control.LinkArray.render(g,this.item,h);break;case DisplayTypes.DateTimePicker:f=Control.DateTime.renderDateTimePicker(g,this.item,h);break;case DisplayTypes.DatePicker:f=Control.DateTime.renderDatePicker(g,this.item,h);break;case DisplayTypes.TextArea:f=Control.Text.renderTextArea(g,this.item,h);break;case DisplayTypes.Checkbox:f=Control.Checkbox.render(g,this.item,h);break;case DisplayTypes.Text:default:f=Control.Text.renderInput(g,this.item,h);break}if(f!=null){f.addClass("input-block-level");g.appendTo(e)}return f};function SuggestionList(){this.onSelectionChangedHandlers={};this.groups={};this.$element=null}SuggestionList.prototype.addSelectionChangedHandler=function(d,c){this.onSelectionChangedHandlers[d]=c};SuggestionList.prototype.removeSelectionChangedHandler=function(b){this.onSelectionChangedHandlers[b]=undefined};SuggestionList.prototype.fireSelectionChanged=function(f){for(var e in this.onSelectionChangedHandlers){var d=this.onSelectionChangedHandlers[e];if(typeof(d)=="function"){if(f!=null){d(f)}}}};SuggestionList.prototype.working=function(b){if(this.$element!=null){if(b==true){this.$element.prepend('<div class="working"><span /></div>')}else{this.$element.find(".working").remove()}}};SuggestionList.prototype.render=function(f,i){this.groups=i;this.$element=f.empty();for(var j in this.groups){var h=this.groups[j];if(h.Suggestions!={}){var g=$('<ul class="nav nav-pills nav-stacked" />').appendTo(this.$element);g.attr("id",h.GroupID);$('<li class="active"><a><strong>'+h.DisplayName+"</strong></a></li>").appendTo(g);this.renderSuggestions(g,h)}}};SuggestionList.prototype.renderSuggestions=function(f,g){var j=g.Suggestions;for(var h in j){var i=j[h];if(i.SuggestionType==SuggestionTypes.ChooseManyWithChildren){if(ItemMap.count(i.Suggestions)>0){$dropdown=$('<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown"><b class="caret"></b>&nbsp;&nbsp;'+i.DisplayName+"</a></li>").appendTo(f);this.renderChildSuggestions($dropdown,i)}}else{this.renderSuggestion(f,i)}}};SuggestionList.prototype.renderChildSuggestions=function(g,k){var i=k.Suggestions;var h=$('<ul class="dropdown-menu pull-right" />').appendTo(g);for(var j in i){var l=i[j];this.renderSuggestion(h,l)}};SuggestionList.prototype.renderSuggestion=function(d,f){$suggestion=$("<li><a>"+f.DisplayName+"</a></li>").appendTo(d);$suggestion.data("control",this);$suggestion.data("suggestion",f);$suggestion.click(function(){Control.get(this).suggestionClicked($(this))});if(f.SuggestionType==SuggestionTypes.ChooseOneSubject){var e=Item.Extend($.parseJSON(f.Value));$icons=Control.Icons.forSources(e).addClass("pull-right");$suggestion.find("a").append($icons)}};SuggestionList.prototype.suggestionClicked=function(c){var d=c.data("suggestion");this.fireSelectionChanged(d)};SuggestionList.prototype.hideGroup=function(b){$("#"+b).collapse("hide")};function SuggestionManager(b){this.dataModel=b}SuggestionManager.findSuggestion=function SuggestionManager$findSuggestion(i,j){if(i!=null){for(var g in i){var f=i[g].Suggestions;if(f!=null){for(var h in f){if(f[h].SuggestionType==j){return f[h]}}}}}return null};SuggestionManager.prototype.select=function(d){var c=false;switch(d.SuggestionType){case SuggestionTypes.ChooseOne:c=this.chooseSuggestion(d);break;case SuggestionTypes.ChooseOneSubject:c=this.chooseSuggestion(d);break;case SuggestionTypes.ChooseMany:c=this.chooseMany(d);break;case SuggestionTypes.NavigateLink:c=this.navigateLink(d);break;case SuggestionTypes.GetFBConsent:c=this.getFacebookConsent(d);break;case SuggestionTypes.GetGoogleConsent:c=this.getGoogleConsent(d);break;case SuggestionTypes.GetADConsent:c=this.getCloudADConsent(d);break;default:c=this.chooseSuggestion(d);break}return c};SuggestionManager.prototype.chooseSuggestion=function(f,d){var e=this.dataModel;e.SelectSuggestion(f,Reasons.Chosen,function(a){if(d!=null){d()}});this.ignoreSuggestions(f);return true};SuggestionManager.prototype.ignoreSuggestions=function(j){var f=this.dataModel;var g=f.Suggestions[j.GroupID];if(g!=null){for(var h in g.Suggestions){var i=g.Suggestions[h];if(i.ID!=j.ID){f.SelectSuggestion(i,Reasons.Ignore)}}}};SuggestionManager.prototype.likeSuggestion=function(d,c){this.dataModel.SelectSuggestion(d,Reasons.Like,function(a){if(c!=null){c()}});return false};SuggestionManager.prototype.dislikeSuggestion=function(f,d){var e=this.dataModel;e.SelectSuggestion(f,Reasons.Dislike,function(a){if(d!=null){d()}});return false};SuggestionManager.prototype.navigateLink=function(b){return this.likeSuggestion(b,function(){window.open(b.Value)})};SuggestionManager.prototype.chooseMany=function(b){return this.likeSuggestion(b,function(){})};SuggestionManager.prototype.getFacebookConsent=function(f){var d=this.dataModel;var e="You will be redirected to Facebook to allow this application to access your Facebook information. This application will use information about yourself to help setup your user profile. This application will use information about your friends to help manage your Contacts. <br><br>Do you want to continue?";Control.confirm(e,"Facebook Consent?",function(){Service.GetFacebookConsent()});return false};SuggestionManager.prototype.getCloudADConsent=function(f){var d=this.dataModel;var e="You will be redirected to the Cloud Directory portal. Login with your Office 365 credentials to allow this application to access your directory information. This application will use information about yourself and other users to help manage your Contacts. <br><br>Do you want to continue?";Control.confirm(e,"Cloud Directory Consent?",function(){Service.GetCloudADConsent()});return false};SuggestionManager.prototype.getGoogleConsent=function(f){var d=this.dataModel;var e="You will be redirected to Google to allow this application to manage your Google Calendar. This application will interact with your calendar to keep your tasks and appointments synchronized. <br><br>Do you want to continue?";Control.confirm(e,"Google Calendar Consent?",function(){Service.GetGoogleConsent()});return false};